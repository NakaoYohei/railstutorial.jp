<html dir="ltr">
  <head>
    <title>static-pages</title>
    <link rel="stylesheet" href="http://railstutorial.jp/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://railstutorial.jp/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr">
    <div id="book">

<h1 class="title">Ruby on Rails 3.2 チュートリアル</h1>


<h1 class="subtitle">実例を使ってRailsを学ぼう</h1>


<h2 class="author">Michael Hartl (マイケル・ハートル)</h2>




<h2 class="contents">目次</h2>


<div id="table_of_contents"><ol><li class="chapter"><a href="http://railstutorial.jp/beginning.html#top"><span class="number">第1章</span> ゼロから本番展開まで</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-introduction"><span class="number">1.1</span>はじめに</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-comments_for_various_readers"><span class="number">1.1.1</span>読者の皆さまへ</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_1_2"><span class="number">1.1.2</span> Railsとスケールについて</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-conventions"><span class="number">1.1.3</span>この本における取り決め</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-up_and_running"><span class="number">1.2</span> さっそく動作させる</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-development_tools"><span class="number">1.2.1</span>開発環境</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_1">IDE</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_2">テキストエディタとコマンドライン</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_3">ブラウザ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_4">使用するツールについて</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-rubygems"><span class="number">1.2.2</span>Ruby、RubyGems、Rails、Git</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-rails_installer_windows">Railsインストーラ (Windows)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_git">Gitのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_ruby">Rubyのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_rubygems">RubyGemsのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_rails">Railsのインストール</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-the_first_application"><span class="number">1.2.3</span>最初のアプリケーション</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-rails_server"><span class="number">1.2.5</span> <tt>rails server</tt></a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-mvc"><span class="number">1.2.6</span>Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-version_control"><span class="number">1.3</span>Gitによるバージョン管理</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-git_setup"><span class="number">1.3.1</span>インストールとセットアップ</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_1_1">初めてのシステム・セットアップ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_1_2">初めてのリポジトリ・セットアップ</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-adding_and_committing"><span class="number">1.3.2</span>追加とコミット</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_3"><span class="number">1.3.3</span>Gitのメリット</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-git_commands"><span class="number">1.3.5</span>ブランチ (branch)、変更 (edit)、 コミット (commit)、マージ (merge)</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_branch">ブランチ (branch)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_edit">変更 (edit)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_commit">コミット (commit)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_merge">マージ (merge)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_push">プッシュ (push)</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-deploying"><span class="number">1.4</span>展開する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_setup"><span class="number">1.4.1</span> Herokuのセットアップ</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_step_one"><span class="number">1.4.2</span> Herokuに展開する (1)</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_4_3"><span class="number">1.4.3</span> Herokuに展開する (2)</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_commands"><span class="number">1.4.4</span> Heroku コマンド</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-beginning_conclusion"><span class="number">1.5</span> 最後に</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/a-demo-app.html#top"><span class="number">第2章</span>デモアプリケーション</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-planning_the_application"><span class="number">2.1</span> アプリの計画</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-modeling_demo_users"><span class="number">2.1.1</span>ユーザーのモデル設計</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-modeling_demo_microposts"><span class="number">2.1.2</span>マイクロポストのモデル設計</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-demo_users_resource"><span class="number">2.2</span>Users リソース </a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-a_user_tour"><span class="number">2.2.1</span>ユーザページを探検する</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-mvc_in_action"><span class="number">2.2.2</span> MVCの挙動</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-weaknesses_of_this_users_resource"><span class="number">2.2.3</span>Users リソースの欠点</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-microposts_resource"><span class="number">2.3</span>Mircroposts リソース</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-a_micropost_microtour"><span class="number">2.3.1</span>マイクロポストのページを探検する</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-putting_the_micro_in_microposts"><span class="number">2.3.2</span>マイクロポストを<em>マイクロ</em>にする</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-demo_user_has_many_microposts"><span class="number">2.3.3</span>ユーザーとマイクロポストを<tt>has_many</tt>で関連づける</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-inheritance_hierarchies"><span class="number">2.3.4</span>継承の階層</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-deploying_the_demo_app"><span class="number">2.3.5</span>デモアプリケーションの展開</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-2_4"><span class="number">2.4</span>最後に</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/static-pages.html#top"><span class="number">第3章</span>ほぼ静的なページの作成</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages"><span class="number">3.1</span>静的ページ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-truly_static_pages"><span class="number">3.1.1</span>「本当に」静的なページ</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails"><span class="number">3.1.2</span>Railsによる静的なページ</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-first_tests"><span class="number">3.2</span>最初のテスト</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-TDD"><span class="number">3.2.1</span>テスト駆動開発</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-adding_a_page"><span class="number">3.2.2</span>ページの追加</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-red">赤 (Red)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-green">緑 (Green)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-refactor">リファクタリング</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages"><span class="number">3.3</span>少しだけ動的なページ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-testing_a_title_change"><span class="number">3.3.1</span>タイトル変更をテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-passing_title_tests"><span class="number">3.3.2</span>タイトルのテストをパスさせる</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-embedded_ruby"><span class="number">3.3.3</span>埋め込みRuby</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-layouts"><span class="number">3.3.4</span>レイアウトを使って重複を解消する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_conclusion"><span class="number">3.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises"><span class="number">3.5</span>演習</a></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-advanced_setup"><span class="number">3.6</span>高度なセットアップ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-eliminating_bundle_exec"><span class="number">3.6.1</span><tt>bundle exec</tt>を追放する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-rvm_bundler_integration">RVM Bundler の統合</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-binstubs">binstubオプション</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-guard"><span class="number">3.6.2</span>Guardによるテストの自動化</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-spork"><span class="number">3.6.3</span>Spork を使ったテストの高速化</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-spork_and_guard">GuardにSporkを導入する</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-tests_inside_sublime_text"><span class="number">3.6.4</span>Sublime Text上でテストする</a></li></ol></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/rails-flavored-ruby.html#top"><span class="number">第4章</span> Rails風味のRuby</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-motivation"><span class="number">4.1</span>動機</a></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-strings_and_methods"><span class="number">4.2</span>文字列(string)とメソッド</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-comments"><span class="number">4.2.1</span>コメント</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-strings"><span class="number">4.2.2</span>文字列</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-printing">出力</a></li><li class="subsubsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-single_quoted_strings">シングルクォート内の文字列</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-objects_and_message_passing"><span class="number">4.2.3</span>オブジェクトとメッセージ受け渡し</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-method_definitions"><span class="number">4.2.4</span>メソッドの定義</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-back_to_the_title_helper"><span class="number">4.2.5</span> title ヘルパー、再び</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-other_data_structures"><span class="number">4.3</span>他のデータ構造</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-arrays_and_ranges"><span class="number">4.3.1</span>配列と範囲演算子</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-blocks"><span class="number">4.3.2</span>ブロック</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-hashes_and_symbols"><span class="number">4.3.3</span>ハッシュとシンボル</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-css_revisited"><span class="number">4.3.4</span> CSS、再び</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-ruby_classes"><span class="number">4.4</span> Ruby におけるクラス</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-constructors"><span class="number">4.4.1</span>コンストラクタ</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_class_of_our_own"><span class="number">4.4.2</span>クラス継承</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-modifying_built_in_classes"><span class="number">4.4.3</span>組込みクラスの変更</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_controller_class"><span class="number">4.4.4</span>コントローラクラス</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_user_class"><span class="number">4.4.5</span>ユーザークラス</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-conclusion"><span class="number">4.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-exercises"><span class="number">4.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/filling-in-the-layout.html#top"><span class="number">第5章</span>レイアウトを作成する</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-structure"><span class="number">5.1</span>構造を追加する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-adding_to_the_layout"><span class="number">5.1.1</span>ナビゲーション</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css"><span class="number">5.1.2</span>BootstrapとカスタムCSS</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-partials"><span class="number">5.1.3</span>パーシャル (partial)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline"><span class="number">5.2</span>Sass と asset pipleline</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-the_asset_pipeline"><span class="number">5.2.1</span> asset pipeline</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_1">asset ディレクトリ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_2">マニフェストファイル</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_3">プリプロセッサエンジン</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_4">プロダクション環境での効率性</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass"><span class="number">5.2.2</span>素晴らしい構文を備えたスタイルシート</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_1">ネスト</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_2">変数</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links"><span class="number">5.3</span>レイアウトのリンク</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-route_tests"><span class="number">5.3.1</span> ルートのテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-rails_routes"><span class="number">5.3.2</span> Railsのルート</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-named_routes"><span class="number">5.3.3</span>名前付きルート</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-pretty_rspec"><span class="number">5.3.4</span>Pretty RSpec</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-user_signup"><span class="number">5.4</span>ユーザーのサインアップ：最初のステップ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-users_controller"><span class="number">5.4.1</span>ユーザーコントローラ</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-signup_url"><span class="number">5.4.2</span>サインアップURI</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_conclusion"><span class="number">5.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises"><span class="number">5.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/modeling-users.html#top"><span class="number">第6章</span>ユーザーのモデルを作成する</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-user_model"><span class="number">6.1</span> Userモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-database_migrations"><span class="number">6.1.1</span>データベースの移行</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-the_model_file"><span class="number">6.1.2</span>modelファイル</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-model_annotation">モデル注釈</a></li><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-accessible_attributes">アクセス可能な属性</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-creating_user_objects"><span class="number">6.1.3</span>ユーザーオブジェクトを作成する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-finding_user_objects"><span class="number">6.1.4</span>ユーザーオブジェクトを検索する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-updating_user_objects"><span class="number">6.1.5</span>ユーザーオブジェクトを更新する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-user_validations"><span class="number">6.2</span>ユーザーを検証する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-initial_user_tests"><span class="number">6.2.1</span>最初のユーザーテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-presence_validation"><span class="number">6.2.2</span>プレゼンスを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-length_validation"><span class="number">6.2.3</span>長さを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-format_validation"><span class="number">6.2.4</span>フォーマットを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-uniqueness_validation"><span class="number">6.2.5</span>一意性を検証する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-the_caveat">一意性の警告</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-adding_a_secure_password"><span class="number">6.3</span>セキュアなパスワードを追加する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-an_encrypted_password"><span class="number">6.3.1</span>暗号化されたパスワード</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-password_and_confirmation"><span class="number">6.3.2</span>パスワードと確認</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-user_authentication"><span class="number">6.3.3</span>ユーザー認証</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-has_secure_password"><span class="number">6.3.4</span>ユーザーがセキュアなパスワードを持っている</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-creating_a_user"><span class="number">6.3.5</span>ユーザーを作成する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-6_4"><span class="number">6.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-6_5"><span class="number">6.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/sign-up.html#top"><span class="number">第7章</span>ユーザー登録</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-showing_users"><span class="number">7.1</span>ユーザーを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-rails_environments"><span class="number">7.1.1</span>デバッグとRails環境</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_users_resource"><span class="number">7.1.2</span>ユーザーリソース</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-tests_with_factories"><span class="number">7.1.3</span>ファクトリーを使用してユーザー表示ページをテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_gravatar_image"><span class="number">7.1.4</span>gravatar画像とサイドバー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_form"><span class="number">7.2</span>ユーザー登録フォーム</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-tests_for_user_signup"><span class="number">7.2.1</span>ユーザー登録のためのテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-using_form_for"><span class="number">7.2.2</span><tt>form_for</tt>を使用する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_form_html"><span class="number">7.2.3</span>フォームHTML</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_failure"><span class="number">7.3</span>ユーザー登録失敗</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_working_form"><span class="number">7.3.1</span>正しいフォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-signup_error_messages"><span class="number">7.3.2</span>ユーザー登録のエラーメッセージ</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_success"><span class="number">7.4</span>ユーザー登録成功</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_finished_signup_form"><span class="number">7.4.1</span>登録フォームの完成</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_flash"><span class="number">7.4.2</span>flash</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_first_signup"><span class="number">7.4.3</span>実際のユーザー登録</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-deploying_to_production_with_ssl"><span class="number">7.4.4</span> SSLを導入してプロダクション環境を展開する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-7_5"><span class="number">7.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_exercises"><span class="number">7.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/sign-in-sign-out.html#top"><span class="number">第8章</span>サインイン、サインアウト</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_failure"><span class="number">8.1</span>セッション、サインインの失敗</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-sessions_controller"><span class="number">8.1.1</span>Sessionコントローラ</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_tests"><span class="number">8.1.2</span>サインインをテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_form"><span class="number">8.1.3</span>サインインのフォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-reviewing_form_submission"><span class="number">8.1.4</span>確認フォームを送信する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-rendering_with_a_flash_message"><span class="number">8.1.5</span>フラッシュメッセージをレンダリングする</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_success"><span class="number">8.2、</span>サインイン成功</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-remember_me"><span class="number">8.2.1</span>[このアカウント設定を保存する]</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-a_working_sign_in_method"><span class="number">8.2.2</span>正しい<tt>sign_in</tt>メソッド</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-current_user"><span class="number">8.2.3</span>現在のユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-changing_the_layout_links"><span class="number">8.2.4</span>レイアウトリンクを変更する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_upon_signup"><span class="number">8.2.5</span>ユーザー登録と同時にサインインする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signing_out"><span class="number">8.2.6</span>サインアウトする</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-cucumber"><span class="number">8.3</span>Cucumberの紹介(オプション)</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-installation_and_setup"><span class="number">8.3.1</span>インストールと設定</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-features_and_steps"><span class="number">8.3.2</span>機能と手順</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-rspec_custom_matchers"><span class="number">8.3.3</span>対比: RSpecのカスタムマッチャー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-8_4"><span class="number">8.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-sign_in_out_exercises"><span class="number">8.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#top"><span class="number">第9章</span> ユーザーの更新・表示・削除</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_users"><span class="number">9.1</span>ユーザーを更新する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-edit_form"><span class="number">9.1.1</span>編集フォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-unsuccessful_edits"><span class="number">9.1.2</span>編集の失敗</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-successful_edits"><span class="number">9.1.3</span>編集の成功</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-authorization"><span class="number">9.2</span>認可</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-requiring_signed_in_users"><span class="number">9.2.1</span>ユーザーのサインインを要求する</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-requiring_the_right_user"><span class="number">9.2.2</span>正しいユーザーを要求する</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-friendly_forwarding"><span class="number">9.2.3</span>フレンドリーフォワーディング</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-showing_all_users"><span class="number">9.3</span>すべてのユーザーを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-user_index"><span class="number">9.3.1</span>ユーザーインデックス</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-sample_users"><span class="number">9.3.2</span>サンプルのユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-pagination"><span class="number">9.3.3</span>ページネーション</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-partial_refactoring"><span class="number">9.3.4</span>パーシャルのリファクタリング</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-destroying_users"><span class="number">9.4</span>ユーザを削除する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-administrative_users"><span class="number">9.4.1</span>管理ユーザー</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-revisiting_attr_accessible"><tt>attr_accessible</tt>属性再び</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-the_destroy_action"><span class="number">9.4.2</span> <tt>destroy</tt>アクション</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_and_deleting_users_conclusion"><span class="number">9.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_deleting_exercises"><span class="number">9.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/user-microposts.html#top"><span class="number">第10章</span>ユーザーのマイクロポスト</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-a_micropost_model"><span class="number">10.1</span>Micropostモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-the_basic_model"><span class="number">10.1.1</span>基本的なモデル</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-accessible_attribute"><span class="number">10.1.2</span>Accessible属性と最初の検証</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-user_micropost_associations"><span class="number">10.1.3</span>User/Micropostの関連付け</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-ordering_and_dependency"><span class="number">10.1.4</span>マイクロポストを改良する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/user-microposts.html#sec-default_scope">デフォルトのスコープ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/user-microposts.html#sec-dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-micropost_validations"><span class="number">10.1.5</span>コンテンツの検証</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-showing_microposts"><span class="number">10.2</span>マイクロポストを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-augmenting_the_user_show_page"><span class="number">10.2.1</span>ユーザー表示ページの拡張</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-sample_microposts"><span class="number">10.2.2</span>マイクロポストのサンプル</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-manipulating_microposts"><span class="number">10.3</span>マイクロポストを操作する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-access_control"><span class="number">10.3.1</span>アクセス制御</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-creating_microposts"><span class="number">10.3.2</span>マイクロポストを作成する</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-a_proto_feed"><span class="number">10.3.3</span>フィードの原型</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-destroying_microposts"><span class="number">10.3.4</span>マイクロポストを削除する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-10_4"><span class="number">10.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-micropost_exercises"><span class="number">10.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/following-users.html#top"><span class="number">第11章</span>ユーザーをフォローする</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-the_relationship_model"><span class="number">11.1</span>Relationshipモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_problem_with_the_data_model"><span class="number">11.1.1</span>データモデルの問題 (および解決策)</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-relationship_user_associations"><span class="number">11.1.2</span>User/relationshipの関連付け</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-relationship_validations"><span class="number">11.1.3</span>検証</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-following"><span class="number">11.1.4</span>フォローしているユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-followers"><span class="number">11.1.5</span>フォロワー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-a_web_interface_for_following_and_followers"><span class="number">11.2</span>フォローしているユーザー用のWebインターフェイス</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-sample_following_data"><span class="number">11.2.1</span>フォローしているユーザーのサンプルデータ</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-stats_and_a_follow_form"><span class="number">11.2.2</span>統計とフォロー用フォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-following_and_followers_pages"><span class="number">11.2.3</span>「フォローしているユーザー」ページと「フォロワー」ページ</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_working_follow_button_the_standard_way"><span class="number">11.2.4</span>[フォローする] ボタン (標準的な方法)</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_working_follow_button_with_ajax"><span class="number">11.2.5</span>[フォローする] ボタン (Ajax)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-the_status_feed"><span class="number">11.3</span>ステータスフィード</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-motivation_and_strategy"><span class="number">11.3.1</span>動機と計画</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_first_feed_implementation"><span class="number">11.3.2</span>フィードを初めて実装する</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-scopes_subselects_and_a_lambda"><span class="number">11.3.3</span>サブセレクト</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-the_new_status_feed"><span class="number">11.3.4</span>新しいステータスフィード</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-following_conclusion"><span class="number">11.4</span>最後に</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-extensions_to_the_sample_application"><span class="number">11.4.1</span>サンプルアプリケーションの機能を拡張する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-replies">返信機能</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-messaging">メッセージ機能</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-follower_notifications">フォロワーの通知</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-password_reminders">パスワードリマインダー</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-signup_confirmation">ユーザー登録の確認</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-rss_feed">RSSフィード</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-rest_api">REST API</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-search">検索機能</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-guide_to_further_resources"><span class="number">11.4.2</span>読み物ガイド</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-following_exercises"><span class="number">11.5</span>演習</a></li></ol></li></ol></div>


<div id="main_content"></div>


<p> <span class="preamble">
</span><span class="preamble"> <span id="foreword">
</span></span><span class="preamble"><span id="foreword"><strong>前書き</strong> </span></span><br /><span class="preamble"><span id="foreword">
</span></span><span class="preamble"><span id="foreword"> </span>
</span><span class="preamble"> </span></p>

<p>私が前にいた会社 (CD Baby) は、かなり早い段階でRuby on Railsに乗り換えたのですが、またPHPに戻ってしまいました (詳細は私の名前をGoogleで検索してみて下さい)。Michael Hartl氏が書いたこの本を強く勧められ、これはやってみなければ、と試した結果、私が再びRailsに乗り換えるに至ったのがこの<em>Ruby on Railsチュートリアル</em>です。</p>

<p>私は多数のRails本を参考にしてきましたが、真の決定版と呼べるものは本書をおいて他にありません。本書ではあらゆる手順が文字通りRails流 (“Rails way”は railway にかけている) で行われており、最初はなかなか慣れませんでしたが、この本を終えた今、ついにこれこそが自然な方式だと感じられるまでになりました。また、本書はRails本の中で唯一、多くのプロが推奨するテスト駆動開発 (TDD: Test Driven Development) 方式を全編を通して実践していて、非常にわかりやすく解説されています。極めつけは、Git、GitHub、そしてHerokuまでも実例に含めた事で、チュートリアルのコード例など実際のプロジェクトの開発プロセスまでも体験できるようになっていることです。チュートリアルのコード例は、どれもチュートリアルと見事に一体化しています。</p>

<p>本書は全体が筋道だったストーリーに貫かれており、非常に素晴らしいものです。私自身、3日間かけて章の終わりにある練習問題もやりながら<em>Railsチュートリアル</em>を一気に読破しました。最初から最後まで、途中を飛ばさずにやるのが一番効果的で有益な読み方です。ぜひやってみて下さい。</p>

<p>是非お試しください。</p>

<p>デレック・シバーズ (<a href="http://sivers.org/">Derek Sivers</a>) (<a href="http://sivers.org/">sivers.org</a>)<br />
<em>元: <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> (創始者)</em> <br />
<em>現在: <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> (創始者) </em> <br /></p>

<p> <span class="preamble">
</span><span class="preamble"><strong>謝辞</strong> </span><br /><span class="preamble">
</span><span class="preamble"> </span></p>

<p><em>Ruby on Rails チュートリアル</em>は、私の以前の著書<em>RailsSpace</em>と、その時の共著者の<a href="http://aure.com/">Aurelius Prochazka</a>に多くを負っています。Aureには、RailsSpaceでの協力と本書への支援も含め、感謝したいと思います。また、<em>RailsSpace</em>と<em>Rails チュートリアル</em>両方の編集を担当して頂いたDebra Williams Cauley氏にも謝意を表したく思います。</p>

<p>私にインスピレーションと知識を与えてくれたRubyistの方々にも感謝したいと思います:David Heinemeier Hansson、 Yehuda Katz、 Carl Lerche、 Jeremy Kemper、 Xavier Noria、 Ryan Bates、 Geoffrey Grosenbach、 Peter Cooper、 Matt Aimonetti、 Gregg Pollack、 Wayne E. Seguin、 Amy Hoy、 Dave Chelimsky、 Pat Maddox、 Tom Preston-Werner、 Chris Wanstrath、 Chad Fowler、 Josh Susser、 Obie Fernandez、 Ian McFarland、 Steven Bristol、 Pratik Naik、 Sarah Mei、 Sarah Allen、 Wolfram Arnold、 Alex Chaffee、 Giles Bowkett、 Evan Dorn、 Long Nguyen、 James Lindenbaum、 Adam Wiggins、 Tikhon Bernstam、 Ron Evans、 Wyatt Greene、 Miles Forrest、 Pivotal Labsの方々、 Herokuの方々、 thoughtbotの方々、 そしてGitHubチーム。最後に、ここに書ききれないほど多くの読者の方々から執筆中にバグ報告や提案を頂き、本書をできる限り良いものにするのに大変役立ちました。<br /></p>

<p> <span class="preamble">
</span><span class="preamble"> <span id="author">
</span></span><span class="preamble"><span id="author"><strong>著者</strong> </span></span><br /><span class="preamble"><span id="author">
</span></span><span class="preamble"><span id="author"> </span>
</span><span class="preamble"> </span></p>

<p><a href="http://michaelhartl.com/">マイケル・ハートル (Michael Hartl)</a> は、<a href="http://ruby.railstutorial.org/"><em>Ruby on Rails</em></a>を使用したweb開発を手ほどきする教材として有名な<a href="http://rubyonrails.org/">Ruby on Rails チュートリアル</a>の著者です。(今ではすっかり古くなってしまいましたが) Railsのチュートリアル本である<em>RailsSpace</em>の著述と開発に携わったことがあり、 一時人気を博したRuby on RailsベースのソーシャルネットワーキングプラットフォームInsoshiも開発していました。2011年、マイケルはRailsコミュニティへの貢献が認められて<a href="http://rubyheroes.com/heroes">Ruby Hero Award</a>を受賞しました。<a href="http://college.harvard.edu/">ハーバード大学</a>卒業後 、<a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">カリフォルニア工科大学</a>で<a href="http://www.caltech.edu/">物理学博士号</a>を取得し、起業プログラム<a href="http://ycombinator.com/">Y Combinator</a>の卒業生でもあります。<br /></p>

<p> <span id="license" class="preamble">
</span><span id="license" class="preamble"><strong>著作権とライセンス</strong> </span><br /><span id="license" class="preamble">
</span><span id="license" class="preamble"> </span></p>

<p><em>Ruby on Rails チュートリアル: 実例を使ってRailsを学ぼう</em>Copyright © 2010 by Michael Hartl.<em>Ruby on Rails チュートリアル</em>内のすべてのソースコードは<a href="http://www.opensource.org/licenses/mit-license.php">MITライセンス</a>および<a href="http://people.freebsd.org/~phk/">Beerwareライセンス</a> の元で提供されています。</p>

<div class="code"><div class="highlight"><pre>(The MIT License)
Copyright (c) 2012 Michael Hartl
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</br>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, </br>WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISINGOUT OF OR </br>IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS INTHE SOFTWARE.</pre></div>
</div>


<div class="code"><div class="highlight"><pre>/*
 * ----------------------------------------------------------------------------
 * &quot;THE BEER-WARE LICENSE&quot; (Revision 42):
 * Michael Hartl wrote this code.As long as you retain this notice you
 * can do whatever you want with this stuff. If we meet some day, and you think
 * this stuff is worth it, you can buy me a beer in return.
 * ----------------------------------------------------------------------------
 */
</pre></div>
</div>


<div id="top"></div>


<h1 class="chapter"><a id="sec-3" href="http://railstutorial.jp/static-pages.html#top" class="heading"><span class="number">第3章</span>ほぼ静的なページの作成</a></h1>


<p>本章では、今後のチュートリアルを楽に理解できるように、簡単なサンプルアプリケーションを開発してみます。本書を通して開発するアプリケーションは、最終的にはユーザやマイクロポスト、ログイン／ログアウトなどの認証機能を持ちますが、まずは簡単なトピックである「静的なページの作成」から始めます。非常にシンプルなページではありますが、静的なページを作成することは良い経験になり、また、多くの示唆も得られます。私達がこれから開発するアプリケーションにとって、最高のスタート地点といえるでしょう。</p>

<p>Rails はデータベースと連携して動的なウェブサイトを開発するように設計されていますが、HTMLファイルだけで構成されている静的なページを作ることもできます。実際、静的なページをRailsで作ることのメリットもあります。たとえば、あとで<em>ほんの少し</em>動的なコンテンツを追加することができます。本章では、このような静的なページの作成について学んでいきます。まずは、<em>自動化テスト</em>の雰囲気を掴んでいきます。自動化テストは、私達のコードが正しく動いているという自信を与えてくれます。さらに、良いテストを書くことで、自信をもって<em>リファクタリング</em>を行うことができます。たとえば、フォームの振る舞いを変更せずに、フォーム内で使われている関数を書き換えたいときに便利です。</p>

<p>本章には多くのサンプルコードがあります。特に <a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a> や <a class="ref" href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages">3.3</a> で多くのコードを紹介していますが、Rubyが初めての方は、コードを隅々まで理解しなければならないのだろうかと心配する必要はありません。<a class="ref" href="http://railstutorial.jp/beginning.html#sec-comments_for_various_readers">1.1.1</a> で紹介したように、まずはテストをコピー&amp;ペーストしてみて、アプリケーションがうまく動くかどうか検証してみると良いでしょう。この時点では、テストどのようにして動くかは気にしなくても大丈夫です。また、<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#top">第4章</a>ではRubyについて解説します。そこでは、Rubyの書き方やコンセプトについて学びます。最後に、本書ではRSpecを使ったテストを繰り返し実施していきます。ですから、もし途中でよく分からないテストがあったとしても、読み飛ばして先に進むことをお勧めします。1、2章先を読み進めた後に読み返してみると、あのときはよく分からなかったテストが、実はとてもシンプルであることを理解できるはずです。</p>

<p>では、<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でもやったように、まずはRailsプロジェクトを作りましょう。今回は<code>sample_app</code>というプロジェクトを作ります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd </span>rails_projects
<span class="gp">$</span> rails new sample_app --skip-test-unit
<span class="gp">$</span> <span class="nb">cd </span>sample_app
</pre></div>
</div>


<p>ここで使った<code>rails</code>の<tt class="verb">--skip-test-unit</tt>というオプションは、<code>Test::Unit</code>フレームワークと関連している<code>test</code>ディレクトリを作成しないようにするオプションです。これは「テストを書かないから」という理由ではありません。そうではなく、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a>以降では、もう1つのテストフレームワークである<em>RSpec</em>を使ってテストを書くからです。</p>

<p>次は、<a class="ref" href="http://railstutorial.jp/a-demo-app.html#sec-planning_the_application">2.1</a>と同じように、テキストエディタを使って<code>Gemfile</code>に必要なgemを書き足していきます。今回は、2つの新しいgemを使います。RSpecのためのgem と、RSpecのライブラリのためのgemです。これらのgemをGemfileに追加すると、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-gemfile_rspec">リスト3.1</a>のようになります(<em>注</em>: もしサンプルアプリケーションの開発で必要になるgemを<em>すべて</em>知りたい場合は、<a class="ref" href="http://railstutorial.jp/updating-showing-and-deleting-users.html#code-final_gemfile">リスト9.49</a>を参照してください。これが最終的なGemfileになります)。</p>

<div class="label" id="code-gemfile_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト 3.1</span> <span class="description">サンプルアプリケーションで使う<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>

<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.11.0&#39;</span>
<span class="k">end</span>

<span class="c1"># assetsでは使うが、</span>
<span class="c1"># 本番環境ではデフォルトで不要なGem</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>このGemfileでは、開発環境とテスト環境で<tt>rspec-rails</tt>を使うようにしています。このため、開発環境ではRSpec固有のジェネレーターにアクセスすることができます。同様に、テスト環境ではRSpecを使用してテストを実行できるようになります。Gemfileに記述した<tt>rspec-rails</tt>が依存関係を解決してくれるため、 個々の環境にRSpec自身を手動でインストールする必要がなくなり、自動的にインストールされるようになります。同様の理由で、<a href="https://github.com/jnicklas/capybara">Capybara</a>もGemfileに記述しています。これは、英語に近い文法を使って、ユーザーの対話的操作をシミュレーションできるGemです<sup class="footnote" id="fnref-3_1"><a href="http://railstutorial.jp/static-pages.html#fn-3_1">1</a></sup>。また、<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でも扱ったように、Herokuに展開するときにはPostgreSQLのgemを本番環境に追加します。</p>

<div class="code"><div class="highlight"><pre><span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div>


<p>Herokuは、開発環境とプロダクション環境とで同じデータベースを使うことを推奨していますが、今回開発するサンプルアプリケーションでは、データベースが異なっていても特に問題はありません。また、SQLiteはPostgreSQLに比べて<em>きわめて簡単に</em> セットアップできます。なお、ローカルの開発マシンへのPostgreSQLのインストールと構築については、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises">3.5</a>の演習課題として取り上げています。</p>

<p>Gemfileに新しく追加したgemを実際にインストールするには、<code>bundle update</code>と<code>bundle install</code>を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle update
<span class="gp">$</span> bundle install --without production
</pre></div>
</div>


<p><a class="ref" href="http://railstutorial.jp/beginning.html#sec-heroku_setup">1.4.1</a>や<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でも説明したように、<tt class="verb">--without</tt> <tt class="verb">production</tt>オプションを追加することで、本番環境にのみgemをインストールしないようにすることができます。注: このオプションは “remembered option” と呼ばれるもので、このオプションを一度実行するとコマンドに保存され、今後Bundlerを実行するときにオプションを追加する必要がなくなります。このため、今後は単に<code>bundle install</code>を実行するだけで、自動的に本番環境用gemをスキップできるようになります<sup class="footnote" id="fnref-3_2"><a href="http://railstutorial.jp/static-pages.html#fn-3_2">2</a></sup>。</p>

<p>次に、<code>Test::Unit</code>の代わりにRSpecを使うように、Railsの設定を変更します。これを行うには、<code>rails generate rspec:install</code> を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>(JavaScriptランタイムがインストールされていないというエラーが表示された場合は、<a href="https://github.com/sstephenson/execjs">GitHubのexecjsページ</a>にあるインストール可能なランタイムの一覧から入手してください。個人的には<a href="http://nodejs.org/">Node.js</a>をお勧めします。) </p>

<p>ここまで進めたら、後はGitリポジトリを初期化するだけです<sup class="footnote" id="fnref-3_3"><a href="http://railstutorial.jp/static-pages.html#fn-3_3">3</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<p>まずは、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-sample_app_readme">リスト 3.2</a>のように、アプリケーションのルートディレクトリに置かれている<code>README</code>ファイルをわかりやすく書き直してみましょう。</p>

<div class="label" id="code-sample_app_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト 3.2</span> <span class="description">サンプルアプリケーション向けに改善した<code>README</code>ファイル。</span> </div>
<div class="code"><div class="highlight"><pre># Ruby on Rails チュートリアル：サンプルアプリケーション

これは、以下のためのサンプルアプリケーションです。
[*Ruby on Rails Tutorial: Learn Rails by Example*](http://railstutorial.org/)
by [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>


<p>次に、拡張子を <code>.md</code> に変更し、Markdownファイルとして認識できるようにします。その後、これらの変更をコミットします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README.rdoc README.md
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Improve the README file&quot;</span>
</pre></div>
</div>




<div class="label" id="fig-create_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/create_repository_new.png" alt="create_repository_new" /></span></div><div class="caption"><span class="header">図3.1</span><span class="description">サンプルアプリケーションのリポジトリをGitHub上に作成する。<a href="http://railstutorial.org/images/figures/create_repository_new-full.png">(拡大)</a></span></div></div>


<p>本書では今後、このサンプルアプリケーションを使っていくことになるので、GitHub上にリポジトリを作成し (<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-create_repository">図 3.1</a>)、プッシュしておくと良いでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;ユーザ名&gt;/first_app.git
<span class="gp">$</span> git push -u origin master
</pre></div>
</div>


<p>ここまで作業を進めると、<a href="https://github.com/railstutorial/sample_app_2nd_ed">GitHubに上がっているRailsチュートリアルのサンプルアプリケーション</a>のようになります (名前は若干異なりますが)<sup class="footnote" id="fnref-3_4"><a href="http://railstutorial.jp/static-pages.html#fn-3_4">4</a></sup>。</p>

<p>もちろん、この時点でHerokuに展開することもできます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create --stack cedar
<span class="gp">$</span> git push heroku master
</pre></div>
</div>


<p>なお、本書を進める間、アプリケーションを定期的にGitHubにプッシュしたり、Herokuに展開することをお勧めします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>これにより、リモート環境にバックアップを置くことができ、本番環境で発生するエラーをなるべく早期に発見することができます。なお、Herokuに展開するときにエラーが発生した場合は、以下のコマンドを実行して本番環境のログを取得してください。このログは、問題を特定するときに役立ちます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku logs
</pre></div>
</div>


<p>ここまでの準備が完了したら、いよいよサンプルアプリケーションの開発を始めましょう。</p>

<div class="label" id="sec-static_pages"></div>


<h2><a id="sec-3_1" href="http://railstutorial.jp/static-pages.html#sec-static_pages" class="heading"><span class="number">3.1</span>静的ページ</a></h2>


<p>Railsで静的なページを作成する場合、主に次の2つの方法があります。1つは、生のHTMLファイルを含む<em>本当に</em>静的なページを表示する方法です。もう1つは、生のHTMLを含む<em>ビュー (view) </em>を定義することです。ビューを定義する方法では、Railsがビューを<em>出力 (rendering) </em>し、その後Webサーバーがその結果をブラウザに送信します。</p>

<p>現在どのディレクトリで作業しているかがわからなくなった場合は、<a class="ref" href="http://railstutorial.jp/beginning.html#sec-the_first_application">1.2.3</a> (<a class="ref" href="http://railstutorial.jp/beginning.html#fig-directory_structure_rails_3_2">図 1.2</a>)を再度参照して、Rails のディレクトリ構造を確認してください。この節では、主に<code>app/controllers</code>ディレクトリや<code>app/views</code>ディレクトリ内で作業を進めます (なお <a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a> では、新しいディレクトリをさらに１つ追加します)。</p>

<p>この節からは、Railsのすべてのディレクトリを一覧できるテキストエディタまたはIDEが使用できると非常に便利です。残念ながら、テキストエディタや IDEの細かな使用法はそれぞれ異なりますが、どのツールを使ってもRailsアプリケーションのディレクトリを開くことができます。Unix系のシステムでは、ドット<code>.</code>でカレントディレクトリを表現できるので、コマンドライン上で以下を実行してRailsアプリケーションの現在のディレクトリを開き、使用するエディタを呼び出してみてください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects/sample_app
<span class="gp">$</span> &lt;エディタ名&gt; .
</pre></div>
</div>


<p>たとえば、Sublime Text でサンプルアプリケーションを開く場合は、以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> subl .
</pre></div>
</div>


<p>Vimの場合は、種類に応じて<code>vim .</code>、<code>gvim .</code>、<code>mvim .</code>などでエディタを開けます。</p>

<div class="label" id="sec-truly_static_pages"></div>


<h3><a id="sec-3_1_1" href="http://railstutorial.jp/static-pages.html#sec-truly_static_pages" class="heading"><span class="number">3.1.1</span>「本当に」静的なページ</a></h3>


<p>最初に、本当に静的なページを作成してみましょう。<a class="ref" href="http://railstutorial.jp/beginning.html#sec-rails_server">1.2.5</a>で、<code>rails</code>スクリプトを使用して作成した最小限の機能が、あらゆるRailsアプリケーションで利用できることを思い出してください。なお、デフォルトのwelcomeページは<a href="http://localhost:3000/">http://localhost:3000/</a> (<a class="ref" href="http://railstutorial.jp/beginning.html#fig-riding_rails_31">図 1.3</a>) でアクセスできます。</p>

<div class="label" id="fig-public_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/public_index_rails_3.png" alt="public_index_rails_3" /></span></div><div class="caption"><span class="header">図3.2</span><span class="description"><code>public/index.html</code>ファイルの内容。<a href="http://railstutorial.org/images/figures/public_index_rails_3-full.png">(拡大)</a></span></div></div>


<p>このページがどこから来ているかを学ぶために、<code>public/index.html</code> (<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-public_index_rails_3">図 3.2</a>) ファイルを見てみてください。このファイルは、スタイルシートの情報を含んでいるので少し煩雑ですが、このファイルだけでページを描画することができています。これは、Railsはデフォルトで<code>public</code>ディレクトリ内にあるファイルを直接ブラウザに送信しているからです<sup class="footnote" id="fnref-3_5"><a href="http://railstutorial.jp/static-pages.html#fn-3_5">5</a></sup>。またデフォルトでは、今回使われている<code>index.html</code>ファイルについてはURLで<code>index.html</code>と指定する必要はありません。たとえば、URLにhttp://localhost:3000/と入力しても、http://localhost:3000/index.htmlと入力しても、表示される内容は同じです。</p>

<p>もうお気付きかもしれませんが、静的なHTMLファイルを作成して<code>public</code>ディレクトリ内に置けば、<code>index.html</code>と同じように表示することができます。まずは、&quot;Hello, world!&quot; と表示するファイル (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-hello_world">リスト3.3</a>) を作ってみましょう<sup class="footnote" id="fnref-3_6"><a href="http://railstutorial.jp/static-pages.html#fn-3_6">6</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> subl public/hello.html
</pre></div>
</div>


<div class="label" id="code-hello_world"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト 3.3</span> <span class="description">HTMLファイルの典型的な &quot;Hello, World!&quot;。</span><br /><span class="description"> <code>public/hello.html</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Greeting<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Hello, world!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-hello_world">リスト3.3</a>は、典型的な HTML ドキュメントの構造です。たとえば、1行目の<em>document type</em> (doctype とも呼ぶ)  は、使用しているHTMLのバージョンをブラウザに宣言するもので、今回の例では<a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>を使っていることを宣言しています<sup class="footnote" id="fnref-3_7"><a href="http://railstutorial.jp/static-pages.html#fn-3_7">7</a></sup>。また<code>head</code>セクションでは、<code>title</code>タグで &quot;Greeting&quot; と表示しています。最後に<code>body</code>セクションでは、<code>p</code> (paragraph) タグを使って “Hello, world!” と表示しています (なお、HTMLではスペースやタブは無視されるので、インデントはあってもなくても大丈夫です。ただし、インデントがある方がHTMLのデータ構造を理解しやすくなります)。</p>

<p>では、次のコマンドを入力して、ローカル環境でサーバーを起動してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails server
</pre></div>
</div>


<p>次にブラウザで<a href="http://localhost:3000/hello.html">http://localhost:3000/hello.html</a>にアクセスしてみると、先ほど説明したとおり、先ほどpublicディレクトリ以下に作成した静的なHTMLページがRailsによって表示されます (<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-hello_world">図 3.3</a>)。なお、<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-hello_world">図3.3</a>の上部中央にある &quot;Greeting&quot; という文字は、 先ほど <code>title</code> タグで囲った文字列です。</p>

<div class="label" id="fig-hello_world"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/hello_world.png" alt="&quot;hello world&quot;" /></span></div><div class="caption"><span class="header">図3.3</span><span class="description">新しい静的な HTML ファイル。<a href="http://railstutorial.org/images/figures/hello_world-full.png">(拡大)</a></span></div></div>


<p>この静的ファイルはRailsの振る舞いを確かめるためのものなので、サンプルアプリケーションを開発するために必要なファイルではありません。誤って./public/hello.html が参照されてしまうことのないように、以下のように削除しておきましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm public/hello.html
</pre></div>
</div>


<p>ただし、<code>index.html</code>ファイルは後で使うので、当面残しておいてください。もちろん、サンプルアプリケーションのルートURLにアクセスした際に表示されてしまうと困るので、最終的にはこのファイルも削除することになります (<a class="ref" href="http://railstutorial.jp/beginning.html#fig-riding_rails_31">図 1.3</a>)。具体的には、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links">5.3</a>で、<a href="http://localhost:3000/">http://localhost:3000/</a>にアクセスした際に<code>public/index.html</code>以外を参照するようにします。</p>

<div class="label" id="sec-static_pages_with_rails"></div>


<h3><a id="sec-3_1_2" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails" class="heading"><span class="number">3.1.2</span>Railsによる静的なページ</a></h3>


<p>静的なHTMLファイルを返す機能はもちろん必要ですが、動的なWebアプリケーションを作成するにはこれだけでは不足です。この節では、一連のURIを定義する、<em>アクション</em>というRailsの強力なツールを使用して動的なページを作成します<sup class="footnote" id="fnref-3_8"><a href="http://railstutorial.jp/static-pages.html#fn-3_8">8</a></sup>。Railsのアクションは、<em>コントローラ</em> (<a class="ref" href="http://railstutorial.jp/beginning.html#sec-mvc">1.2.6</a>で紹介した MVCの Cに該当) の中に置かれる機能で、共通の目的を持つ一連のアクションをコントローラ内にまとめることができます。コントローラについては<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でも簡単に触れましたが、<a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>で説明する<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST アーキテクチャ</a>を読むと、より深く理解することができます。一言で言うと、コントローラとは (基本的に動的な) Webページの集合を束ねるコンテナのことです。</p>

<p>さっそく動的なページを作ってみましょう。まずは、<a class="ref" href="http://railstutorial.jp/beginning.html#sec-git_commands">1.3.5</a>で紹介したように、Gitを使ってトピックブランチを作ります。今回のように新しい機能やページを作成するときは、masterブランチではなくトピックブランチで作業するのがよいでしょう。Git でバージョン管理をしている場合は、次のコマンドでトピックブランチを作成してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b static-pages
</pre></div>
</div>


<p>Railsには<code>generate</code>というスクリプトがあり、このスクリプトにコントローラ名を入力するだけで、この魔法のようなスクリプトがコントローラを作成してくれます。本章の冒頭でRSpecをインストールしていなかった場合は、この<code>generate</code>を使って以下のようにRSpecをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>これより、複数の静的なページを取り扱うStaticPagesコントローラを作成します。具体的には、HomeページとHelpページ、Aboutページで使用するアクションを作ってみます。<code>generate</code>スクリプトは、任意の数のアクションを引数に取ることができます。まずは、上記の3つのアクションのうち、最初の2つのアクションを作ってみます (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト 3.4</a>)。</p>

<div class="label" id="code-generating_pages"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト 3.4</span> <span class="description">StaticPagesコントローラを生成する。</span> </div>
<div class="code"><div class="highlight"><pre>$ rails generate controller StaticPages home help --no-test-framework
      create  app/controllers/static_pages_controller.rb
       route  get &quot;static_pages/help&quot;
       route  get &quot;static_pages/home&quot;
      invoke  erb
      create    app/views/static_pages
      create    app/views/static_pages/home.html.erb
      create    app/views/static_pages/help.html.erb
      invoke  helper
      create    app/helpers/static_pages_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/static_pages.js.coffee
      invoke    scss
      create      app/assets/stylesheets/static_pages.css.scss
</pre></div>
</div></div>


<p>今回はRSpecのテストを使わないため、<tt class="verb">--no-test-framework</tt>というオプションを付け加えることで、RSpecのテストを自動的に生成しないようにしています。代わりに、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a>からは手動でテストを作成します。また、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト 3.4</a>に示したように、今回は意図的に<code>about</code>アクションをコマンドライン引数から取り除きました。 これは、同じく<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a> から、テスト駆動開発 (Test-Driven Development, TDD) という開発手法を学ぶためです。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト 3.4</a>では、コントローラ名を<a href="https://en.wikipedia.org/wiki/CamelCase">キャメルケース</a> (訳注: 単語の頭文字を大文字にしてつなぎ合わせた名前) で渡していることにご注目ください。こうすると、StaticPagesコントローラは、<a href="https://en.wikipedia.org/wiki/Snake_case">スネークケース</a> (訳注: 単語間にアンダースコアを加えて繋ぎ合わせた名前) のファイル <code>static_pages_controller.rb</code> を自動的に生成します。ただし、上のような命名は単なる慣習に過ぎません。実際、コマンドライン上で以下のようなスネークケースのコントローラ名を入力しても、</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller static_pages ...
</pre></div>
</div>


<p>先ほどと同様に<code>static_pages_controller.rb</code>というコントローラが生成されます。これは、Rubyがクラス名にキャメルケースを使う慣習があり (詳細は<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#sec-ruby_classes">4.4</a>で説明します)、また、キャメルケースの名前を使うことが好まれているためです。これらの慣習に必ず従わなければいけないということではありません。(同様にRubyでは、ファイル名をスネークケースで記述する慣習があります。このため Railsのgenerateスクリプトでは、 <a href="http://api.rubyonrails.org/classes/ActiveSupport/Inflector.html#method-i-underscore"><tt>underscore</tt></a>メソッドを使ってキャメルケースをスネークケースに変換しています。)</p>

<p>ところで、自動生成に失敗するようなことがあれば、元に戻す処理を学ぶ良い機会になります。以下の<a class="ref" href="http://railstutorial.jp/static-pages.html#sidebar-undoing_things">囲み3.1</a>で元に戻す方法を紹介しています。</p>

<div class="label" id="sidebar-undoing_things"></div>


<div class="sidebar"><span class="title"><span class="header">囲み3.1</span></span><span class="title"><span class="description">元に戻す方法</span></span>
<p>どれほど十分に気を付けていたとしても、Railsアプリケーションの開発中に何か失敗してしまうことはありえます。ありがたいことに、Railsにはそのような失敗をカバーする機能がいくつもあります。</p>

<p>一般的なシナリオの1つは、生成したコードを元に戻したい場合です。たとえば、コントローラを生成した後で、もっといいコントローラ名を思い付いた場合などです。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト 3.4</a>に示したように、コントローラを生成すると、コントローラファイル以外にも多数のファイルが作成されます。自動生成されたコードを元に戻すためには、新規作成されたファイルを削除するだけではなく、既存のファイルに挿入されたコードも削除する必要があります (実際、<tt>routes.rb</tt> ファイルに自動的に追加されたコードも元に戻す必要があります) 。このようなときは、<tt>rails destroy</tt>コマンドを実行するだけで元に戻すことができます。たとえば次の2つのコマンドは、自動生成と、それに対応する取り消し処理の例です。</p>

<pre class="verbatim">  $ rails generate controller FooBars baz quux
  $ rails destroy  controller FooBars baz quux</pre>


<p>なお <a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>でも、以下のように<em>モデル</em>を自動生成する方法を紹介します。</p>

<pre class="verbatim">  $ rails generate model Foo bar:string baz:integer</pre>


<p>モデルの自動生成についても、同様の方法で元に戻すことができます。</p>

<pre class="verbatim">  $ rails destroy model Foo</pre>


<p>(上のコマンドからわかるように、モデル名以外の引数は不要です。その理由については<a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>で説明しています)。</p>

<p>また、<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でも簡単に紹介しましたが、<em>マイグレーション</em>の変更を元に戻す方法もあります。詳細は<a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>で説明します。簡単に言うと、まず以下のコマンドでデータベースのマイグレーションを変更できます。</p>

<pre class="verbatim">  $ rake db:migrate</pre>


<p>以下のコマンドで1つ前の状態に戻すことができます。</p>

<pre class="verbatim">  $ rake db:rollback</pre>


<p>最初の状態に戻したい場合は、以下のコマンドを使います。</p>

<pre class="verbatim">  $ rake db:migrate VERSION=0</pre>


<p>既にお気付きの方もいると思いますが、マイグレーションは逐次的に実行され、それぞれのマイグレーションに対してバージョン番号が付与されます。したがって、上記の <tt>0</tt>を別の数字に置き換えることによって、指定したバージョンの状態に戻すことができます。</p>

<p>これらの方法に慣れることで、開発中に<a href="http://en.wikipedia.org/wiki/SNAFU">袋小路</a>に迷い込んでしまった場合でも、これらの機能を使って元の状態に復帰することができます。</p>
</div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト 3.4</a>のように、StaticPagesコントローラを生成すると、<code>config/routes.rb</code>ファイルが自動的に更新されます。Railsは、この <em>routes</em>ファイルに記述されている内容 (ルーティング) に従って、 複数のURIとWebページを対応付けます。ここで、初めて<code>config</code>ディレクトリについて触れます。このディレクトリは<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-config_directory_rails_3">図 3.4</a>のような構成をしています。<code>config</code>ディレクトリという名前のとおり、このディレクトリ内にあるファイルは、Railsがアプリケーションの設定を読み込む時に必要になります。</p>

<div class="label" id="fig-config_directory_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/config_directory_rails_3.png" alt="config_directory_rails_3" /></span></div><div class="caption"><span class="header">図3.4</span><span class="description">サンプルアプリケーションの<code>config</code>ディレクトリの内容。<a href="http://railstutorial.org/images/figures/config_directory_rails_3-full.png">(拡大)</a></span></div></div>


<p>先ほど<code>home</code>アクションと<code>help</code>アクションを生成したので、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_routes">リスト 3.5</a>に示したように、routesファイルにはそれぞれのアクションで使用されるルールが定義されています。</p>

<div class="label" id="code-pages_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.5</span> <span class="description">StaticPagesコントローラ内の<code>home</code>アクションと<code>help</code>アクションで使用するルーティング。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/help&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>ここで以下のルールに注目してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
</pre></div>
</div>


<p>このルールは、/static_pages/homeに対するリクエストを、StaticPagesコントローラの<code>home</code>アクションと結びつけています。具体的には、<code>get</code>と書くことで、<tt>GET</tt>リクエストに対して該当するアクションを結びつけています。なお、ここでいう GETリクエストとは、<em>HTTP (HyperText Transfer Protocol) </em> (<a class="ref" href="http://railstutorial.jp/static-pages.html#sidebar-get_etc">囲み 3.2</a>) が対応しているメソッドの1つです。今回の場合は、StaticPagesコントローラ内に<code>home</code>アクションを追加したので、/static_pages/homeにアクセスすることでページを取得 (GET) できるようになりました。<a href="http://localhost:3000/static_pages/home">/static_pages/home</a>にアクセスして結果を表示します (<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-raw_home_view">図3.5</a>)。</p>

<div class="label" id="fig-raw_home_view"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/raw_home_view_31.png" alt="raw_home_view_31" /></span></div><div class="caption"><span class="header">図3.5</span><span class="description"><a href="http://localhost:3000/static_pages/home">/static_pages/home</a>にアクセスした結果。<a href="http://railstutorial.org/images/figures/raw_home_view_31-full.png">(拡大)</a></span></div></div>




<div class="label" id="sidebar-get_etc"></div>


<div class="sidebar"><span class="title"><span class="header">囲み3.2</span></span><span class="title"><span class="description"><tt>GET</tt>やその他のHTTPメソッドについて</span></span>
<p><a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP</a> (HyperText Transfer Protocol) には4つの基本的な操作があり、それぞれ<em>get</em>、<em>post</em>、<em>put</em>、<em>delete</em>という４つの動詞に対応づけられています。<em>クライアント</em> (通常、FirefoxやSafariなどのウェブブラウザ) と<em>サーバー</em> (ApacheやNginxなどのWebサーバー) は、上で述べた4つの基本操作を互いに認識できるようになっています (ローカル環境でRailsアプリケーションを開発しているときは、クライアントとサーバーが同じコンピュータ上で動いていますが、一般的には、それぞれ別のコンピュータで動作している点を理解しておいてください)。Railsを含む多くのWebフレームワークは、HTTPの各操作を発展させた<em>REST アーキテクチャ</em>の影響を受けています。<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>でも簡単に触れましたが、<a class="ref" href="http://railstutorial.jp/sign-up.html#top">第7章</a>では、より深い内容について学びます。</p>

<p><tt>GET</tt> は、最も頻繁に使用されるHTTP操作で、主にWeb上のデータを<em>読み取る</em>際に使われます。“ページを取得する” という意味のとおり、ブラウザはgoogle.comやwikipedia.orgなどのWebサイトを開くたびに<tt>GET</tt>リクエストを送信します。<tt>POST</tt> は、GETの次によく使用される操作で、ページ上のフォームに入力した値を、ブラウザから送信する時に送られるリクエストです。Railsアプリケーションでは、<tt>POST</tt>リクエストは何かを<em>作成する</em>ときによく使われます (なお本来のHTTPでは、<tt>POST</tt>を更新に使ってもよいとしています)。たとえば、ユーザー登録フォームで新しいユーザを作成するときは、<tt>POST</tt>リクエストを送信します。他にも、<tt>PUT</tt>と <tt>DELETE</tt>という2つの操作があり、それぞれサーバー上の何かを<em>更新</em>したり<em>削除</em>したりするときに使われます。これら2つの操作は、<tt>GET</tt>や<tt>POST</tt>ほどは使用されていません。これは、ブラウザがPUTとDELETEをネイティブでは送信しないからです。しかし、Ruby on Railsなどの多くのWebフレームワークは、ブラウザがこれらの操作のリクエストを<em>送信しているかのように見せかける</em>技術 (偽装) を駆使して、PUTとDELETEという操作を実現しています。</p>
</div>


<p>このページがどのようにして表示されるのかを理解するために、まずはテキストエディタでStaticPagesコントローラを開いてみましょう。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-static_pages_controller">リスト3.6</a>のような内容になっているはずです。ここで、<a class="ref" href="http://railstutorial.jp/a-demo-app.html#top">第2章</a>のUsersコントローラやMicropostsコントローラとは異なり、StaticPagesコントローラは一般的なRESTアクションに対応していないことにご注意ください。これは、静的なページの集合に対しては、適切なアクションと言えます。言い換えると、RESTアーキテクチャは、あらゆる問題に対して最適な解決方法であるとは限らないということです。</p>

<div class="label" id="code-static_pages_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.6</span> <span class="description"><a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト3.4</a>で生成されたStaticPagesコントローラ。</span><br /><span class="description"> <code>app/controllers/static_pages_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">help</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-static_pages_controller">リスト 3.6</a>の<code>class</code>というキーワードから、<code>static_pages_controller.rb</code>は<code>StaticPagesController</code>という<em>クラス</em>を定義していることがわかります。クラスは、<em>関数</em> (<em>メソッド</em>とも呼ばれます) をまとめるときに便利な手法です。今回の例では、<code>def</code>というキーワードを使って、<code>home</code>アクションや<code>help</code>アクションを定義しています。また、山かっこ<code>&lt;</code>は、<code>StaticPagesController</code>が <code>ApplicationController</code>というRailsのクラスを<em>継承</em>していることを示しています。この後も説明しますが、今回作成したページには、Rails特有の機能が多数使用されています (具体的なクラスや継承については、<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#sec-ruby_classes">4.4</a>で詳しく説明します)。</p>

<p>今回のStaticPagesコントローラにあるメソッドは、以下のようにどちらも最初は空になっています。</p>

<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">home</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">help</span>
<span class="k">end</span>
</pre></div>
</div>


<p>純粋なRuby言語であれば、これらのメソッドは何も実行しません。しかし、Railsでは動作が異なります。<code>StaticPagesController</code>はRuby のクラスですが、<code>ApplicationController</code>クラスを継承しているため、StaticPagesControllerのメソッドはRails特有の振る舞いをします。具体的には、/static_pages/homeというURIにアクセスすると、RailsはStaticPagesコントローラを参照し、<code>home</code>アクションに記述されているコードを実行します。その後、そのアクションに対応する<em>ビュー</em> (<a class="ref" href="http://railstutorial.jp/beginning.html#sec-mvc">1.2.6</a>で説明したMVCのVに相当) を出力します。今回の場合、<code>home</code>アクションが空になっているので、/static_pages/homeにアクセスしても、単に対応するビューが出力されるだけになります。では、ビューはどのように出力されるのでしょうか。また、どのビューが表示されるのでしょうか。</p>

<p> <a class="ref" href="http://railstutorial.jp/static-pages.html#code-generating_pages">リスト3.4</a>を注意深く読んでみると、アクションとビューの関係性について理解できるでしょう。<code>home</code>アクションは、<code>home.html.erb</code>というビューに対応しています。<code>.erb</code>の詳細については<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages">3.3</a>で説明しますが、ファイル名に<code>.html</code>が含まれていることから推測できるとおり、基本的にはHTMLと同じような構造になっています (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-raw_home_view">リスト3.7</a>)。</p>

<div class="label" id="code-raw_home_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.7</span> <span class="description">Homeページを出力する、生成されたビュー</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>StaticPages#home<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/static_pages/home.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p><code>help</code>アクションに対応するビューも、上のコードと似ています (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-raw_help_view">リスト3.8</a>)。 </p>

<div class="label" id="code-raw_help_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.8</span> <span class="description">Helpページを出力する、生成されたビュー</span><br /><span class="description"> <code>app/views/static_pages/help.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>StaticPages#help<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/static_pages/help.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>どちらのビューも単なるプレースホルダになっています。トップレベルの見出しが<code>h1</code>タグの中にあり、関連するファイルへの絶対パスが<code>p</code>タグの中に書かれています。<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages">3.3</a>からは、(ほんの少しだけ) 動的なコンテンツを追加しますが、ここで重要なのは「Railsのビューは静的なHTMLで構成されている」という点です。ブラウザから見えるのは常にHTMLなので、ブラウザの側から見れば、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-truly_static_pages">3.1.1</a>のような生のHTMLファイルも、コントローラやアクションを使用して生成されたページも、違いはありません。</p>

<p>以後本章では、HomeページとHelpページのコンテンツを少しだけカスタマイズします。また、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>で先送りにしたAbout ページにもコンテンツを追加していきます。それが終わったら、ページごとに異なるタイトルを表示する、ほんの少しだけ動的なコンテンツを追加します。</p>

<p>次に進む前に、StaticPagesコントローラファイルをGitリポジトリに追加しておきましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Add a StaticPages controller&quot;</span>
</pre></div>
</div>




<div class="label" id="sec-first_tests"></div>


<h2><a id="sec-3_2" href="http://railstutorial.jp/static-pages.html#sec-first_tests" class="heading"><span class="number">3.2</span>最初のテスト</a></h2>


<p><em>Railsチュートリアル</em> では、一字一句間違えることなく最初から正確に実装するのではなく、アプリケーションの振る舞いをテストしながら実装する直観的な手法を採用しています。この開発手法は、テスト駆動開発 (Test-Driven Develpment, TDD) から派生した振舞駆動開発 (Behavior-Driven Development, BDD) として知られています。本書でこれから頻繁に使うツールは、<em>統合テスト (integration test) </em>と<em>単体テスト (unit test) </em>の2つです。統合テストについてはこの節から、単体テストについては<a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>から解説していきます。統合テスト (RSpec では <em>request specs</em> と呼んでいます) は、ユーザがアプリケーションを使う際の一連のアクションをシミュレーションします。統合テストは、アプリケーションの各ページが正常に動作するかどうかをテストしてくれる強力なツールです。手動でブラウザを操作してテストする必要がなくなり、Capybaraを併用すれば自然言語 (英語) に近い文法でテストを記述する事もできます (Capybara以外にも、Cucumberという振舞駆動開発用ツールが有名です。詳細については<a class="ref" href="http://railstutorial.jp/sign-in-sign-out.html#sec-cucumber">8.3</a>で紹介します)。</p>

<p>テスト駆動開発の定義とは、アプリケーションを開発するときに<em>最初に</em>テストを作成し、次にコードを作成することです。この開発手法に慣れるまでには多少時間がかかるかもしれませんが、しかし一度慣れてしまえば大きなメリットを得られます。<em>失敗する</em>テストを最初に書き、テストにパスするコードを次に実装することで、しかるべき振る舞いがテストによって正しく検証されている、という自信が付きます。さらに、この「失敗-実装-成功」という開発サイクルは、「<a href="http://en.wikipedia.org/wiki/Flow_(psychology)">開発フロー</a>」を生み出します。そしてこの開発フローに乗ることで、コーディングが楽しくなり、開発の生産性も向上します。また、テストはアプリケーションのコードに対して<em>クライアント</em>として振る舞うので、ソフトウェア設計の改良につながることも多くなるでしょう。</p>

<p>ただし、テスト駆動開発がどんな仕事に対しても常に正しい手法であるとは限りません。このことは十分に理解しておいてください。「最初にテストを書くべきである」、「テストはひとつひとつの機能を完全にカバーするべきである」、「すべての箇所をテストすべきである」などのような教条的な主張を正当化できる理由はどこにもありません。たとえば、与えられた課題の解決法に今ひとつ確信が持てないときは、(テストを書かずに) まず試しにアプリケーションコードだけを書いてみて、どんな解決方法があるのか模索してみる方が良い結果を得られることもあります (<a href="http://en.wikipedia.org/wiki/Extreme_Programming">エクストリームプログラミング (Extreme Programming, XP)</a> という開発手法では、この模索段階を<em>スパイク (spike) </em>と呼んでいます)。そして解決策が明確になった段階で、テスト駆動開発でコードを清書するという方法もありえます。</p>

<p>この節では、RSpec gemによって提供される<code>rspec</code>コマンドを使ってテストを実行します。この節は素直なつくりになっていますが、物足りないと思う方もいるかもしれません。上級開発者であれば、先に<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-advanced_setup">3.6</a>を読んでシステム設定を完了しておくことをお勧めします。</p>

<div class="label" id="sec-TDD"></div>


<h3><a id="sec-3_2_1" href="http://railstutorial.jp/static-pages.html#sec-TDD" class="heading"><span class="number">3.2.1</span>テスト駆動開発</a></h3>


<p>テスト駆動開発で最初に書く、<em>失敗する</em>テストのことを、一般的なテストツールでは「赤色 (Red)」と表現します (失敗時に表示が赤くなるツールが多いため)。同様に、次に書く、テストにパスするコードのことを「緑色 (Green)」と表現します。最後に、必要に応じてコードをリファクタリング (動作を変えずにコードを改善すること) したりフォームを変更したりします。冗長なコードを削除したりするのもリファクタリングの例です。このサイクルのことを「Red/Green/Refactor」と呼びます。</p>

<p>それでは、テスト駆動開発でいくつかのコンテンツをHomeページに追加してみましょう。トップレベルの見出し (<code>&lt;h1&gt;</code>) に &quot;<code>Sample App</code>&quot; という語を追加する作業もこの中に含まれます。 まず、静的なページに対する統合テスト (request spec) を生成するところから始めましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test static_pages
<span class="go">      invoke  rspec</span>
<span class="go">      create    spec/requests/static_pages_spec.rb</span>
</pre></div>
</div>


<p>これにより、<code>spec/requests</code>ディレクトリに<code>static_pages_spec.rb</code>が生成されます。自動生成される他のコードと同様に、最初のコードは完全ではありません。そこで、テキストエディタで<code>static_pages_spec.rb</code> を開き、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_page_content_spec">リスト 3.9</a>のようにコードを書いてみましょう。</p>

<div class="label" id="code-home_page_content_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.9</span> <span class="description">Homeページの内容をテストするコード。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_page_content_spec">リスト 3.9</a>にあるコードはすべてRubyで書かれています。しかし、Rubyを勉強したことがある人にとっては見慣れない書き方に見えるかもしれません。これは、Rubyの柔軟性の高さを応用して、RSpecがテスト用の独自言語 (<em>Domain-Specific Language, DSL</em>) を定義しているからです。ここで重要なのは、<em>RSpecを使うためにRSpec独自の文法を理解する必要はない</em>ということです。最初のうちは魔法のように見えるかもしれませんが、RSpecやCapybaraは英語に近い形で読めるように設計されています。したがって、<code>generate</code>スクリプトで生成されるテスト例や、本チュートリアルで取り上げるテスト例を読み進めるだけで、英語圏の方ならRSpecの文法を楽に扱えるようになります。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_page_content_spec">リスト3.9</a>には<code>describe</code>というブロックがあり、そのブロック内には <code>it &quot;…&quot; do</code>で始まる<em>テスト例</em>があります。</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>最初の行では、Homeページに対するテストであることを記述しています。これは単なる文字列であり、好きな文字列を使用できます。RSpecはこの文字列を解釈しないので、人間にとってわかりやすい説明をここに書くようにします。次の行では、「<code>/static_pages/home</code>のHomeページにアクセスしたとき、“Sample App”という語が含まれていなければならない」と記述しています。最初の行と同様で、RSpec はダブルクォート (&quot;) で囲まれた文字列を無視しますので、ここにも人間にとってわかりやすい説明文を書きましょう (訳注: 英語で should have...と書くことで、メソッドのitと整合性が取れます)。その次の行について説明します。</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
</pre></div>
</div>


<p>上の行は、Capybaraの<code>visit</code>機能を使って、ブラウザでの<code>/static_pages/home</code>URIへのアクセスをシミュレーションします。</p>

<div class="code"><div class="highlight"><pre><span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
</pre></div>
</div>


<p>その次の行 (上のコード) では、Capybaraの<code>page</code>変数を使って、アクセスした結果のページに正しいコンテンツが表示されていることをテストしています。</p>

<p>テストではさまざまなオプションが使用でき、さらに高度で便利なツールもあります。詳細については<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-advanced_setup">3.6</a>で説明します。今回は、コマンドラインで<code>rspec</code>コマンドを実行してみてましょう (なお、<code>bundle exec</code>をこのコマンドの前に置くことで、<code>Gemfile</code>内で定義された環境でRSpecが実行されるように、明示的に指示することができます<sup class="footnote" id="fnref-3_9"><a href="http://railstutorial.jp/static-pages.html#fn-3_9">9</a></sup>)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>上のコマンドを実行すると、「テストが失敗した」という結果が返ってきます。 結果の表示はシステムによって異なりますが、著者のシステムでは、<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-red_failing_spec">図3.6</a>のように失敗したテストが赤く表示されます<sup class="footnote" id="fnref-3_10"><a href="http://railstutorial.jp/static-pages.html#fn-3_10">10</a></sup>  (このスクリーンショットを撮った時点ではGitのブランチ戦略を取り入れていなかったので、<tt>static-pages</tt>ではなく<tt>master</tt>と表示されていますが、特に深い意図はありません)。</p>

<div class="label" id="fig-red_failing_spec"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/red_failing_spec.png" alt="red_failing_spec" /></span></div><div class="caption"><span class="header">図3.6</span><span class="description">赤く表示されている (失敗した) テスト。<a href="http://railstutorial.org/images/figures/red_failing_spec-full.png">(拡大)</a></span></div></div>


<p>テストにパスするために、自動生成されたHomeページのHTMLを<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_page_passing">リスト3.10</a>のように書き換えてみましょう。</p>

<div class="label" id="code-home_page_passing"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.10</span> <span class="description">テストにパスするHomeページ用コード。</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  This is the home page for the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  sample application.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>トップレベルの見出し (<code>&lt;h1&gt;</code>) が<code>Sample App</code>に変更されたため、上のコードはテストにパスします。また、<em>アンカー</em>タグ <code>a</code> を使って、指定したURIにジャンプする以下のリンクを追加しました (ちなみにアンカータグ内の “href” は “hypertext reference” と読みます)。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>結果を見るために、もう一度テストを実行してみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>著者のシステムでは、<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-green_passing_spec">図3.7</a>のように表示されました。</p>

<div class="label" id="fig-green_passing_spec"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/green_passing_spec.png" alt="green_passing_spec" /></span></div><div class="caption"><span class="header">図3.7</span><span class="description">緑色で表示されている (成功した) テスト。<a href="http://railstutorial.org/images/figures/green_passing_spec-full.png">(拡大)</a></span></div></div>


<p>Helpページについても、Homeページの例を参考にして、同じようなテストとアプリケーションコードを使用できることが推測できます。最初に、文字列を <code>’Help’</code> に書き換えたテストを追加してみましょう (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_content_spec">リスト 3.11</a>)。</p>

<div class="label" id="code-help_content_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.11</span> <span class="description">Helpページの内容をテストするコードを追加する。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>上のコードでテストを実行してみます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>テストのうち、1つは失敗するはずです。(注: 執筆作業軽減のため、今後はRSpecの出力結果を掲載しません。画面表示の内容はシステムによって大きく異なるうえ、各段階での出力画面数を把握してメンテナンスし続けるのがきわめて困難なためです。ご了承ください。)</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_page_passing">リスト3.12</a>に示したように、テストにパスするアプリケーションコード (現時点では生のHTML) は<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_page_passing">リスト3.10</a>と同じようなコードになります。</p>

<div class="label" id="code-help_page_passing"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.12</span> <span class="description">テストにパスする、Helpページ用のコード。</span><br /><span class="description"> <code>app/views/static_pages/help.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Get help on the Ruby on Rails Tutorial at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
  To get help on this sample app, see the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>これでテストにパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<div class="label" id="sec-adding_a_page"></div>


<h3><a id="sec-3_2_2" href="http://railstutorial.jp/static-pages.html#sec-adding_a_page" class="heading"><span class="number">3.2.2</span>ページの追加</a></h3>


<p>先ほどのテスト駆動開発のシンプルなテスト例を参考に、もう少し複雑なタスクを実行するページを新規追加してみましょう。具体的には、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>で意図的に先送りにしたAboutページを新しく追加します。段階ごとにテストを作成してRSpecを実行することで、テスト駆動開発によってアプリケーション開発を進める方法を理解できるようになるでしょう。</p>

<div class="label" id="sec-red"></div>


<h4><a id="sec-3_2_2_1" href="http://railstutorial.jp/static-pages.html#sec-red" class="heading">赤 (Red)</a></h4>


<p>赤色から緑色にするために、最初にAboutページ用の失敗するテストを書き、赤色にしましょう。 <a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_content_spec">リスト3.11</a>を参考にすることで、正しいテストを推測できるでしょう(<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_page_content_spec">リスト3.13</a>)。</p>

<div class="label" id="code-about_page_content_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.13</span> <span class="description"> Aboutページのテストを追加する。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the content &#39;About Us&#39;&quot;</span> <span class="k">do</span> 
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_content</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="sec-green"></div>


<h4><a id="sec-3_2_2_2" href="http://railstutorial.jp/static-pages.html#sec-green" class="heading">緑 (Green)</a></h4>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>で触れたように、Railsでは、アクションと、それに対応するページ名を持つビューを作成することで、静的なページを生成することができます。今回の場合、 Aboutページを使用できるようにするには、<code>about</code>アクションをStaticPagesコントローラの中に追加する必要があります。最初に失敗するテストを書き、次にそのテストにパスするように実装することで、正常に動作するAboutページを作成できたという実感を得ることができます。</p>

<p>先ほど実装したRSpecのテストを実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>上を実行した出力結果の中に、以下のような警告が含まれているはずです。</p>

<div class="code"><div class="highlight"><pre>No route matches [GET] &quot;/static_pages/about&quot;
</pre></div>
</div>


<p>このメッセージは、<code>/static_pages/about</code>というルートをroutesファイルに追加する必要があるということを示しています。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_routes">リスト3.5</a>のパターンに従って、routesファイルを<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_route">リスト3.14</a>のように変更することでこの問題は解決します。</p>

<div class="label" id="code-about_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.14</span> <span class="description"><code>about</code>用のルートを追加する。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/help&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/about&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>再び以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>今度は以下のエラーメッセージが発生します。</p>

<div class="code"><div class="highlight"><pre>The action &#39;about&#39; could not be found for StaticPagesController
</pre></div>
</div>


<p>この問題を解決するために、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-static_pages_controller">リスト 3.6</a>の<code>home</code>アクションや <code>help</code>アクションのパターンに従って、StaticPagesコントローラの中に<code>about</code>アクションを追加します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-adding_the_about_page">リスト 3.15</a>)。</p>

<div class="label" id="code-adding_the_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.15</span> <span class="description"><code>about</code>アクションが追加されたStaticPagesコントローラ。</span><br /><span class="description"> <code>app/controllers/static_pages_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">help</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>再び以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>今度は、ビューなどの &quot;テンプレート&quot; が見当たらないというエラーメッセージが表示されます。</p>

<div class="code"><div class="highlight"><pre>ActionView::MissingTemplate:
  Missing template static_pages/about
</pre></div>
</div>


<p>これは、<code>about</code>ビューを追加することで解決します。具体的には、<code>app/views/static_pages</code>ディレクトリの中に<code>about.html.erb</code>というファイルを作成し、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view">リスト 3.16</a>の内容を書き込みます。</p>

<div class="label" id="code-about_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.16</span> <span class="description">Aboutページのコード</span><br /><span class="description"> <code>app/views/static_pages/about.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  is a project to make a book and screencasts to teach web development
  with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
  is the sample application for the tutorial.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>今度は、RSpecを実行すると緑色になるはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>もちろん、実際にブラウザを起動して、テストが正しく動いているかどうかを確かめることもできます (<a class="ref" href="http://railstutorial.jp/static-pages.html#fig-about_us">図3.8</a>)。</p>

<div class="label" id="fig-about_us"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/about_us_2nd_edition.png" alt="about_us_2nd_edition" /></span></div><div class="caption"><span class="header">図3.8</span><span class="description">作成したAboutページ (<a href="http://localhost:3000/static_pages/about">/static_pages/about</a>)。<a href="http://railstutorial.org/images/figures/about_us_2nd_edition-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-refactor"></div>


<h4><a id="sec-3_2_2_3" href="http://railstutorial.jp/static-pages.html#sec-refactor" class="heading">リファクタリング</a></h4>


<p>テストが緑色になったので、安心してコードをリファクタリングできるようになりました。多くの場合、コードを書き進めるうちに肥大化したり繰り返しが増えたりして、いつしか「悪臭を放つ」醜悪なコードになりはてるものです。コードが醜くてもコンピュータはそのことを気にかけませんが、開発者にとってはそうはいきません。だからこそ、頻繁にリファクタリングを実施し、コードを清潔な状態に保ち続けることが重要です。この点において、良いテストコードがあるということは非常に貴重です。リファクタリングする際にバグが混入する可能性を劇的に小さくしてくれるからです。</p>

<p>サンプルアプリケーションはかなり小規模なので、今のところリファクタリングの余地はありません。しかしコードの「悪臭」はやがてあらゆる箇所からただよいはじめ、そのうちにリファクタリングが必要になることでしょう。実際、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-layouts">3.3.4</a>で早くもリファクタリングに取りかかることになります。</p>

<div class="label" id="sec-slightly_dynamic_pages"></div>


<h2><a id="sec-3_3" href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages" class="heading"><span class="number">3.3</span>少しだけ動的なページ</a></h2>


<p>以上で、静的ページのアクションとビューを作成しました。次は、ページの内容を反映したタイトルを持ち、ページごとに内容が変化する、<em>少しだけ</em>動的なページを作成してみましょう。
タイトルを変えることが<em>本当に</em>動的コンテンツかどうかは議論の余地があると思いますが、いずれにしろこのページは、<a class="ref" href="http://railstutorial.jp/sign-up.html#top">第7章</a>で紹介する真に動的なコンテンツの基礎となります。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a>のテスト駆動開発の説明を読んでいない場合は、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_route">リスト3.14</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-adding_the_about_page">リスト3.15</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view">リスト3.16</a>のコードを使ってAboutページを必ず作成しておいてください。</p>

<div class="label" id="sec-testing_a_title_change"></div>


<h3><a id="sec-3_3_1" href="http://railstutorial.jp/static-pages.html#sec-testing_a_title_change" class="heading"><span class="number">3.3.1</span>タイトル変更をテストする</a></h3>


<p>ここでの目標は、Home、Help、Aboutページをそれぞれ編集し、ページごとに異なるタイトルが表示されるようにすることです。ここではビューの<code>&lt;title&gt;</code>タグの内容を変更します。タイトルタグは、ほとんどのブラウザでウィンドウの上に表示されます (Google Chromeは例外ですが)。タイトルタグは、検索エンジン最適化 (SEO) においても重要な役割を担っています。最初にタイトルのテストを作成し、次にタイトルを追加し、さらに<em>レイアウト</em>ファイルを使ってリファクタリングと重複の排除を行います。</p>

<p>レイアウトファイルは、<code>rails new</code>コマンドを実行していれば既に作成されているはずです。レイアウトファイルの役割についてはこの後説明しますが、まずは作業開始前にレイアウトファイルのファイル名を変更しておきましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mv app/views/layouts/application.html.erb foobar   <span class="c"># 一時的な変更</span>
</pre></div>
</div>


<p>(<code>mv</code>はUnixのコマンドです。Windowsでファイル名を変更するには、ファイルブラウザから行うか、<code>rename</code>コマンドを使ってください)。実際のアプリケーション開発時には、上のような操作を行うことはおそらくないでしょう。ここでは、レイアウトファイルの役割をよりわかりやすく説明するために、最初にレイアウトファイルを無効にしました。</p>

<div class="label" id="table-static_pages"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_center"><strong>ページ</strong></th><th class="align_left"><strong>URI</strong></th><th class="align_left"><strong>基本タイトル</strong></th><th class="align_left"><strong>追加タイトル</strong></th></tr><tr class="top_bar"><td class="align_center">Home</td><td class="align_left">/static_pages/home</td><td class="align_left"><code>&quot;Ruby on Rails Tutorial Sample App&quot;</code></td><td class="align_left"><code>&quot;Home&quot;</code></td></tr><tr><td class="align_center">Help</td><td class="align_left">/static_pages/help</td><td class="align_left"><code>&quot;Ruby on Rails Tutorial Sample App&quot;</code></td><td class="align_left"><code>&quot;Help&quot;</code></td></tr><tr><td class="align_center">About</td><td class="align_left">/static_pages/about</td><td class="align_left"><code>&quot;Ruby on Rails Tutorial Sample App&quot;</code></td><td class="align_left"><code>&quot;About&quot;</code></td></tr></table></div><div class="caption"><span class="header">表3.1</span><span class="description">サンプルアプリケーションの (ほぼ) 静的なページ。</span></div></div>


<p>この節が完了するまでに、3つの静的ページのすべてのタイトルが、“Ruby on Rails Tutorial Sample App | Home”のように、最後の単語のみ<a class="ref" href="http://railstutorial.jp/static-pages.html#table-static_pages">テーブル3.1</a>に従ってページごとに変更されるようになります。最初に、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_page_content_spec">リスト3.13</a>のテストを元に、モデルに応じたタイトル表示のテスト (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-title_test">リスト3.17</a>) を追加します。</p>

<div class="label" id="code-title_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.17</span> <span class="description">タイトルのテスト。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
  <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
  <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>このテストでは<code>have_selector</code>メソッドを使っています。これは与えられた内容の中にHTML要素 (セレクタ) があることをチェックしています。つまり、以下のコードは、</p>

<div class="code"><div class="highlight"><pre><span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                  <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p><code>title</code>タグの内容が以下のとおりになっていることを確認します。</p>

<div class="code"><div class="highlight"><pre><span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span>
</pre></div>
</div>


<p>(<code>:text =&gt; &quot;…&quot;</code>のように、<em>ハッシュ</em>のキーに<em>シンボル</em>を使う記法については<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#sec-hashes_and_symbols">4.3.3</a>で解説します)。ここで注意していただきたいのは、与えられた内容に対して完全一致する文字列を使用しなくてはならないということではなく、以下のように部分文字列を指定するだけでもよいということです。</p>

<div class="code"><div class="highlight"><pre><span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>上のコードでもタイトル全体とマッチします。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-title_test">リスト 3.17</a>では<code>have_selector</code>を2行に分けていることにご注目ください。これは、改行の有無に影響されないというRubyの記法を生かしたものです<sup class="footnote" id="fnref-3_11"><a href="http://railstutorial.jp/static-pages.html#fn-3_11">11</a></sup>。行を分割した<em>理由</em>は、1行を80字以内に収めてソースコードを読みやすくするためです<sup class="footnote" id="fnref-3_12"><a href="http://railstutorial.jp/static-pages.html#fn-3_12">12</a></sup>。現状では、それでもこのコードは読みにくいままですが、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises">3.5</a>でより見やすくなるようにリファクタリングをします。また、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-pretty_rspec">5.3.4</a>で最新版のRspecの機能を使ってStaticPagesのテストを完全に書き換えます。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-title_test">リスト3.17</a>と同じ要領で、StaticPagesのテストに3つの静的ページのテストを追加します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト3.18</a>)。</p>

<div class="label" id="code-pages_controller_spec_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.18</span> <span class="description">タイトルのテストを含むStaticPagesコントローラのspecファイル。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Home&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Help&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | About Us&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>上のコードでは、<code>have_content</code>を<code>have_selector(’h1’, …)</code>に変更していることにご注目ください。変更した理由を考えてみてください (<em>ヒント:</em> もしタイトルに &#39;Help&#39; という文字が含まれていて、<code>h1</code>のタグの内容が &#39;Helf&#39; だったら何が起こるでしょうか)。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト 3.18</a>の内容を反映後、以下を実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>今度はテストが赤色 (テストが失敗する) になるはずです。</p>

<div class="label" id="sec-passing_title_tests"></div>


<h3><a id="sec-3_3_2" href="http://railstutorial.jp/static-pages.html#sec-passing_title_tests" class="heading"><span class="number">3.3.2</span>タイトルのテストをパスさせる</a></h3>


<p>今度は、タイトルのテストがパスするようにし、それと同時にWebページを正しく表示させるためのHTMLをすべて追加しましょう。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-hello_world">リスト3.3</a>の &quot;hellp&quot; ページにある基本的なHTMLの骨組みを使って、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_full_html">リスト3.19</a>のHomeページを作るところから始めましょう。</p>

<div class="label" id="code-home_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.19</span> <span class="description">完全なHTML構造を備えたHomeページのビュー</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_full_html">リスト 3.19</a>では<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト 3.18</a>にある以下のテスト済みのタイトルを使います。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>従って、Homeページのテストはパスするはずです。HelpとAboutのテストはまだ赤色 (失敗) の状態ですので、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_view_full_html">リスト 3.20</a>と<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view_full_html">リスト 3.21</a>のようにコードを追加してテストを緑色 (成功) にします。</p>

<div class="label" id="code-help_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.20</span> <span class="description">完全なHTML構造を備えたHelpページのビュー</span><br /><span class="description"> <code>app/views/static_pages/help.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Help<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Get help on the Ruby on Rails Tutorial at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
      To get help on this sample app, see the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code-about_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.21</span> <span class="description">完全なHTML構造を備えたAboutページのビュー</span><br /><span class="description"> <code>app/views/static_pages/about.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | About Us<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec-embedded_ruby"></div>


<h3><a id="sec-3_3_3" href="http://railstutorial.jp/static-pages.html#sec-embedded_ruby" class="heading"><span class="number">3.3.3</span>埋め込みRuby</a></h3>


<p>この節ではこれまでに、Railsのコントローラとアクションを使って3つの有効なページを生成することでさまざまなことを達成しました。しかしそれらは単純な静的ページであり、またRailsの能力を十分に発揮できていません。しかも、コードが甚だしく重複しています。</p>

<ul>
<li>ページのタイトルがどれもほぼ同じ (完全にではないが)。</li>
<li>“Ruby on Rails Tutorial Sample App” が3つのタイトルで共通している。</li>
<li>HTMLの構造全体が各ページで重複している。</li>
</ul>


<p>このようなコードの重複は、「重複してはならない」(Don’t Repeat Yourself, DRY) という重要な原則に反しています。以後、この節と次の節では重複を取り除き、コードをDRYにしていきます。</p>

<p>上の話と一見矛盾するようですが、最初に、現在のほとんど同じページのタイトルを、<em>完全に</em>同じになるようなコードを追加していきます。こうすることで、すべての重複を一気に取り除くことがより簡単になるからです。</p>

<p>重複を取り除くテクニックの一つとして、ビューで<em>埋め込みRuby</em> (Embedded Ruby) を使用できます。Home、Help、Aboutページには可変の要素があるので、Railsの<code>provide</code>関数を使用してタイトルをページごとに異なるようにします。それでは、<code>home.html.erb</code>ビューのコードを、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_erb_title">リスト3.22</a>のように、タイトルに含まれる&quot;Home&quot;という文字を置き換え、動作を確認しましょう。</p>

<div class="label" id="code-home_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.22</span> <span class="description">タイトルにRubyを埋め込んだHomeページのビュー</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Home&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_erb_title">リスト3.22</a>は、<em>ERb</em>と呼ばれている、Rubyの埋め込みの最初の例です (これで、HTMLビューのファイルの拡張子が<code>.html.erb</code>となっている理由をおわかりいただけたと思います)。 ERbはウェブページに動的な要素を加えるときに使うテンプレートシステムです<sup class="footnote" id="fnref-3_13"><a href="http://railstutorial.jp/static-pages.html#fn-3_13">13</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Home&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>上のコードに<tt class="verb">&lt;% ... %&gt;</tt>と書かれていることにご注目ください。Railsはこの中で<code>provide</code>関数を呼び出し、<code>:title</code>というラベルに <code>’Home’</code> という文字列を関連付けます<sup class="footnote" id="fnref-3_14"><a href="http://railstutorial.jp/static-pages.html#fn-3_14">14</a></sup>。次に、以下のコードでRubyの<code>yield</code>関数を使用し、それを<tt class="verb">&lt;%= ... %&gt;</tt>表記 (上と微妙に異なることにご注目ください) で囲むことにより、テンプレートにタイトルを挿入します<sup class="footnote" id="fnref-3_15"><a href="http://railstutorial.jp/static-pages.html#fn-3_15">15</a></sup>。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>(この2つの埋め込みRubyの違いは次のとおりです。<tt class="verb">&lt;% ... %&gt;</tt>と書く、中に書かれたコードを<em>単に実行し</em>、何も出力しませんが、<tt class="verb">&lt;%= ... %&gt;</tt>と等号を追加して書くと、中のコードが実行され、その結果がテンプレートに<em>挿入され</em>ます)。この変更を行なっても、表示されるページの内容は以前とまったく同じです。タイトルの可変部分がERbによって動的に生成されている点だけが異なります。</p>

<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-testing_a_title_change">3.3.1</a>のテストを実行することで、変更が正しく行われたことを確認できます。以下を実行してテストがパスすることを確認しましょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>続いて、HelpページとAboutページも同様に変更します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_view_erb_title">リスト3.23</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view_erb_title">リスト3.24</a>)。</p>

<div class="label" id="code-help_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.23</span> <span class="description">タイトルで埋め込みRubyを使用したHelpページのビュー</span><br /><span class="description"> <code>app/views/static_pages/help.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Get help on the Ruby on Rails Tutorial at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
      To get help on this sample app, see the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code-about_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.24</span> <span class="description">タイトルで埋め込みRubyを使用したAboutページのビュー</span><br /><span class="description"> <code>app/views/static_pages/about.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec-layouts"></div>


<h3><a id="sec-3_3_4" href="http://railstutorial.jp/static-pages.html#sec-layouts" class="heading"><span class="number">3.3.4</span>レイアウトを使って重複を解消する</a></h3>


<p>タイトルの可変部分をERbを使って置き換えたので、現在それぞれのページはだいたい以下のようになっています。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Foo&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      Contents
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>


<p>これを見ると、唯一の例外である<code>body</code>タグの内容を除き、<em>すべて</em>のページで (titleタグの内容を含め) 同じ構造になっていることがわかります。</p>

<p>Railsには、共通の構造をまとめるための<code>application.html.erb</code>という特別な<em>レイアウト</em>ファイルがあります。このファイル名は<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-testing_a_title_change">3.3.1</a>で変更してあったので、以下のように元に戻します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mv foobar app/views/layouts/application.html.erb
</pre></div>
</div>


<p>このレイアウトファイルを有効にするには、デフォルトのタイトル部分を以下の埋め込みRubyのコードに差し替えます。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>その結果、レイアウトファイルは<a class="ref" href="http://railstutorial.jp/static-pages.html#code-application_layout">リスト3.25</a>のようになります。</p>

<div class="label" id="code-application_layout"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.25</span> <span class="description">サンプルアプリケーションのレイアウトファイル。</span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>上のコードにある、以下の特殊なコードにご注目ください。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>このコードは、各ページの内容をレイアウトに挿入するためのものです。ここでは、このコードの詳細な動作を正確に理解することは重要ではありません。レイアウトを使用するうえでは、/static_pages/homeにアクセスすると、<code>home.html.erb</code>の内容がHTMLに変換され、<tt class="verb">&lt;%= yield %&gt;</tt>の位置に挿入されるということだけ理解しておけば問題ありません。</p>

<p>Railsのデフォルトのレイアウトには、以下の行が追加されていることにもご注目ください。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>これらのコードはそれぞれ、スタイルシート、JavaScript、<code>csrf_meta_tags</code>メソッドをページにインクルードするためのものです。スタイルシートとJavaScriptは、アセットパイプライン (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-the_asset_pipeline">5.2.1</a>) の一部です。csrf_meta_tagsは、Web攻撃手法のひとつである<a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">クロスサイトリクエストフォージェリー</a> (cross-site request forgery, CSRF)を防ぐために使われるRailsのメソッドです。</p>

<p>もちろん、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_erb_title">リスト3.22</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_view_erb_title">リスト3.23</a>、 <a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view_erb_title">リスト3.24</a>のビューには、レイアウトと重複するHTMLがまだ残っているので、それらを削除して、内部のコンテツだけ残します。これにより、 <a class="ref" href="http://railstutorial.jp/static-pages.html#code-home_view_interior">リスト3.26</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-help_view_interior">リスト3.27</a>、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-about_view_interior">リスト .28</a>にそれぞれ示したように、ビューのコードが美しく簡潔なものになります。</p>

<div class="label" id="code-home_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.26</span> <span class="description">HTML構造を削除したHomeページ。</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Home&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  This is the home page for the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  sample application.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code-help_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.27</span> <span class="description">HTML構造を削除したHelpページ。</span><br /><span class="description"> <code>app/views/static_pages/help.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Get help on the Ruby on Rails Tutorial at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
  To get help on this sample app, see the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code-about_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.28</span> <span class="description">HTML構造を削除したAboutページ。</span><br /><span class="description"> <code>app/views/static_pages/about.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  The <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  is a project to make a book and screencasts to teach web development
  with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
  is the sample application for the tutorial.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>上のように定義されたビューは、Home、Help、Aboutページの表示は以前と変わりませんが、コードの重複が大きく削減されました。最後に、このリファクタリングが正常に行われたことを確認するために、リファクタリング前と同様にテストにパスすることを確認します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>




<div class="label" id="sec-static_pages_conclusion"></div>


<h2><a id="sec-3_4" href="http://railstutorial.jp/static-pages.html#sec-static_pages_conclusion" class="heading"><span class="number">3.4</span>最後に</a></h2>


<p>傍からは、この章では静的ページを<em>ほぼ</em>静的ページに変えただけで、ほとんど何もしていないように見えることでしょう。しかし、見た目に反して、Railsのコントローラ、アクション、ビューは大きく改善されており、動的なコンテンツを自由にサイトに追加することができるようになりました。皆さんに残されている今後の課題は、このチュートリアルをいかに最後までやりぬくか、それだけであると言ってよいでしょう。</p>

<p>次の章に進む前に、差分をコミットしてマスターブランチにマージしておきましょう。<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>では、静的ページの開発のためのGitブランチを用意しました。ここまでの作業内容をコミットしていなければ、きりのよい中継点に達したことがわかるようにコミットします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Finish static pages&quot;</span>
</pre></div>
</div>


<p>次にmasterブランチに移動し、<a class="ref" href="http://railstutorial.jp/beginning.html#sec-git_commands">1.3.5</a>と同じ要領で差分をマージします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge static-pages
</pre></div>
</div>


<p>このように中継点まで達したら、コードをリモートリポジトリにアップロードしておくとよいでしょう (<a class="ref" href="http://railstutorial.jp/beginning.html#sec-github">1.3.4</a>の手順に従っていれば、リモートリポジトリはGitHubになるでしょう)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>好みに応じて、更新したアプリケーションをHerokuに展開しても構いません。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku
</pre></div>
</div>




<div class="label" id="sec-static_pages_exercises"></div>


<h2><a id="sec-3_5" href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises" class="heading"><span class="number">3.5</span>演習</a></h2>




<ol>

<li>サンプルアプリケーションにContact (問い合わせ先) ページを作成してください。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト3.18</a>に従い、最初に、<code>h1</code>の内容が正しいかどうかを確認するテストを作成することで、URIが/static_pages/contactのページが存在することを確認するテストを作成してください。次に、タイトルが “Ruby on Rails Tutorial Sample App | Contact” となっていることを確認するテストを作成してください。次にこれらのテストにパスするようにしてください。それが終わったら、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-proposed_contact_page">リスト 3.29</a>の内容をContactページに反映させましょう。(この演習の解答は<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links">5.3</a>の説明に含まれています)。</li>

<li>お気付きの方もいると思いますが、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト3.18</a>に示されている、StaticPagesコントローラのspecテストには若干の重複があります。特に、“Ruby on Rails Tutorial Sample App”というタイトルはそれぞれのタイトルのテストで繰り返し記述されています。引数として渡されたシンボルと同名の変数にブロックの評価値を格納する、RSpecの<code>let</code>関数を使い、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_exercise">リスト 3.30</a>のようにテストを変更し、テストにパスするようにしましょう。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_exercise">リスト3.30</a>では文字列の式展開 (<em>string interpolation</em>) が行われていますが、これについては<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#sec-strings">4.2.2</a>で紹介します。</li>

<li><strong>(上級者向け)</strong>「<a href="http://devcenter.heroku.com/articles/how-do-i-use-sqlite3-for-development">Heroku page on using <tt>sqlite3</tt> for development</a>」のページでも説明されているように、互換性の問題によるエラーを最小限にとどめるために、開発/テスト/本番環境で共通のデータベースを使うことは良いことです。「<a href="http://devcenter.heroku.com/articles/local-postgresql">Heroku instructions for local PostgreSQL installation</a>」には、PostgreSQLをローカル環境にインストールする手順が紹介されてます。PostgreSQLを使う場合は、 <a class="ref" href="http://railstutorial.jp/static-pages.html#code-Gemfile_pg_gem">リスト3.31</a>にあるように、<code>Gemfile</code>から<tt>sqlite3</tt> gemを削除し、<tt>pg</tt> gemのみを使うようにしてください。さらに、<code>config/database.yml</code>ファイルと、PostgreSQLをローカル環境で動作させる方法を学ぶ必要があります。以上の情報を元に、PostgreSQLを使用して開発データベースとテストデータベースを作成し、設定を行うことが、この課題のゴールです。<strong>警告: </strong>この演習はかなり難易度が高いので、上級者にのみお勧めします。もし行き詰まってしまったら、すぐにこの演習を飛ばして次の作業に進んでください。なお、既に説明したとおり、このチュートリアルで開発しているサンプルアプリケーションは、SQLiteとPostgreSQLのどちらについても完全に互換性があります。</li>

</ol>




<div class="label" id="code-proposed_contact_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.29</span> <span class="description">Contactページで使用するコンテンツのコード。</span><br /><span class="description"> <code>app/views/static_pages/contact.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/contact&quot;</span><span class="nt">&gt;</span>contact page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code-pages_controller_spec_exercise"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.30</span> <span class="description">基本となるタイトルを含むStaticPagesコントローラのspec。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:base_title</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Home&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/home&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/help&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | Help&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | About Us&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-Gemfile_pg_gem"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.31</span> <span class="description">SQLiteの代わりにPostgreSQLを使う場合の<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>

<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.11.0&#39;</span>
<span class="k">end</span>

<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="sec-advanced_setup"></div>


<h2><a id="sec-3_6" href="http://railstutorial.jp/static-pages.html#sec-advanced_setup" class="heading"><span class="number">3.6</span>高度なセットアップ</a></h2>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-first_tests">3.2</a>でも簡単に説明しましたが、<code>rspec</code>コマンドを直接実行することは実用的ではありません。この節では、最初に<code>bundle exec</code>を毎回コマンドに入力せずに済む方法を紹介します。次に、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-guard">3.6.2</a>でGuardを使用したテストスイートの自動化方法を紹介し、さらに<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-spork">3.6.3</a>でSporkを使用したテストスイートの自動化方法も紹介します。最後に、Sublime Text上で直接テストを実行する方法を紹介します。このテクニックは、特にSporkと併用すると非常に便利です。</p>

<p>この節は、ほとんどが上級者向けの内容になっており、この節を飛ばしても次の章以降には何の影響もありません。この節の内容は先進的ですが、その分、本書の他の内容よりも陳腐化しやすいので、ご利用のシステムでこの節の例が完全に動作するとは限りません。この点をご了承願います。完全に動作させるには、Googleで最新情報を検索して調べることが必要になるでしょう。</p>

<div class="label" id="sec-eliminating_bundle_exec"></div>


<h3><a id="sec-3_6_1" href="http://railstutorial.jp/static-pages.html#sec-eliminating_bundle_exec" class="heading"><span class="number">3.6.1</span><tt>bundle exec</tt>を追放する</a></h3>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-TDD">3.2.1</a>でも簡単に紹介しましたが、<code>rake</code>や<code>rspec</code>コマンドを実行するときには、現在の環境に依存するgemを<code>Gemfile</code>から読み込んでプログラムを実行するために、<code>bundle exec</code>をコマンドの前に追加する必要があります (技術的な理由により、<code>rails</code>コマンドだけは例外です)。この節の作業はかなり厄介です。また、bundle execの入力を省略する方法を2とおりの方法で説明します。</p>

<div class="label" id="sec-rvm_bundler_integration"></div>


<h4><a id="sec-3_6_1_1" href="http://railstutorial.jp/static-pages.html#sec-rvm_bundler_integration" class="heading">RVM Bundler の統合</a></h4>


<p>最初に、お勧めの方法としてRVMを使う方法を紹介します。RVMはバージョン1.11以降からBundlerとの統合が含まれています。最初に、以下に従ってRVMのバージョンを最新にします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm get head <span class="o">&amp;&amp;</span> rvm reload
<span class="gp">$</span> rvm -v

<span class="go">rvm 1.15.6 (master)</span>
</pre></div>
</div>


<p>バージョン1.11.x以降のRVMを使用していれば、インストールされたgemは自動的に適切なBundlerの環境で実行されますので、それ以上何もしなくても以下のようにbundle execを省略してで実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rspec spec/
</pre></div>
</div>


<p><code>bundle exec</code>を省略することができました。 このとおりにできた場合は、この節の残りはスキップしてください。</p>

<p>新しいバージョンのRVMを使うことができない場合は、Ruby Version Managerがローカル環境で自動的に設定する適切な実行ファイルがあれば、<a href="http://rvm.io/integration/bundler/">RVM Bundler integration</a><sup class="footnote" id="fnref-3_16"><a href="http://railstutorial.jp/static-pages.html#fn-3_16">16</a></sup>で<code>bundle exec</code>を省略することができます。一見奇妙ですが、実行方法は簡単です。最初に以下の2つのコマンドを実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm get head <span class="o">&amp;&amp;</span> rvm reload
<span class="gp">$</span> chmod +x <span class="nv">$rvm_path</span>/hooks/after_cd_bundler
</pre></div>
</div>


<p>次に以下のコマンドを実行します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects/sample_app
<span class="gp">$</span> bundle install --without production --binstubs<span class="o">=</span>./bundler_stubs
</pre></div>
</div>


<p>魔法のように見えますが、これらのコマンドでRVMとBundlerを統合できます。そして、<code>rake</code>や<code>rspec</code>などのコマンドを適切な環境で自動的に実行してくれます。<code>bundler_stubs</code>ディレクトリを<code>.gitignore</code>ファイルに追加します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-bundler_stubs_gitignore">リスト3.32</a>)。これらのファイルはローカル環境でしか使用しないためです。</p>

<div class="label" id="code-bundler_stubs_gitignore"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.32</span> <span class="description"><code>.gitignore</code>ファイルに<code>bundler_stubs</code>を追加する。</span> </div>
<div class="code"><div class="highlight"><pre># Ignore bundler config
/.bundle

# Ignore the default SQLite database.
/db/*.sqlite3

# Ignore all logfiles and tempfiles.
/log/*.log
/tmp

# Ignore other unneeded files.
doc/
*.swp
*~
.project
.DS_Store
bundler_stubs/
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-guard">3.6.2</a>の<code>guard</code>など、他の実行ファイルを追加する場合は、<code>bundle install</code>コマンドを再度実行して下さい。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install --binstubs<span class="o">=</span>./bundler_stubs
</pre></div>
</div>




<div class="label" id="sec-binstubs"></div>


<h4><a id="sec-3_6_1_2" href="http://railstutorial.jp/static-pages.html#sec-binstubs" class="heading">binstubオプション</a></h4>


<p>RVMを使用していない場合でも、<code>bundle exec</code>を省略する方法があります。Bundlerは、関連するバイナリを以下のように作成することができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle --binstubs
</pre></div>
</div>


<p>(実は、RVMを使用している場合でも、他のターゲットディレクトリに対してこのコマンドを使用します)。このコマンドは、アプリケーションの<code>bin/</code>ディレクトリに必要な実行ファイルをすべて作ります。これにより、以下のようにテストスイートを実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bin/rspec spec/
</pre></div>
</div>


<p>同様に<code>rake</code>なども以下のように実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bin/rake db:migrate
</pre></div>
</div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-guard">3.6.2</a>の<code>guard</code>など、他の実行ファイルを追加する場合は、<tt class="verb">bundle</tt> <tt class="verb">--binstubs</tt>コマンドを再実行してください。</p>

<p>本書の以後の章では、この節をスキップする方に配慮して明示的に<code>bundle exec</code>を与えてコマンドを実行するようにしています。もちろん、ご利用のシステムが適切に設定されていれば、bundle execを省略しても構いません。</p>

<div class="label" id="sec-guard"></div>


<h3><a id="sec-3_6_2" href="http://railstutorial.jp/static-pages.html#sec-guard" class="heading"><span class="number">3.6.2</span>Guardによるテストの自動化</a></h3>


<p><code>rspec</code>コマンドは、テストのたびにコマンドラインに移動して手動でコマンドを実行しなければならない点が面倒です (もうひとつ、テストスイートの起動が遅いという問題がありますが、これは<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-spork">3.6.3</a>で対応します)。この節では、テストを自動化する<a href="https://github.com/guard/guard">Guard</a>というgemの使い方を紹介します。Guardはファイルシステムの変更を監視し、たとえば<code>static_pages_spec.rb</code>ファイルを変更すると自動的にテストを実行します。さらに、<code>home.html.erb</code>ファイルが変更されると <code>static_pages_spec.rb</code>が自動的に実行されるようにGuardを設定することもできます。</p>

<p>最初に、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-gemfile_guard">リスト3.33</a>のように、<code>guard-rspec</code>を<code>Gemfile</code>に追加します。</p>

<div class="label" id="code-gemfile_guard"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.33</span> <span class="description">サンプルアプリケーションの<code>Gemfile</code>にGuardを追加する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>

<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.11.0&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;guard-rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.1&#39;</span>
<span class="k">end</span>

<span class="c1"># Gems used only for assets and not required</span>
<span class="c1"># in production environments by default.</span>
<span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;3.2.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="k">end</span>

<span class="n">gem</span> <span class="s1">&#39;jquery-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.0.2&#39;</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
  <span class="c1"># System-dependent gems</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:production</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;pg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.12.2&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>次に、システムに依存するgemを以下のようにtestグループに追加します (OS Xユーザーの場合、<a href="http://growl.info/downloads#generaldownloads">Growlとgrowlnotify</a>もインストールする必要があります)。</p>

<div class="code"><div class="highlight"><pre><span class="c1"># Test gems on Macintosh OS X</span>
<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rb-fsevent&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.1&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="kp">false</span>
  <span class="n">gem</span> <span class="s1">&#39;growl&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.3&#39;</span>
<span class="k">end</span> 
</pre></div>
</div>


<div class="code"><div class="highlight"><pre><span class="c1"># Test gems on Linux</span>
<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rb-inotify&#39;</span><span class="p">,</span> <span class="s1">&#39;0.8.8&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;libnotify&#39;</span><span class="p">,</span> <span class="s1">&#39;0.5.9&#39;</span>
<span class="k">end</span> 
</pre></div>
</div>


<div class="code"><div class="highlight"><pre><span class="c1"># Test gems on Windows</span>
<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;capybara&#39;</span><span class="p">,</span> <span class="s1">&#39;1.1.2&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rb-fchange&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.5&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;rb-notifu&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.4&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;win32console&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.0&#39;</span>
<span class="k">end</span> 
</pre></div>
</div>


<p>次に<code>bundle install</code>を実行してgemをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Guardを初期化し、RSpecと一緒に動作するようにします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>guard init rspec
<span class="go">Writing new Guardfile to /Users/mhartl/rails_projects/sample_app/Guardfile</span>
<span class="go">rspec guard added to Guardfile, feel free to edit it</span>
</pre></div>
</div>


<p>結合テストとビューが更新されたら自動的に適切なテストが実行されるように、生成された<code>Guardfile</code>を編集します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-guardfile">リスト3.34</a>)。</p>

<div class="label" id="code-guardfile"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.34</span> <span class="description">デフォルの<code>Guardfile</code>に追記する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;active_support/core_ext&#39;</span>

<span class="n">guard</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:all_after_pass</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/controllers/(.+)_(controller)\.rb$}</span><span class="p">)</span>  <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
    <span class="o">[</span><span class="s2">&quot;spec/routing/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_routing_spec.rb&quot;</span><span class="p">,</span>
     <span class="s2">&quot;spec/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">s/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb&quot;</span><span class="p">,</span>
     <span class="s2">&quot;spec/acceptance/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb&quot;</span><span class="p">,</span>
     <span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="sr">/_pages/</span><span class="o">]</span> <span class="p">?</span> <span class="s2">&quot;spec/requests/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb&quot;</span> <span class="p">:</span> 
                       <span class="s2">&quot;spec/requests/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">singularize</span><span class="si">}</span><span class="s2">_pages_spec.rb&quot;</span><span class="p">)</span><span class="o">]</span>
  <span class="k">end</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^app/views/(.+)/}</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span>
    <span class="p">(</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="sr">/_pages/</span><span class="o">]</span> <span class="p">?</span> <span class="s2">&quot;spec/requests/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">_spec.rb&quot;</span> <span class="p">:</span> 
                       <span class="s2">&quot;spec/requests/</span><span class="si">#{</span><span class="n">m</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">singularize</span><span class="si">}</span><span class="s2">_pages_spec.rb&quot;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>上のコードにある以下の行にご注目ください。</p>

<div class="code"><div class="highlight"><pre><span class="n">guard</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:all_after_pass</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span>
</pre></div>
</div>


<p>これは、失敗したテストが後にパスしたとき、他の余分なテストが実行されないようにするためのものです (Red-Green-Refactorのサイクルを早めるため)。</p>

<p>以上の準備が終われば、以下のコマンドで<code>guard</code>を起動できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>guard
</pre></div>
</div>


<p><code>bundle exec</code>を省略するには、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-eliminating_bundle_exec">3.6.1</a>の手順を再度実行してください。</p>

<p><code>spec/routing</code>ディレクトリが見つからないというエラーが表示された場合は、以下のように空のディレクトリを作ることで回避できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mkdir spec/routing
</pre></div>
</div>




<div class="label" id="sec-spork"></div>


<h3><a id="sec-3_6_3" href="http://railstutorial.jp/static-pages.html#sec-spork" class="heading"><span class="number">3.6.3</span>Spork を使ったテストの高速化</a></h3>


<p><code>bundle exec rspec</code>を実行すると、テストが開始されるまでしばらく時間がかかることにお気付きかもしれません。テストがいったん開始されればすぐに終了します。これは、RSpecを実行するたびにRailsの環境全体を読み込み直す必要があるためです。<a href="http://github.com/sporkrb/spork">Sporkテストサーバー</a><sup class="footnote" id="fnref-3_17"><a href="http://railstutorial.jp/static-pages.html#fn-3_17">17</a></sup>はこの問題を解決するためのものです。Sporkは環境を<em>1回だけ</em>読み込み、今後実行するテストのためのプロセスを管理します。Sporkは<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-guard">3.6.2</a>のGuardと組み合わせるとさらに便利です。</p>

<p>最初に、<code>spork</code>に依存するgemを<code>Gemfile</code>に追加します (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-gemfile_spork">リスト3.35</a>)。</p>

<div class="label" id="code-gemfile_spork"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.35</span> <span class="description">サンプルアプリケーションの<code>Gemfile</code>。</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">gem</span> <span class="s1">&#39;guard-spork&#39;</span><span class="p">,</span> <span class="s1">&#39;1.2.0&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.2&#39;</span>
<span class="k">end</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div>
</div></div>


<p>次に、<code>bundle install</code>でSporkをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>次に、Sporkの設定にbootstrapを指定します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork --bootstrap
</pre></div>
</div>


<p>そして、環境の読み込みを一回で済ますため、<code>spec/spec_helper.rb</code>の中で環境を<em>prefork</em>のブロックで読み込むように、RSpecの設定を変更する必要があります (<a class="ref" href="http://railstutorial.jp/static-pages.html#code-spork_spec_helper">リスト 3.36</a>)。</p>

<div class="label" id="code-spork_spec_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.36</span> <span class="description"><code>Spork.prefork</code>ブロックへの環境読み込みを追加する。</span><br /><span class="description"> <code>spec/spec_helper.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;spork&#39;</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">prefork</span> <span class="k">do</span>
  <span class="c1"># Loading more in this block will cause your tests to run faster. </span><span class="c1">However, </span>
  <span class="c1"># if you change any configuration or code from libraries loaded here, you&#39;ll</span>
  <span class="c1"># need to restart spork for it take effect.</span>
  <span class="c1"># This file is copied to spec/ when you run &#39;rails generate rspec:install&#39;</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;RAILS_ENV&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;test&#39;</span>
  <span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;..</span><span class="s2">/../config/environment&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
  <span class="nb">require</span> <span class="s1">&#39;rspec/rails&#39;</span>
  <span class="nb">require</span> <span class="s1">&#39;rspec/autorun&#39;</span>

  <span class="c1"># Requires supporting ruby files with custom matchers and macros, etc,</span>
  <span class="c1"># in spec/support/ and its subdirectories.</span>
  <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;spec/support/**/*.rb&quot;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="nb">require</span> <span class="n">f</span><span class="p">}</span>

  <span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="c1"># == Mock Framework</span>
    <span class="c1">#</span>
    <span class="c1"># If you prefer to use mocha, flexmock or RR, uncomment the appropriate line:</span>
    <span class="c1">#</span>
    <span class="c1"># config.mock_with :mocha</span>
    <span class="c1"># config.mock_with :flexmock</span>
    <span class="c1"># config.mock_with :rr</span>
    <span class="n">config</span><span class="o">.</span><span class="n">mock_with</span> <span class="ss">:rspec</span>

    <span class="c1"># Remove this line if you&#39;re not using ActiveRecord or ActiveRecord fixtures</span>
    <span class="n">config</span><span class="o">.</span><span class="n">fixture_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="o">::</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/spec/fixtures&quot;</span>

    <span class="c1"># If you&#39;re not using ActiveRecord, or you&#39;d prefer not to run each of your</span>
    <span class="c1"># examples within a transaction, remove the following line or assign false</span>
    <span class="c1"># instead of true.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">true</span>

    <span class="c1"># If true, the base class of anonymous controllers will be inferred</span>
    <span class="c1"># automatically. </span><span class="c1">This will be the default behavior in future versions of</span>
    <span class="c1"># rspec-rails.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">infer_base_class_for_anonymous_controllers</span> <span class="o">=</span> <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">each_run</span> <span class="k">do</span>
  <span class="c1"># This code will be run each time you run your specs.</span>

<span class="k">end</span>
</pre></div>
</div></div>


<p>Sporkを起動する前に、以下のようにテストスイートを実行して、基準となる実行時間を測定します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
<span class="go">......</span>

<span class="go">6 examples, 0 failures</span>

<span class="go">real	0m8.633s</span>
<span class="go">user	0m7.240s</span>
<span class="go">sys	0m1.068s</span>
</pre></div>
</div>


<p>上の実行結果では、実際のテストは1/10秒以下で実行されますが、テストスイートは7秒以上かかっています。実行時間のスピートアップのため、別のターミナルウィンドウを開いてアプリケーションののルートディレクトリに移動し、以下のようにSporkサーバーを起動します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
</pre></div>
</div>


<p><code>bundle exec</code>を省略するには、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-eliminating_bundle_exec">3.6.1</a>の手順を再度実行してください。別のターミナルウィンドウでは、<tt class="verb">--drb</tt> (“distributed Ruby” の略) オプションを追加してテストスイートを実行すると、環境読み込みのオーバーヘッドが大幅に減少していることが確認できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb --drb
<span class="go">......</span>

<span class="go">6 examples, 0 failures</span>

<span class="go">real	0m2.649s</span>
<span class="go">user	0m1.259s</span>
<span class="go">sys	0m0.258s</span>
</pre></div>
</div>


<p><code>rspec</code>を実行するたびに<tt class="verb">--drb</tt>オプションを追加するのは不便なので、アプリケーションのルートディレクトリにある<code>.rspec</code>ファイルに<a class="ref" href="http://railstutorial.jp/static-pages.html#code-rspec_drb">リスト3.37</a>の内容を記載することをお勧めします。</p>

<div class="label" id="code-rspec_drb"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.37</span> <span class="description">自動的にSporkを使うためのRSpecの設定。</span><br /><span class="description"> <code>.rspec</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="o">--</span><span class="n">colour</span>
<span class="o">--</span><span class="n">drb</span>
</pre></div>
</div></div>


<p>Sporkを使う上でひとつ注意があります。preforkで読み込むファイル (たとえば<code>routes.rb</code>) が変更された場合、Sporkサーバーを再起動して新しいRailsの環境を再度読み込む必要があります。パスするはずのテストが失敗した場合は、<tt>Ctrl-C</tt>でSporkサーバーを停止して再起動してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
<span class="go">^C</span>
<span class="gp">$</span> bundle <span class="nb">exec </span>spork
</pre></div>
</div>


<div class="label" id="sec-spork_and_guard"></div>


<h4><a id="sec-3_6_3_1" href="http://railstutorial.jp/static-pages.html#sec-spork_and_guard" class="heading">GuardにSporkを導入する</a></h4>


<p>SporkはGuardと併用すると非常に便利です。設定を行うと、以下のようにコマンド上で併用することができます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>guard init spork
</pre></div>
</div>


<p>そのためには、<a class="ref" href="http://railstutorial.jp/static-pages.html#code-spork_guardfile">リスト3.38</a>に示したように<code>Guardfile</code>を変更する必要があります。</p>

<div class="label" id="code-spork_guardfile"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト3.38</span> <span class="description">Spork向けに<code>Guardfile</code>を更新する。</span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;active_support/core_ext&#39;</span>

<span class="n">guard</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="ss">:rspec_env</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">&#39;RAILS_ENV&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span> <span class="p">}</span> <span class="k">do</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;config/application.rb&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;config/environment.rb&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^config/environments/.</span><span class="sr">+\.rb$}</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="sr">%r{^config/initializers/.</span><span class="sr">+\.rb$}</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;Gemfile&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;Gemfile.lock&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;spec/spec_helper.rb&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;test/test_helper.rb&#39;</span><span class="p">)</span>
  <span class="n">watch</span><span class="p">(</span><span class="s1">&#39;spec/support/&#39;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">guard</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:all_after_pass</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:cli</span> <span class="o">=&gt;</span> <span class="s1">&#39;--drb&#39;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><code>guard</code>の変数に<tt class="verb">:cli =&gt; --drb</tt>が追加されました。この設定により、GuardがコマンドラインインタフェースからSporkサーバーを使うようになります。上の設定には、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#top">第5章</a>から使用する<code>spec/support/</code>ディレクトリを監視するコマンドも追加してあります。</p>

<p>設定が完了したら、以下の<code>guard</code>コマンドでGuardとSporkを同時に起動します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>guard
</pre></div>
</div>


<p>Guardは自動的にSporkサーバーを起動するため、テスト実行時のオーバヘッドを劇的に削減できます。</p>

<p>Guard、Spork、テスト通知機能 (オプション) を使用して便利なテスト環境を構築することで、テスト駆動開発がやみつきになることでしょう。詳細については、<a href="http://railstutorial.org/screencasts">Railsチュートリアルのスクリーンキャスト</a><sup class="footnote" id="fnref-3_18"><a href="http://railstutorial.jp/static-pages.html#fn-3_18">18</a></sup>を参照してください。</p>

<div class="label" id="sec-tests_inside_sublime_text"></div>


<h3><a id="sec-3_6_4" href="http://railstutorial.jp/static-pages.html#sec-tests_inside_sublime_text" class="heading"><span class="number">3.6.4</span>Sublime Text上でテストする</a></h3>


<p>Sublime Textを使用していれば、エディタの中から直接テストを実行できる強力なヘルパーコマンドを利用できます。このコマンドを利用するには、<a href="https://github.com/maltize/sublime-text-2-ruby-tests">Sublime Text 2 Ruby Tests</a><sup class="footnote" id="fnref-3_19"><a href="http://railstutorial.jp/static-pages.html#fn-3_19">19</a></sup>に記載されている、自分の環境向けの説明に従って設定を行なって下さい。著者の環境 (Macintosh OS X) の場合、以下のようにコマンドをインストールします。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/Library/Application<span class="se">\ </span>Support/Sublime<span class="se">\ </span>Text<span class="se">\ </span>2/Packages
<span class="gp">$</span> git clone https://github.com/maltize/sublime-text-2-ruby-tests.git RubyTest
</pre></div>
</div>


<p>参考: <a href="https://github.com/mhartl/rails_tutorial_sublime_text">Rails Tutorial Sublime Text</a><sup class="footnote" id="fnref-3_20"><a href="http://railstutorial.jp/static-pages.html#fn-3_20">20</a></sup>にある説明に従って設定することもできます。</p>

<p>Sublime Textを再起動すると、以下のようなコマンドがRubyTestパッケージによって提供されます。</p>

<ul>
<li><strong>Command-Shift-R</strong>: <code>it</code>ブロック内のテストについては、テストを1回だけ実行します。<code>describe</code>ブロック内のテストについては、一連のテストを実行します。</li>
<li><strong>Command-Shift-E</strong>: 最後に実行したテストを再度実行します。</li>
<li><strong>Command-Shift-T</strong>: 現在のファイルにあるテストをすべて実行します。</li>
</ul>


<p>比較的小さいプロジェクトであってもテストスイートの実行には時間がかかるため、テストを一度に1つだけ実行したり、小規模なテストグループだけを実行したりできるのは大きな長所です。従来のテストでは、たった１つのテストを実行するだけでも、Railsの環境に匹敵するオーバーヘッドが発生してしまいました。このため、上述のテスト用コマンドとSporkの組み合わせは非常に相性が良いのです。Sporkは、テストを実行するたびに発生していたテスト環境起動によるオーバーヘッドを取り除いてくれるため、1つのテストを実行するたびにすべてをテストするのと同程度のオーバーヘッドが発生するようなことがなくなります。個人的には、以下のテスト手順がお勧めです。</p>

<ol>
<li>ターミナルウィンドウでSporkを起動する。</li>
<li>テストを1つ (または小規模なテストグループ) を作成する。</li>
<li>Command-Shift-Rコマンドでテストが失敗することを確認する。</li>
<li>対応するアプリケーションコードを作成する。</li>
<li>Command-Shift-Eコマンドで上のテストと同じテストを実行し、今度は成功することを確認する。</li>
<li>2-5の手順を繰り返す。</li>
<li>中継点 (コミットの直前など) に到達したら、 コマンドラインで<code>rspec spec/</code>を実行してテストスイートをすべて実行し、成功することを確認する。</li>
</ol>


<p>Sublime Textの中からテストが実行できることはもちろん便利ですが、場合によってはGuardの方が便利なこともあると思います。上の手順は、著者が個人的に常用しているテスト駆動開発のテクニックとしてご紹介しました。</p>

<div class="navigation">  <a class="prev_page" href="http://railstutorial.jp/a-demo-app.html#top">
</a><a class="prev_page" href="http://railstutorial.jp/a-demo-app.html#top"><span class="number">第2章</span>デモアプリケーション»</a><a class="prev_page" href="http://railstutorial.jp/a-demo-app.html#top">  </a>
  <a class="next_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top">
</a><a class="next_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top">    <span class="number">第4章</span> Rails風味のRuby</a><a class="next_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top">  </a>
</div><div class="footnotes">
<ol>
<li id="fn-3_1">Capybaraは<em>Webrat</em>の後続プロジェクトであり、世界<a href="http://en.wikipedia.org/wiki/Capybara">最大の齧歯類</a>が名前の由来です。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_1">↑</a></li>
<li id="fn-3_2">なお、<code>install</code>は省略可能です。実は、<code>bundle</code>コマンドは<code>bundle install</code>のエイリアスでもあります。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_2">↑</a></li>
<li id="fn-3_3">システムによっては、<a class="ref" href="http://railstutorial.jp/beginning.html#code-gitignore">リスト1.7</a>の.gitignoreを参考にして、さらに便利な設定にすることもできます。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_3">↑</a></li>
<li id="fn-3_4">https://github.com/railstutorial/sample_app_2nd_ed <a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_4">↑</a></li>
<li id="fn-3_5">実は、これらのファイルに対するリクエストはRails内のスタックに決して到達しないようになっています。そのようなファイルへのリクエストは、ファイルシステムに直接渡されます (詳細については「<a href="http://www.amazon.com/gp/product/0321601661"><em>The Rails 3 Way</em></a>」を参照してください)。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_5">↑</a></li>
<li id="fn-3_6">いつもと同じように、<code>subl</code> コマンドを、使用しているテキストエディタを呼び出すコマンド (vim, emacsなど) に置き換えてください。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_6">↑</a></li>
<li id="fn-3_7">HTMLは常に変化しています。doctypeを明示的に宣言することで、今後もブラウザが正しくページを描画してくれる可能性が高まります。きわめてシンプルなdoctype宣言である<code>&lt;!DOCTYPE html&gt;</code>は、最新の標準HTML (HTML5) であることを示しています。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_7">↑</a></li>
<li id="fn-3_8">ここで静的なページを作るために採用した方法は、おそらく最もシンプルな方法です。ただし他にも方法はあります。最適な方法は状況によって異なり、たとえば<em>きわめて多数</em>の静的なページを1つのStaticPagesコントローラだけまかなおうとすると重荷になる可能性があります。今回はいくつかの静的なページを作るだけなので、重荷にはなりません。Railsで静的なページを作成するテクニックの詳細については、ブログ<a href="http://blog.hasmanythrough.com/2008/4/2/simple-pages">has_many :throughの「<tt>simple pages</tt>」という記事</a>を参照してください。<em>警告:</em> この記事の内容はかなり高度なので、もっと後になって読む方がよいかもしれません。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_8">↑</a></li>
<li id="fn-3_9">毎回<code>bundle exec</code>を追加するのは面倒ですが、<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-advanced_setup">3.6</a>のオプションを使うと省略できます。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_9">↑</a></li>
<li id="fn-3_10">筆者は普段、ターミナルやテキストエディタの背景は黒色にしていますが、明るい色の背景の方がスクリーンショットの見栄えが良いので、(一時的に) 明るい背景を使用しています。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_10">↑</a></li>
<li id="fn-3_11">改行は、行の末尾と次の行の始まりを示します。コードの中では、<tt class="verb">\n</tt>の文字列で表します。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_11">↑</a></li>
<li id="fn-3_12">もちろん、人間がいちいち文字数を<em>数えて</em>いたら頭がどうにかなってしまいます。だからこそ、多くのテキストエディタにはこれらを支援する機能が備わっています。たとえば、<a class="ref" href="http://railstutorial.jp/beginning.html#fig-editor_shell">図1.1</a>をもう一度見てみると、コードを80文字以下に抑えるための小さな縦線が右側に見えます (実際には少し余裕を持たせて78列にしてあります) 。TextMateを使用していれば、<tt>View &gt; Wrap Column &gt; 78</tt>で設定できます。Sublime Textを使用していれば、<tt>View &gt; Ruler &gt; 78</tt>、または<tt>View &gt; Ruler &gt; 80</tt>で設定できます。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_12">↑</a></li>
<li id="fn-3_13">2番目によく使われている<a href="http://haml-lang.com/">Haml</a>というテンプレートシステムもあります。Hamlは個人的に非常に気に入っているのですが、初心者向けのチュートリアルで使うには<em>やや</em>標準から外れています。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_13">↑</a></li>
<li id="fn-3_14">Railsでの開発経験者であれば、この時点で<code>content_for</code>の使用を検討すると思いますが、残念ながらアセットパイプラインと併用すると正常に動作しないことがあります。<code>provide</code>関数はcontent_forの代替です。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_14">↑</a></li>
<li id="fn-3_15">Rubyを勉強したことのある方であれば、Railsはブロックの内容を<em>yield</em>していると推測することでしょう。そして、その推測はおそらく正しいでしょう。しかし、Rails開発のためにこれらの詳細を知る必要はありません。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_15">↑</a></li>
<li id="fn-3_16">http://rvm.io/integration/bundler/ <a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_16">↑</a></li>
<li id="fn-3_17"><em>spork</em>はspoon-forkを組み合わせた造語です。このプロジェクト名は、<a href="http://en.wikipedia.org/wiki/POSIX">POSIX</a>の<a href="http://en.wikipedia.org/wiki/Fork_(software_development)">fork</a>におけるSporkの用法をもじったものです。<a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_17">↑</a></li>
<li id="fn-3_18">http://railstutorial.org/screencasts <a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_18">↑</a></li>
<li id="fn-3_19">https://github.com/maltize/sublime-text-2-ruby-tests <a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_19">↑</a></li>
<li id="fn-3_20">https://github.com/mhartl/rails_tutorial_sublime_text <a class="arrow" href="http://railstutorial.jp/static-pages.html#fnref-3_20">↑</a></li>
</ol>
</div>




</div>
  </body>
</html>
