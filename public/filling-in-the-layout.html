<html dir="ltr">
  <head>
    <title>filling-in-the-layout</title>
    <link rel="stylesheet" href="http://railstutorial.jp/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://railstutorial.jp/polytexnic.css" type="text/css" />
  </head>
  <body dir="ltr">
    <div id="book">

<h1 class="title">Ruby on Rails 3.2 チュートリアル</h1>


<h1 class="subtitle">実例を使ってRailsを学ぼう</h1>


<h2 class="author">Michael Hartl (マイケル・ハートル)</h2>




<h2 class="contents">目次</h2>


<div id="table_of_contents"><ol><li class="chapter"><a href="http://railstutorial.jp/beginning.html#top"><span class="number">第1章</span> ゼロから本番展開まで</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-introduction"><span class="number">1.1</span>はじめに</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-comments_for_various_readers"><span class="number">1.1.1</span>読者の皆さまへ</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_1_2"><span class="number">1.1.2</span> Railsとスケールについて</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-conventions"><span class="number">1.1.3</span>この本における取り決め</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-up_and_running"><span class="number">1.2</span> さっそく動作させる</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-development_tools"><span class="number">1.2.1</span>開発環境</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_1">IDE</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_2">テキストエディタとコマンドライン</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_3">ブラウザ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_2_1_4">使用するツールについて</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-rubygems"><span class="number">1.2.2</span>Ruby、RubyGems、Rails、Git</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-rails_installer_windows">Railsインストーラ (Windows)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_git">Gitのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_ruby">Rubyのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_rubygems">RubyGemsのインストール</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-install_rails">Railsのインストール</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-the_first_application"><span class="number">1.2.3</span>最初のアプリケーション</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-rails_server"><span class="number">1.2.5</span> <tt>rails server</tt></a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-mvc"><span class="number">1.2.6</span>Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-version_control"><span class="number">1.3</span>Gitによるバージョン管理</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-git_setup"><span class="number">1.3.1</span>インストールとセットアップ</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_1_1">初めてのシステム・セットアップ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_1_2">初めてのリポジトリ・セットアップ</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-adding_and_committing"><span class="number">1.3.2</span>追加とコミット</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_3_3"><span class="number">1.3.3</span>Gitのメリット</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-git_commands"><span class="number">1.3.5</span>ブランチ (branch)、変更 (edit)、 コミット (commit)、マージ (merge)</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_branch">ブランチ (branch)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_edit">変更 (edit)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_commit">コミット (commit)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_merge">マージ (merge)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/beginning.html#sec-git_push">プッシュ (push)</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-deploying"><span class="number">1.4</span>展開する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_setup"><span class="number">1.4.1</span> Herokuのセットアップ</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_step_one"><span class="number">1.4.2</span> Herokuに展開する (1)</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-1_4_3"><span class="number">1.4.3</span> Herokuに展開する (2)</a></li><li class="subsection"><a href="http://railstutorial.jp/beginning.html#sec-heroku_commands"><span class="number">1.4.4</span> Heroku コマンド</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/beginning.html#sec-beginning_conclusion"><span class="number">1.5</span> 最後に</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/a-demo-app.html#top"><span class="number">第2章</span>デモアプリケーション</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-planning_the_application"><span class="number">2.1</span> アプリの計画</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-modeling_demo_users"><span class="number">2.1.1</span>ユーザーのモデル設計</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-modeling_demo_microposts"><span class="number">2.1.2</span>マイクロポストのモデル設計</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-demo_users_resource"><span class="number">2.2</span>Users リソース </a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-a_user_tour"><span class="number">2.2.1</span>ユーザページを探検する</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-mvc_in_action"><span class="number">2.2.2</span> MVCの挙動</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-weaknesses_of_this_users_resource"><span class="number">2.2.3</span>Users リソースの欠点</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-microposts_resource"><span class="number">2.3</span>Mircroposts リソース</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-a_micropost_microtour"><span class="number">2.3.1</span>マイクロポストのページを探検する</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-putting_the_micro_in_microposts"><span class="number">2.3.2</span>マイクロポストを<em>マイクロ</em>にする</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-demo_user_has_many_microposts"><span class="number">2.3.3</span>ユーザーとマイクロポストを<tt>has_many</tt>で関連づける</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-inheritance_hierarchies"><span class="number">2.3.4</span>継承の階層</a></li><li class="subsection"><a href="http://railstutorial.jp/a-demo-app.html#sec-deploying_the_demo_app"><span class="number">2.3.5</span>デモアプリケーションの展開</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/a-demo-app.html#sec-2_4"><span class="number">2.4</span>最後に</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/static-pages.html#top"><span class="number">第3章</span>ほぼ静的なページの作成</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages"><span class="number">3.1</span>静的ページ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-truly_static_pages"><span class="number">3.1.1</span>「本当に」静的なページ</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails"><span class="number">3.1.2</span>Railsによる静的なページ</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-first_tests"><span class="number">3.2</span>最初のテスト</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-TDD"><span class="number">3.2.1</span>テスト駆動開発</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-adding_a_page"><span class="number">3.2.2</span>ページの追加</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-red">赤 (Red)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-green">緑 (Green)</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-refactor">リファクタリング</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-slightly_dynamic_pages"><span class="number">3.3</span>ちょっとだけ動的ページ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-testing_a_title_change"><span class="number">3.3.1</span>タイトル変更をテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-passing_title_tests"><span class="number">3.3.2</span>タイトルのテストをパスさせる</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-embedded_ruby"><span class="number">3.3.3</span>組込みRuby</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-layouts"><span class="number">3.3.4</span>レイアウトを使って重複を解消する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_conclusion"><span class="number">3.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises"><span class="number">3.5</span>演習</a></li><li class="section"><a href="http://railstutorial.jp/static-pages.html#sec-advanced_setup"><span class="number">3.6</span>高度なセットアップ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-eliminating_bundle_exec"><span class="number">3.6.1</span><tt>bundle exec</tt>を追放する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-rvm_bundler_integration">RVM Bundler の統合</a></li><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-binstubs">binstubオプション</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-guard"><span class="number">3.6.2</span>Guardによるテストの自動化</a></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-spork"><span class="number">3.6.3</span>Spork を使ったテストの高速化</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/static-pages.html#sec-spork_and_guard">GuardにSporkを導入する</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/static-pages.html#sec-tests_inside_sublime_text"><span class="number">3.6.4</span>Sublime Text上でテストする</a></li></ol></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/rails-flavored-ruby.html#top"><span class="number">第4章</span> Rails風味のRuby</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-motivation"><span class="number">4.1</span>動機</a></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-strings_and_methods"><span class="number">4.2</span>文字列(string)とメソッド</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-comments"><span class="number">4.2.1</span>コメント</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-strings"><span class="number">4.2.2</span>文字列</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-printing">出力</a></li><li class="subsubsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-single_quoted_strings">シングルクォート内の文字列</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-objects_and_message_passing"><span class="number">4.2.3</span>オブジェクトとメッセージ受け渡し</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-method_definitions"><span class="number">4.2.4</span>メソッドの定義</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-back_to_the_title_helper"><span class="number">4.2.5</span> title ヘルパー、再び</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-other_data_structures"><span class="number">4.3</span>他のデータ構造</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-arrays_and_ranges"><span class="number">4.3.1</span>配列と範囲演算子</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-blocks"><span class="number">4.3.2</span>ブロック</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-hashes_and_symbols"><span class="number">4.3.3</span>ハッシュとシンボル</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-css_revisited"><span class="number">4.3.4</span> CSS、再び</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-ruby_classes"><span class="number">4.4</span> Ruby におけるクラス</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-constructors"><span class="number">4.4.1</span>コンストラクタ</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_class_of_our_own"><span class="number">4.4.2</span>クラス継承</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-modifying_built_in_classes"><span class="number">4.4.3</span>組込みクラスの変更</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_controller_class"><span class="number">4.4.4</span>コントローラクラス</a></li><li class="subsection"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-a_user_class"><span class="number">4.4.5</span>ユーザークラス</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-conclusion"><span class="number">4.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-exercises"><span class="number">4.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/filling-in-the-layout.html#top"><span class="number">第5章</span>レイアウトを作成する</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-structure"><span class="number">5.1</span>構造を追加する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-adding_to_the_layout"><span class="number">5.1.1</span>ナビゲーション</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css"><span class="number">5.1.2</span>BootstrapとカスタムCSS</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-partials"><span class="number">5.1.3</span>パーシャル (partial)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline"><span class="number">5.2</span>Sass と asset pipleline</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-the_asset_pipeline"><span class="number">5.2.1</span> asset pipeline</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_1">asset ディレクトリ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_2">マニフェストファイル</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_3">プリプロセッサエンジン</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_4">プロダクション環境での効率性</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass"><span class="number">5.2.2</span>素晴らしい構文を備えたスタイルシート</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_1">ネスト</a></li><li class="subsubsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_2">変数</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links"><span class="number">5.3</span>レイアウトのリンク</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-route_tests"><span class="number">5.3.1</span> ルートのテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-rails_routes"><span class="number">5.3.2</span> Railsのルート</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-named_routes"><span class="number">5.3.3</span>名前付きルート</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-pretty_rspec"><span class="number">5.3.4</span>Pretty RSpec</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-user_signup"><span class="number">5.4</span>ユーザーのサインアップ：最初のステップ</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-users_controller"><span class="number">5.4.1</span>ユーザーコントローラ</a></li><li class="subsection"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-signup_url"><span class="number">5.4.2</span>サインアップURI</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_conclusion"><span class="number">5.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises"><span class="number">5.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/modeling-users.html#top"><span class="number">第6章</span>ユーザーのモデルを作成する</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-user_model"><span class="number">6.1</span> Userモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-database_migrations"><span class="number">6.1.1</span>データベースの移行</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-the_model_file"><span class="number">6.1.2</span>modelファイル</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-model_annotation">モデル注釈</a></li><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-accessible_attributes">アクセス可能な属性</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-creating_user_objects"><span class="number">6.1.3</span>ユーザーオブジェクトを作成する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-finding_user_objects"><span class="number">6.1.4</span>ユーザーオブジェクトを検索する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-updating_user_objects"><span class="number">6.1.5</span>ユーザーオブジェクトを更新する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-user_validations"><span class="number">6.2</span>ユーザーを検証する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-initial_user_tests"><span class="number">6.2.1</span>最初のユーザーテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-presence_validation"><span class="number">6.2.2</span>プレゼンスを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-length_validation"><span class="number">6.2.3</span>長さを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-format_validation"><span class="number">6.2.4</span>フォーマットを検証する</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-uniqueness_validation"><span class="number">6.2.5</span>一意性を検証する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/modeling-users.html#sec-the_caveat">一意性の警告</a></li></ol></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-adding_a_secure_password"><span class="number">6.3</span>セキュアなパスワードを追加する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-an_encrypted_password"><span class="number">6.3.1</span>暗号化されたパスワード</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-password_and_confirmation"><span class="number">6.3.2</span>パスワードと確認</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-user_authentication"><span class="number">6.3.3</span>ユーザー認証</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-has_secure_password"><span class="number">6.3.4</span>ユーザーがセキュアなパスワードを持っている</a></li><li class="subsection"><a href="http://railstutorial.jp/modeling-users.html#sec-creating_a_user"><span class="number">6.3.5</span>ユーザーを作成する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-6_4"><span class="number">6.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/modeling-users.html#sec-6_5"><span class="number">6.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/sign-up.html#top"><span class="number">第7章</span>ユーザー登録</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-showing_users"><span class="number">7.1</span>ユーザーを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-rails_environments"><span class="number">7.1.1</span>デバッグとRails環境</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_users_resource"><span class="number">7.1.2</span>ユーザーリソース</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-tests_with_factories"><span class="number">7.1.3</span>ファクトリーを使用してユーザー表示ページをテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_gravatar_image"><span class="number">7.1.4</span>gravatar画像とサイドバー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_form"><span class="number">7.2</span>ユーザー登録フォーム</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-tests_for_user_signup"><span class="number">7.2.1</span>ユーザー登録のためのテスト</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-using_form_for"><span class="number">7.2.2</span><tt>form_for</tt>を使用する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_form_html"><span class="number">7.2.3</span>フォームHTML</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_failure"><span class="number">7.3</span>ユーザー登録失敗</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-a_working_form"><span class="number">7.3.1</span>正しいフォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-signup_error_messages"><span class="number">7.3.2</span>ユーザー登録のエラーメッセージ</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_success"><span class="number">7.4</span>ユーザー登録成功</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_finished_signup_form"><span class="number">7.4.1</span>登録フォームの完成</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_flash"><span class="number">7.4.2</span>flash</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-the_first_signup"><span class="number">7.4.3</span>実際のユーザー登録</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-up.html#sec-deploying_to_production_with_ssl"><span class="number">7.4.4</span> SSLを導入してプロダクション環境を展開する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-7_5"><span class="number">7.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/sign-up.html#sec-signup_exercises"><span class="number">7.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/sign-in-sign-out.html#top"><span class="number">第8章</span>サインイン、サインアウト</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_failure"><span class="number">8.1</span>セッション、サインインの失敗</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-sessions_controller"><span class="number">8.1.1</span>Sessionコントローラ</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_tests"><span class="number">8.1.2</span>サインインをテストする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_form"><span class="number">8.1.3</span>サインインのフォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-reviewing_form_submission"><span class="number">8.1.4</span>確認フォームを送信する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-rendering_with_a_flash_message"><span class="number">8.1.5</span>フラッシュメッセージをレンダリングする</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_success"><span class="number">8.2、</span>サインイン成功</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-remember_me"><span class="number">8.2.1</span>[このアカウント設定を保存する]</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-a_working_sign_in_method"><span class="number">8.2.2</span>正しい<tt>sign_in</tt>メソッド</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-current_user"><span class="number">8.2.3</span>現在のユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-changing_the_layout_links"><span class="number">8.2.4</span>レイアウトリンクを変更する</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signin_upon_signup"><span class="number">8.2.5</span>ユーザー登録と同時にサインインする</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-signing_out"><span class="number">8.2.6</span>サインアウトする</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-cucumber"><span class="number">8.3</span>Cucumberの紹介(オプション)</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-installation_and_setup"><span class="number">8.3.1</span>インストールと設定</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-features_and_steps"><span class="number">8.3.2</span>機能と手順</a></li><li class="subsection"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-rspec_custom_matchers"><span class="number">8.3.3</span>対比: RSpecのカスタムマッチャー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-8_4"><span class="number">8.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/sign-in-sign-out.html#sec-sign_in_out_exercises"><span class="number">8.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#top"><span class="number">第9章</span> ユーザーの更新・表示・削除</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_users"><span class="number">9.1</span>ユーザーを更新する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-edit_form"><span class="number">9.1.1</span>編集フォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-unsuccessful_edits"><span class="number">9.1.2</span>編集の失敗</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-successful_edits"><span class="number">9.1.3</span>編集の成功</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-authorization"><span class="number">9.2</span>認証</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-requiring_signed_in_users"><span class="number">9.2.1</span>ユーザーのサインインを要求する</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-requiring_the_right_user"><span class="number">9.2.2</span>正しいユーザーを要求する</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-friendly_forwarding"><span class="number">9.2.3</span>フレンドリーフォワーディング</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-showing_all_users"><span class="number">9.3</span>すべてのユーザーを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-user_index"><span class="number">9.3.1</span>ユーザーインデックス</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-sample_users"><span class="number">9.3.2</span>サンプルのユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-pagination"><span class="number">9.3.3</span>ページネーション</a></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-partial_refactoring"><span class="number">9.3.4</span>部分的リファクタリング</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-destroying_users"><span class="number">9.4</span>ユーザを削除する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-administrative_users"><span class="number">9.4.1</span>管理ユーザー</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-revisiting_attr_accessible"><tt>attr_accessible</tt>属性再び</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-the_destroy_action"><span class="number">9.4.2</span> <tt>destroy</tt>アクション</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_and_deleting_users_conclusion"><span class="number">9.5</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/updating-showing-and-deleting-users.html#sec-updating_deleting_exercises"><span class="number">9.6</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/user-microposts.html#top"><span class="number">第10章</span>ユーザーのマイクロポスト</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-a_micropost_model"><span class="number">10.1</span>マイクロポストのモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-the_basic_model"><span class="number">10.1.1</span>基本的なモデル</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-accessible_attribute"><span class="number">10.1.2</span>Accessible属性と最初の検証</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-user_micropost_associations"><span class="number">10.1.3</span>User/Micropostの関連付け</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-ordering_and_dependency"><span class="number">10.1.4</span>マイクロポストを改良する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/user-microposts.html#sec-default_scope">デフォルトのスコープ</a></li><li class="subsubsection"><a href="http://railstutorial.jp/user-microposts.html#sec-dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-micropost_validations"><span class="number">10.1.5</span>コンテンツの検証</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-showing_microposts"><span class="number">10.2</span>マイクロポストを表示する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-augmenting_the_user_show_page"><span class="number">10.2.1</span>ユーザー表示ページの拡張</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-sample_microposts"><span class="number">10.2.2</span>マイクロポストのサンプル</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-manipulating_microposts"><span class="number">10.3</span>マイクロポストを操作する</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-access_control"><span class="number">10.3.1</span>アクセス制御</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-creating_microposts"><span class="number">10.3.2</span>マイクロポストを作成する</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-a_proto_feed"><span class="number">10.3.3</span>フィードの原型</a></li><li class="subsection"><a href="http://railstutorial.jp/user-microposts.html#sec-destroying_microposts"><span class="number">10.3.4</span>マイクロポストを削除する</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-10_4"><span class="number">10.4</span>最後に</a></li><li class="section"><a href="http://railstutorial.jp/user-microposts.html#sec-micropost_exercises"><span class="number">10.5</span>演習</a></li></ol></li><li class="chapter"><a href="http://railstutorial.jp/following-users.html#top"><span class="number">第11章</span>ユーザーをフォローする</a></li><li><ol><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-the_relationship_model"><span class="number">11.1</span>Relationshipのモデル</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_problem_with_the_data_model"><span class="number">11.1.1</span>データモデルの問題 (および解決策)</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-relationship_user_associations"><span class="number">11.1.2</span>User/relationshipの関連付け</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-relationship_validations"><span class="number">11.1.3</span>検証</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-following"><span class="number">11.1.4</span>フォローしているユーザー</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-followers"><span class="number">11.1.5</span>フォローされているユーザー</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-a_web_interface_for_following_and_followers"><span class="number">11.2</span>フォローしているユーザー用のWebインターフェイス</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-sample_following_data"><span class="number">11.2.1</span>フォローしているユーザーのサンプルデータ</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-stats_and_a_follow_form"><span class="number">11.2.2</span>統計とフォロー用フォーム</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-following_and_followers_pages"><span class="number">11.2.3</span>「フォローしている」と「フォローされている」のページ</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_working_follow_button_the_standard_way"><span class="number">11.2.4</span>[フォローする] ボタン (標準的な方法)</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_working_follow_button_with_ajax"><span class="number">11.2.5</span>[フォローする] ボタン (Ajax)</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-the_status_feed"><span class="number">11.3</span>ステータスフィード</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-motivation_and_strategy"><span class="number">11.3.1</span>動機と計画</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-a_first_feed_implementation"><span class="number">11.3.2</span>フィードを初めて実装する</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-scopes_subselects_and_a_lambda"><span class="number">11.3.3</span>サブセレクト</a></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-the_new_status_feed"><span class="number">11.3.4</span>新しいステータスフィード</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-following_conclusion"><span class="number">11.4</span>最後に</a></li><li><ol><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-extensions_to_the_sample_application"><span class="number">11.4.1</span>サンプルアプリケーションの機能を拡張する</a></li><li><ol><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-replies">返信機能</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-messaging">メッセージ機能</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-follower_notifications">フォロワーの通知</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-password_reminders">パスワードリマインダー</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-signup_confirmation">ユーザー登録の確認</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-rss_feed">RSSフィード</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-rest_api">REST API</a></li><li class="subsubsection"><a href="http://railstutorial.jp/following-users.html#sec-search">検索機能</a></li></ol></li><li class="subsection"><a href="http://railstutorial.jp/following-users.html#sec-guide_to_further_resources"><span class="number">11.4.2</span>読み物ガイド</a></li></ol></li><li class="section"><a href="http://railstutorial.jp/following-users.html#sec-following_exercises"><span class="number">11.5</span>演習</a></li></ol></li></ol></div>


<div id="main_content"></div>


<p> <span class="preamble">
</span><span class="preamble"> <span id="foreword">
</span></span><span class="preamble"><span id="foreword"><strong>前書き</strong> </span></span><br /><span class="preamble"><span id="foreword">
</span></span><span class="preamble"><span id="foreword"> </span>
</span><span class="preamble"> </span></p>

<p>私が前にいた会社 (CD Baby) は、かなり早い段階でRuby on Railsに乗り換えたのですが、またPHPに戻ってしまいました (詳細は私の名前をGoogleで検索してみて下さい)。Michael Hartl氏が書いたこの本を強く勧められ、これはやってみなければ、と試した結果、私が再びRailsに乗り換えるに至ったのがこの<em>Ruby on Railsチュートリアル</em>です。</p>

<p>私は多数のRails本を参考にしてきましたが、真の決定版と呼べるものは本書をおいて他にありません。本書ではあらゆる手順が文字通りRails流 (“Rails way”は railway にかけている) で行われており、最初はなかなか慣れませんでしたが、この本を終えた今、ついにこれこそが自然な方式だと感じられるまでになりました。また、本書はRails本の中で唯一、多くのプロが推奨するテスト駆動開発 (TDD: Test Driven Development) 方式を全編を通して実践していて、非常に分かりやすく解説されています。極めつけは、Git、GitHub、そしてHerokuまでも実例に含めた事で、チュートリアルのコード例など実際のプロジェクトの開発プロセスまでも体験できるようになっていることです。チュートリアルのコード例は、どれもチュートリアルと見事に一体化しています。</p>

<p>本書は全体が筋道だったストーリーに貫かれており、非常に素晴らしいものです。私自身、3日間かけて章の終わりにある練習問題もやりながら<em>Railsチュートリアル</em>を一気に読破しました。最初から最後まで、途中を飛ばさずにやるのが一番効果的で有益な読み方です。ぜひやってみて下さい。</p>

<p>是非お試しください。</p>

<p>デレック・シバーズ (<a href="http://sivers.org/">Derek Sivers</a>) (<a href="http://sivers.org/">sivers.org</a>)<br />
<em>元: <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> (創始者)</em> <br />
<em>現在: <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> (創始者) </em> <br /></p>

<p> <span class="preamble">
</span><span class="preamble"><strong>謝辞</strong> </span><br /><span class="preamble">
</span><span class="preamble"> </span></p>

<p><em>Ruby on Rails チュートリアル</em>は、私の以前の著書<em>RailsSpace</em>と、その時の共著者の<a href="http://aure.com/">Aurelius Prochazka</a>に多くを負っています。Aureには、RailsSpaceでの協力と本書への支援も含め、感謝したいと思います。また、<em>RailsSpace</em>と<em>Rails チュートリアル</em>両方の編集を担当して頂いたDebra Williams Cauley氏にも謝意を表したく思います。</p>

<p>私にインスピレーションと知識を与えてくれたRubyistの方々にも感謝したいと思います:David Heinemeier Hansson、 Yehuda Katz、 Carl Lerche、 Jeremy Kemper、 Xavier Noria、 Ryan Bates、 Geoffrey Grosenbach、 Peter Cooper、 Matt Aimonetti、 Gregg Pollack、 Wayne E. Seguin、 Amy Hoy、 Dave Chelimsky、 Pat Maddox、 Tom Preston-Werner、 Chris Wanstrath、 Chad Fowler、 Josh Susser、 Obie Fernandez、 Ian McFarland、 Steven Bristol、 Pratik Naik、 Sarah Mei、 Sarah Allen、 Wolfram Arnold、 Alex Chaffee、 Giles Bowkett、 Evan Dorn、 Long Nguyen、 James Lindenbaum、 Adam Wiggins、 Tikhon Bernstam、 Ron Evans、 Wyatt Greene、 Miles Forrest、 Pivotal Labsの方々、 Herokuの方々、 thoughtbotの方々、 そしてGitHubチーム。最後に、ここに書ききれないほど多くの読者の方々から執筆中にバグ報告や提案を頂き、本書をできる限り良いものにするのに大変役立ちました。<br /></p>

<p> <span class="preamble">
</span><span class="preamble"> <span id="author">
</span></span><span class="preamble"><span id="author"><strong>著者</strong> </span></span><br /><span class="preamble"><span id="author">
</span></span><span class="preamble"><span id="author"> </span>
</span><span class="preamble"> </span></p>

<p><a href="http://michaelhartl.com/">マイケル・ハートル (Michael Hartl)</a> は、<a href="http://ruby.railstutorial.org/"><em>Ruby on Rails</em></a>を使用したweb開発を手ほどきする教材として有名な<a href="http://rubyonrails.org/">Ruby on Rails チュートリアル</a>の著者です。(今ではすっかり古くなってしまいましたが) Railsのチュートリアル本である<em>RailsSpace</em>の著述と開発に携わったことがあり、 一時人気を博したRuby on RailsベースのソーシャルネットワーキングプラットフォームInsoshiも開発していました。2011年、マイケルはRailsコミュニティへの貢献が認められて<a href="http://rubyheroes.com/heroes">Ruby Hero Award</a>を受賞しました。<a href="http://college.harvard.edu/">ハーバード大学</a>卒業後 、<a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">カリフォルニア工科大学</a>で<a href="http://www.caltech.edu/">物理学博士号</a>を取得し、起業プログラム<a href="http://ycombinator.com/">Y Combinator</a>の卒業生でもあります。<br /></p>

<p> <span id="license" class="preamble">
</span><span id="license" class="preamble"><strong>著作権とライセンス</strong> </span><br /><span id="license" class="preamble">
</span><span id="license" class="preamble"> </span></p>

<p><em>Ruby on Rails チュートリアル: 実例を使ってRailsを学ぼう</em>Copyright © 2010 by Michael Hartl.<em>Ruby on Rails チュートリアル</em>内のすべてのソースコードは<a href="http://www.opensource.org/licenses/mit-license.php">MITライセンス</a>および<a href="http://people.freebsd.org/~phk/">Beerwareライセンス</a> の元で提供されています。</p>

<div class="code"><div class="highlight"><pre>(The MIT License)
Copyright (c) 2012 Michael Hartl
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</br>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, </br>WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISINGOUT OF OR </br>IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS INTHE SOFTWARE.</pre></div>
</div>


<div class="code"><div class="highlight"><pre>/*
 * ----------------------------------------------------------------------------
 * &quot;THE BEER-WARE LICENSE&quot; (Revision 42):
 * Michael Hartl wrote this code.As long as you retain this notice you
 * can do whatever you want with this stuff. If we meet some day, and you think
 * this stuff is worth it, you can buy me a beer in return.
 * ----------------------------------------------------------------------------
 */
</pre></div>
</div>


<div id="top"></div>


<h1 class="chapter"><a id="sec-5" href="http://railstutorial.jp/filling-in-the-layout.html#top" class="heading"><span class="number">第5章</span>レイアウトを作成する</a></h1>


<p>この章では、アプリケーションに<em>Bootstrap</em>フレームワークを組み込み、そして、カスタムスタイルを追加します<sup id="fnref-5_1" class="footnote"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_1">1</a></sup>。また、レイアウトに<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-structure" class="ref">5.1</a>までに作成したページへのリンクを追加します。途中で、partials、Railsのルーティング、アッセットパイプラインについて、Sassの紹介を含めて学びます(<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline" class="ref">5.2</a>)。 また、<a href="http://railstutorial.jp/static-pages.html#top" class="ref">第3章</a> で作成したテストを、最新のRSpecテクニックを用いてリファクタリングします。章の最後に、ユーザをサイトにログインさせるための最初の重要なステップを説明します。</p>

<div class="label" id="sec-structure"></div>


<h2><a id="sec-5_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-structure" class="heading"><span class="number">5.1</span>構造を追加する</a></h2>


<p><em>Railsチュートリアル</em>は、ウェブデザインではなく、ウェブ開発に関する本です。しかし、<em>完全な</em>ガラクタのようなアプリケーション上での作業は憂鬱です。そこで、この章では、レイアウトにいくつかの構造とCSSによって最小限のスタイルを追加します。カスタムCSSルールを使用することに加え、Twitter社によるオープンソースのウェブデザインフレームワーク、<a href="http://twitter.github.com/bootstrap/">Bootstrap</a>を利用します。また、<em>コード</em>へスタイルを与えます。言わば、散らかったレイアウトを<em>partials</em>を使用して整えるようなものです。</p>

<p>ウェブアプリケーションを作成するときに、できるだけ早くユーザーインターフェースのおおまかな概要を得ることはとても役立ちます。この本の残りでは、<em>モックアップ</em> (ウェブの文脈ではよく <em>ワイヤーフレーム</em>と呼ばれます) という最終的なアプリケーションがどのように見えるかのラフスケッチのようなものを含みます。<sup id="fnref-5_2" class="footnote"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_2">2</a></sup> この章では、 主に<a href="http://railstutorial.jp/static-pages.html#sec-static_pages" class="ref">3.1</a>で紹介したサイトロゴ、ナビゲーションヘッダー、サイトフッターを含む静的ページを開発します。これらのページの中で最も重要な、Homeページのモックアップは、<a href="http://railstutorial.jp/filling-in-the-layout.html#fig-home_page_mockup" class="ref">図5.1</a>に掲載しています。 その最終結果は、<a href="http://railstutorial.jp/filling-in-the-layout.html#fig-site_with_footer" class="ref">図5.7</a>で確認することができます。そこでは、細部の違いに気がつくでしょう (たとえば、最終的にRailsのロゴをページに追加します)。しかし、モックアップは正確である必要はありませんので、それで十分です。</p>

<div class="label" id="fig-home_page_mockup"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/home_page_mockup_bootstrap.png" alt="home_page_mockup_bootstrap" /></span></div><div class="caption"><span class="header">図5.1: </span><span class="description">サンプルアプリケーションのHomeページモックアップ <a href="http://railstutorial.org/images/figures/home_page_mockup_bootstrap-full.png">(拡大)</a></span></div></div>


<p>普段通り、Gitでバージョン管理をしているのであれば、新しいブランチを作成するのに良いタイミングでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b filling-in-layout
</pre></div>
</div>


<div class="label" id="sec-adding_to_the_layout"></div>


<h3><a id="sec-5_1_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-adding_to_the_layout" class="heading"><span class="number">5.1.1</span>ナビゲーション</a></h3>


<p>第一段階として、サンプルアプリケーションにリンクとスタイルを追加するために、サイトのレイアウトファイル<code>application.html.erb</code>(<a href="http://railstutorial.jp/rails-flavored-ruby.html#code-application_layout_full_title" class="ref">リスト4.3</a>で登場) を追加のHTML構造により更新します。これは、追加の領域、CSSクラス、サイトナビゲーションのスタート地点を含んでいます。完全なファイルは<a href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_new_structure" class="ref">リスト5.1</a>に在り、その後すぐに、種々の部品についての説明がが続きます。いち早く結果を確認したいのであれば、<a href="http://railstutorial.jp/filling-in-the-layout.html#fig-layout_no_logo_or_custom_css" class="ref">図5.2</a>で確認できます。(<em>注:</em>まだ、そこまでイケてはいません。)</p>

<div class="label" id="code-layout_new_structure"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.1</span> <span class="description">追加の構造とサイトのレイアウト</span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">    &lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">    &lt;![endif]</span><span class="c">--&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
          <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
          <span class="nt">&lt;nav&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
              <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
            <span class="nt">&lt;/ul&gt;</span>
          <span class="nt">&lt;/nav&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>まず、注目すべきことの1つは、Ruby 1.8スタイルのハッシュから、Ruby 1.9スタイルへの変更です (<a href="http://railstutorial.jp/rails-flavored-ruby.html#sec-hashes_and_symbols" class="ref">4.3.3</a>)。これが、</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">:media</span> <span class="o">=&gt;</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>以下の記述で置き換えられています。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>旧式のハッシュ構文は、特に古いアプリケーションでは、まだ一般的なので、両方を理解できることは重要です。</p>

<p>では、<a href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_new_structure" class="ref">リスト5.1</a>の他の新しい要素を上から順に見ていきましょう。<a href="http://railstutorial.jp/static-pages.html#sec-static_pages" class="ref">3.1</a>で少し説明されているように、Rails 3はデフォルトで (doctype <code>&lt;!DOCTYPE html&gt;</code>が示すように) HTML5を使用します。HTML5標準は比較的新しいため、ブラウザ (特に、古いバージョンのIE) によっては十分にサポートしていません。この問題を回避するため、(“<a href="http://code.google.com/p/html5shim/">HTML5 shim</a>”として知られる) JavaScriptコードをインクルードします。</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]</span><span class="c">--&gt;</span>
</pre></div>
</div>


<p>ちょっと奇妙なこの構文は、</p>

<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
</pre></div>
</div>


<p>Microsoft Internet Explorer (IE) のバージョンが、9より小さい場合 (<code>if lt IE 9</code>)、囲われている行を実行します。このおかしな文法<code>[if lt IE 9]</code>は、Railsの一部<em>ではありません</em>。これは実は、<a href="http://en.wikipedia.org/wiki/Conditional_comment">条件付きコメント</a>といい、今回のような状況のために Internet Explorer でサポートされています。これは、Firefox、Chrome、Safariなど他のブラウザに影響を与えずに、IEのバージョン9未満に<em>だけ</em>HTML5 shimをインクルードすることができるため、非常に都合が良い考えです。</p>

<p>次のセクションは、サイトのロゴのための<code>header</code>、(<code>div</code>タグによる) いくつかの領域、ナビゲーションリンクのリストを含みます。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div>


<p><code>header</code>タグは、ページのトップに来るべき要素を表しています。この<code>header</code>タグには、スペースで区切られた<code>navbar</code>、<code>navbar-fixed-top</code>、<code>navbar-inverse</code>という3つの<em>CSSクラス</em><sup id="fnref-5_3" class="footnote"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_3">3</a></sup>を与えています。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p>すべてのHTML要素には、クラスと<em>id</em>の両方を指定することができます。これらは単なるラベルで、CSSでのスタイリングに便利です(<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css" class="ref">5.1.2</a>)。クラスとIDの主な違いは、クラスはページの中で複数回使用できるのに対し、IDは一度しか使用することができない点です。今回の場合、すべてのnavbarクラスには、<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css" class="ref">5.1.2</a>でインストールするBootstrapフレームワークにおいて特別な意味があります。</p>

<p><code>header</code>タグの内側には2つの<code>div</code>タグがあります。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>


<p><code>div</code>タグは一般的な領域で、ドキュメントを別々のパーツに分ける以外のことはしません。古いスタイルのHTMLで<code>div</code>タグは、サイトのほぼすべての領域に使用されますが、HTML5は多くのアプリケーションに共通の領域のための要素<code>header</code>、<code>nav</code>、<code>section</code>要素を追加します。この場合、それぞれの<code>div</code>はCSSクラスを持っています。<code>header</code>タグのクラスと同様に、これらのクラスもBootstrapにおいて特別な意味を持っています。</p>

<p>divの後で埋め込まれたRubyに遭遇します。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>ここでは、リンク (<a href="http://railstutorial.jp/static-pages.html#sec-passing_title_tests" class="ref">3.3.2</a>で、アンカータグ<code>a</code>を使用して作成) を生成するために、Rails helperである<code>link_to</code>を使用しています。<code>link_to</code>の第1引数はリンクテキスト、第2引数はURIです。<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-named_routes" class="ref">5.3.3</a>で<em>名前付きルート</em>のURIに変更しますが、今はウェブデザインで一般に使用されるスタブURI<code>’#’</code>にしておきます。第3引数はオプションハッシュで、この場合はサンプルアプリのリンクへCSSのid <code>logo</code>を指定しています。(他の3つのリンクにはオプションハッシュが指定されていませんが、これは任意ですので構いません。) Railsヘルパーは、多くの場合、Railsから離れることなく任意のHTMLオプションを追加するための柔軟性を与え、このようなやり方でオプションのハッシュをとります。</p>

<p>divの内側の2番目の要素は、<em>リストアイテム</em>タグ<code>li</code>と共に<em>順不同リスト</em>タグ<code>ul</code>によって作られた、ナビゲーションリンクのリストです。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>正式にはここでは不要ですが、<code>nav</code>タグはナビゲーションリンクの意図を伝えます。<code>ul</code>タグの<code>nav</code>と<code>pull-right</code>クラスは、Bootstrapにおいて特別な意味を持ちます。ひとたび、Railsがこのレイアウトを処理し、組み込まれたRubyを評価すると、リストは次のように見えます。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;nav&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Help<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Sign in<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
</div>


<p>レイアウトの最後の部分は、メインコンテンツ用の<code>div</code>です。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>


<p>前述のように、<code>container</code>クラスはBootstrapにおいて特別な意味を持ちます。<a href="http://railstutorial.jp/static-pages.html#sec-layouts" class="ref">3.3.4</a>で学んだように、<code>yield</code>メソッドはサイトレイアウトにページ毎の内容を挿入します。</p>

<p><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-partials" class="ref">5.1.3</a>で追加するサイトフッターから離れて、これでレイアウトは完成し、その結果はHomeページへアクセスして確認することができます。今後のスタイル要素を利用するために、<code>home.html.erb</code>ビューに特別な要素を追加します(<a href="http://railstutorial.jp/filling-in-the-layout.html#code-signup_button" class="ref">リスト5.2</a>)。</p>

<div class="label" id="code-signup_button"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.2.</span> <span class="description">ログインページへのリンクがあるHomeページ</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p><a href="http://railstutorial.jp/sign-up.html#top" class="ref">第7章</a>で、サイトにユーザーを追加するのに備えて、最初の<code>link_to</code> は仮のリンクを作成します。</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-large btn-primary&quot;</span><span class="nt">&gt;</span>Sign up now!<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p><code>div</code>タグのCSSクラス<code>hero-unit</code>は、signupボタンの<code>btn</code>、<code>btn-large</code>、<code>btn-primary</code>クラスと同様、Bootstrapにおいて特別な意味を持ちます。</p>

<p>2番目の<code>link_to</code>では、引数として画像ファイルのパスと任意のオプションハッシュをとる<code>image_tag</code>ヘルパーを紹介します。シンボルを使用して、この場合は<code>alt</code>属性をセットしています。スッキリさせるために、このタグが生成するHTMLを見てみましょう。<sup id="fnref-5_4" class="footnote"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">&quot;Rails&quot;</span> <span class="na">src=</span><span class="s">&quot;/assets/rails.png&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>


<p><code>alt</code>属性は、画像が無い場合に代わりに表示され、また、視覚障がいの方用のスクリーンリーダーによって表示されます。HTML標準により実際に必要とされているにも関わらず、時々、画像に<code>alt</code> 属性を付けることを手抜きします。幸いにも、当該属性を指定せずに<code>image_tag</code>を呼び出した場合、Railsは、画像ファイル名 (拡張子を除く) をデフォルトの<code>alt</code>属性として付加します。もっとも、今回は、(先頭大文字の) &quot;Rails&quot;とするために<code>alt</code>テキストを明示的にセットしていますが。</p>

<p>さあ、ついに、労働の成果を確認する準備ができました (<a href="http://railstutorial.jp/filling-in-the-layout.html#fig-layout_no_logo_or_custom_css" class="ref">図5.2</a>)。ひどくつまらないですか？たしかにそうですね。しかし、幸い、CSSでサイトにスタイルを与えるために最適な位置で、HTML要素に実用的なクラスを与える良い仕事をしました。</p>

<p>ところで、<code>rails.png</code>画像が実際に存在することを発見して驚くかもしれません。それはどこから来たのでしょうか？それは、すべての新しいRailsアプリケーションにフリーで含まれており、<code>app/assets/images/rails.png</code>に見つけることができます。<code>image_tag</code>ヘルパーを使用したため、Railsはアセットパイプライン (<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline" class="ref">5.2</a>) により、それを自動的に見つけます。</p>

<div class="label" id="fig-layout_no_logo_or_custom_css"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/layout_no_logo_or_custom_css_bootstrap.png" alt="layout_no_logo_or_custom_css_bootstrap" /></span></div><div class="caption"><span class="header">図5.2: </span>カスタムCSS抜きの<span class="description">Homeページ(<a href="http://localhost:3000/static_pages/home">/static_pages/home</a>)<a href="http://railstutorial.org/images/figures/layout_no_logo_or_custom_css_bootstrap-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-custom_css"></div>


<h3><a id="sec-5_1_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css" class="heading"><span class="number">5.1.2</span>BootstrapとカスタムCSS</a></h3>


<p><a href="http://railstutorial.jp/filling-in-the-layout.html#sec-adding_to_the_layout" class="ref">5.1.1</a>では、たくさんのHTML要素にCSSクラスを関連付けました。それは、CSSベースでレイアウトを構成する上で、大きな柔軟性を与えてくれます。<a href="http://railstutorial.jp/filling-in-the-layout.html#sec-adding_to_the_layout" class="ref">5.1.1</a>で述べたように、これらのクラスの内の多くは、HTML5アプリケーションにナイスなウェブデザインとユーザーインターフェース要素を簡単に追加できるようにするTwitterが作成したフレームワークである<a href="http://twitter.github.com/bootstrap/">Bootstrap</a>特有のものです。このセクションでは、サンプルアプリケーションにスタイルを追加するために、カスタムCSSルールとBootstrapを組み合わせます。</p>

<p>Our first step is to add Bootstrap, which in Rails applications can be accomplished with the <tt>bootstrap-sass</tt> gem, as shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-bootstrap_sass">Listing 5.3</a>. The Bootstrap framework natively uses the <a href="http://lesscss.org/">LESS CSS</a> language for making dynamic stylesheets, but the Rails asset pipeline supports the (very similar) Sass language by default (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">Section 5.2</a>), so <tt>bootstrap-sass</tt> converts LESS to Sass and makes all the necessary Bootstrap files available to the current application.<sup class="footnote" id="fnref-5_5"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_5">5</a></sup></p>

<div class="label" id="code-bootstrap_sass"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.3.</span> <span class="description">Adding the <tt>bootstrap-sass</tt> gem to the <code>Gemfile</code>.</span> </div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.13&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span><span class="p">,</span> <span class="s1">&#39;2.1&#39;</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div>
</div></div>


<p>To install Bootstrap, we run <code>bundle install</code> as usual:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Then restart the web server to incorporate the changes into the development application. (On most systems, restarting the server will involve pressing <tt>Ctrl-C</tt> and then running <code>rails server</code>.)</p>

<p>The first step in adding custom CSS to our application is to create a file to contain it:</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets/custom.css.scss</span>
</pre></div>
</div>


<p>(Use your text editor or IDE to create the new file.) Here both the directory name and filename are important. The directory</p>

<div class="code"><div class="highlight"><pre><span class="go">app/assets/stylesheets</span>
</pre></div>
</div>


<p>is part of the asset pipeline (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline">Section 5.2</a>), and any stylesheets in this directory will automatically be included as part of the <code>application.css</code> file included in the site layout. Furthermore, the filename <code>custom.css.scss</code> includes the <code>.css</code> extension, which indicates a CSS file, and the <code>.scss</code> extension, which indicates a “Sassy CSS” file and arranges for the asset pipeline to process the file using Sass. (We won’t be using Sass until <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass">Section 5.2.2</a>, but it’s needed now for the <tt>bootstrap-sass</tt> gem to work its magic.)</p>

<p>After creating the file for custom CSS, we can use the <code>@import</code> function to include Bootstrap, as shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-bootstrap_css">Listing 5.4</a>.</p>

<div class="label" id="code-bootstrap_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.4.</span> <span class="description">Adding Bootstrap CSS. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
</pre></div>
</div></div>


<p>This one line includes the entire Bootstrap CSS framework, with the result shown in in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-sample_app_only_bootstrap">Figure 5.3</a>. (You may have to use <tt>Ctrl-C</tt> restart the local web server. It’s also worth noting that the screenshots use Bootstrap 2.0, whereas the tutorial currently uses Bootstrap 2.1, so there may be minor differences in appearance. These are not cause for concern.) The placement of the text isn’t good and the logo doesn’t have any style, but the colors and signup button look promising.</p>

<div class="label" id="fig-sample_app_only_bootstrap"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/sample_app_only_bootstrap.png" alt="sample_app_only_bootstrap" /></span></div><div class="caption"><span class="header">Figure 5.3: </span><span class="description">The sample application with Bootstrap CSS. <a href="http://railstutorial.org/images/figures/sample_app_only_bootstrap-full.png">(full size)</a></span></div></div>


<p>Next we’ll add some CSS that will be used site-wide for styling the layout and each individual page, as shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-universal_css">Listing 5.5</a>. There are quite a few rules in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-universal_css">Listing 5.5</a>; to get a sense of what a CSS rule does, it’s often helpful to comment it out using CSS comments, i.e., by putting it inside <code>/* … */</code>, and seeing what changes.
The result of the CSS in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-universal_css">Listing 5.5</a> is shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-sample_app_universal">Figure 5.4</a>.</p>

<div class="label" id="code-universal_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.5.</span> <span class="description">Adding CSS for some universal styling applying to all pages. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_universal"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/sample_app_universal.png" alt="sample_app_universal" /></span></div><div class="caption"><span class="header">Figure 5.4: </span><span class="description">Adding some spacing and other universal styling. <a href="http://railstutorial.org/images/figures/sample_app_universal-full.png">(full size)</a></span></div></div>


<p>Note that the CSS in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-universal_css">Listing 5.5</a> has a consistent form. In general, CSS rules refer either to a class, an id, an HTML tag, or some combination thereof, followed by a list of styling commands. For example,</p>

<div class="code"><div class="highlight"><pre><span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>puts 60 pixels of padding at the top of the page. Because of the <code>navbar-fixed-top</code> class in the <code>header</code> tag, Bootstrap fixes the navigation bar to the top of the page, so the padding serves to separate the main text from the navigation. (Because the default navbar color changed between Boostrap 2.0 and 2.1, we need the <code>navbar-inverse</code> class to make it dark instead of light.) Meanwhile, the CSS in the rule</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>associates the <code>center</code> class with the <code>text-align: center</code> property. In other words, the dot <code>.</code> in <code>.center</code> indicates that the rule styles a class. (As we’ll see in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-logo_css">Listing 5.7</a>, the pound sign <code>#</code> identifies a rule to style a CSS <em>id</em>.) This means that elements inside any tag (such as a <code>div</code>) with class <code>center</code> will be centered on the page. (We saw an example of this class in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-signup_button">Listing 5.2</a>.)</p>

<p>Although Bootstrap comes with CSS rules for nice typography, we’ll also add some custom rules for the appearance of the text on our site, as shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-typography_css">Listing 5.6</a>. (Not all of these rules apply to the Home page, but each rule here will be used at some point in the sample application.) The result of <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-typography_css">Listing 5.6</a> is shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-sample_app_typography">Figure 5.5</a>.</p>

<div class="label" id="code-typography_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.6.</span> <span class="description">Adding CSS for nice typography. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">typography</span> <span class="o">*/</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-sample_app_typography"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/sample_app_typography.png" alt="sample_app_typography" /></span></div><div class="caption"><span class="header">Figure 5.5: </span><span class="description">Adding some typographic styling. <a href="http://railstutorial.org/images/figures/sample_app_typography-full.png">(full size)</a></span></div></div>


<p>Finally, we’ll add some rules to style the site’s logo, which simply consists of the text “sample app”. The CSS in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-logo_css">Listing 5.7</a> converts the text to uppercase and modifies its size, color, and placement. (We’ve used a CSS id because we expect the site logo to appear on the page only once, but you could use a class instead.)</p>

<div class="label" id="code-logo_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.7.</span> <span class="description">Adding CSS for the site logo. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">header</span> <span class="o">*/</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Here <code>color: #fff</code> changes the color of the logo to white. HTML colors can be coded with three pairs of base-16 (hexadecimal) numbers, one each for the primary colors red, green, and blue (in that order). The code <code>#ffffff</code> maxes out all three colors, yielding pure white, and <code>#fff</code> is a shorthand for the full <code>#ffffff</code>. The CSS standard also defines a large number of synonyms for common <a href="http://www.w3schools.com/html/html_colornames.asp">HTML colors</a>, including <code>white</code> for <code>#fff</code>. The result of the CSS in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-logo_css">Listing 5.7</a> is shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-sample_app_logo">Figure 5.6</a>.</p>

<div class="label" id="fig-sample_app_logo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/sample_app_logo.png" alt="sample_app_logo" /></span></div><div class="caption"><span class="header">Figure 5.6: </span><span class="description">The sample app with nicely styled logo. <a href="http://railstutorial.org/images/figures/sample_app_logo-full.png">(full size)</a></span></div></div>




<div class="label" id="sec-partials"></div>


<h3><a id="sec-5_1_3" href="http://railstutorial.jp/filling-in-the-layout.html#sec-partials" class="heading"><span class="number">5.1.3</span>パーシャル (partial)</a></h3>


<p>Although the layout in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_new_structure">Listing 5.1</a> serves its purpose, it’s getting a little cluttered. The HTML shim takes up three lines and uses weird IE-specific syntax, so it would be nice to tuck it away somewhere on its own. In addition, the header HTML forms a logical unit, so it should all be packaged up in one place. The way to achieve this in Rails is to use a facility called <em>partials</em>. Let’s first take a look at what the layout looks like after the partials are defined (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_with_partials">Listing 5.8</a>).</p>

<div class="label" id="code-layout_with_partials"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.8.</span> <span class="description">The site layout with partials for the stylesheets and header. </span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>    
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>In <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_with_partials">Listing 5.8</a>, we’ve replaced the HTML shim stylesheet lines with a single call to a Rails helper called <code>render</code>:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>The effect of this line is to look for a file called  <code>app/views/layouts/_shim.html.erb</code>, evaluate its contents, and insert the results into the view.<sup class="footnote" id="fnref-5_6"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_6">6</a></sup> (Recall that <tt class="verb">&lt;%= ... %&gt;</tt> is the embedded Ruby syntax needed to evaluate a Ruby expression and then insert the results into the template.) Note the leading underscore on the filename <code>_shim.html.erb</code>; this underscore is the universal convention for naming partials, and among other things makes it possible to identify all the partials in a directory at a glance.</p>

<p>Of course, to get the partial to work, we have to fill it with some content; in the case of the shim partial, this is just the three lines of shim code from <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_new_structure">Listing 5.1</a>; the result appears in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-stylesheets_partial">Listing 5.9</a>.</p>

<div class="label" id="code-stylesheets_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.9.</span> <span class="description">A partial for the HTML shim. </span><br /><span class="description"> <code>app/views/layouts/_shim.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="c">&lt;!--[if lt IE 9]&gt;</span>
<span class="c">&lt;script src=&quot;http://html5shim.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;</span>
<span class="c">&lt;![endif]</span><span class="c">--&gt;</span>
</pre></div>
</div></div>


<p>Similarly, we can move the header material into the partial shown in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-header_partial">Listing 5.10</a> and insert it into the layout with another call to <code>render</code>.</p>

<div class="label" id="code-header_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.10.</span> <span class="description">A partial for the site header. </span><br /><span class="description"> <code>app/views/layouts/_header.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>Now that we know how to make partials, let’s add a site footer to go along with the header. By now you can probably guess that we’ll call it <code>_footer.html.erb</code> and put it in the layouts directory (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_partial">Listing 5.11</a>).<sup class="footnote" id="fnref-5_7"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_7">7</a></sup></p>

<div class="label" id="code-footer_partial"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.11.</span> <span class="description">A partial for the site footer. </span><br /><span class="description"> <code>app/views/layouts/_footer.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.org/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>As with the header, in the footer we’ve used <code>link_to</code> for the internal links to the About and Contact pages and stubbed out the URIs with <code>’#’</code> for now. (As with <code>header</code>, the <code>footer</code> tag is new in HTML5.)</p>

<p>We can render the footer partial in the layout by following the same pattern as the stylesheets and header partials (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_with_footer">Listing 5.12</a>).</p>

<div class="label" id="code-layout_with_footer"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.12.</span> <span class="description">The site layout with a footer partial. </span><br /><span class="description"> <code>app/views/layouts/application.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!</span><span class="cp">DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">&lt;%=</span> <span class="n">full_title</span><span class="p">(</span><span class="k">yield</span><span class="p">(</span><span class="ss">:title</span><span class="p">))</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span><span class="p">,</span> <span class="ss">media:</span> <span class="s2">&quot;all&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/shim&#39;</span> <span class="cp">%&gt;</span>    
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/header&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">&#39;layouts/footer&#39;</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Of course, the footer will be ugly without some styling (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_css">Listing 5.13</a>). The results appear in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-site_with_footer">Figure 5.7</a>.</p>

<div class="label" id="code-footer_css"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.13.</span> <span class="description">Adding the CSS for the site footer. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>

<span class="o">/*</span> <span class="nt">footer</span> <span class="o">*/</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
<span class="p">}</span>  

<span class="nt">footer</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span> 
  <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">small</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
  <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">footer</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div></div>




<div class="label" id="fig-site_with_footer"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/site_with_footer_bootstrap.png" alt="site_with_footer_bootstrap" /></span></div><div class="caption"><span class="header">Figure 5.7: </span><span class="description">The Home page (<a href="http://localhost:3000/static_pages/home">/static_pages/home</a>) with an added footer. <a href="http://railstutorial.org/images/figures/site_with_footer_bootstrap-full.png">(full size)</a></span></div></div>




<div class="label" id="sec-sass_and_the_asset_pipeline"></div>


<h2><a id="sec-5_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass_and_the_asset_pipeline" class="heading"><span class="number">5.2</span>Sass と asset pipleline</a></h2>


<p>One of the most notable differences between Rails 3.0 and more recent versions is the asset pipeline, which significantly improves the production and management of static assets such as CSS, JavaScript, and images. This section gives a high-level overview of the asset pipeline and then shows how to use a remarkable tool for making CSS called <em>Sass</em>, now included by default as part of the asset pipeline.</p>

<div class="label" id="sec-the_asset_pipeline"></div>


<h3><a id="sec-5_2_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-the_asset_pipeline" class="heading"><span class="number">5.2.1</span> asset pipeline</a></h3>


<p>The asset pipeline involves lots of changes under Rails’ hood, but from the perspective of a typical Rails developer there are three principal features to understand: asset directories, manifest files, and preprocessor engines.<sup class="footnote" id="fnref-5_8"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_8">8</a></sup> Let’s consider each in turn.</p>

<h4><a id="sec-5_2_1_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_1" class="heading">asset ディレクトリ</a></h4>


<p>In versions of Rails before 3.0 (including 3.0 itself), static assets lived in the <code>public/</code> directory, as follows:</p>

<ul>
<li><code>public/stylesheets</code></li>
<li><code>public/javascripts</code></li>
<li><code>public/images</code></li>
</ul>


<p>Files in these directories are (even post-3.0) automatically served up via requests to http://example.com/stylesheets, etc.</p>

<p>Starting in Rails 3.1, there are <em>three</em> canonical directories for static assets, each with its own purpose:</p>

<ul>
<li><code>app/assets</code>: assets specific to the present application</li>
<li><code>lib/assets</code>: assets for libraries written by your dev team</li>
<li><code>vendor/assets</code>: assets from third-party vendors</li>
</ul>


<p>As you might guess, each of these directories has a subdirectory for each asset class, e.g.,</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> ls app/assets/
<span class="go">images      javascripts stylesheets</span>
</pre></div>
</div>


<p>At this point, we’re in a position to understand the motivation behind the location of the <code>custom.css.scss</code> file in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css">Section 5.1.2</a>: <code>custom.css.scss</code> is specific to the sample application, so it goes in <code>app/assets/stylesheets</code>.</p>

<h4><a id="sec-5_2_1_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_2" class="heading">マニフェストファイル</a></h4>


<p>Once you’ve placed your assets in their logical locations, you can use <em>manifest files</em> to tell Rails (via the <a href="https://github.com/sstephenson/sprockets">Sprockets</a> gem) how to combine them to form single files. (This applies to CSS and JavaScript but not to images.) As an example, let’s take a look at the default manifest file for app stylesheets (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-app_css_manifest">Listing 5.14</a>).</p>

<div class="label" id="code-app_css_manifest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.14.</span> <span class="description">The manifest file for app-specific CSS. </span><br /><span class="description"> <code>app/assets/stylesheets/application.css</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This is a manifest file that&#39;ll automatically include all the stylesheets</span>
<span class="cm"> * available in this directory and any sub-directories. </span><span class="cm">You&#39;re free to add</span>
<span class="cm"> * application-wide styles to this file and they&#39;ll appear at the top of the</span>
<span class="cm"> * compiled file, but it&#39;s generally better to create a new file per style </span>
<span class="cm"> * scope.</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree . </span>
<span class="cm">*/</span>
</pre></div>
</div></div>


<p>The key lines here are actually CSS comments, but they are used by Sprockets to include the proper files:</p>

<div class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> .</span>
<span class="cm"> *= require_self</span>
<span class="cm"> *= require_tree . </span>
<span class="cm">*/</span>
</pre></div>
</div>


<p>Here</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_tree .</span>
</pre></div>
</div>


<p>ensures that all CSS files in the <code>app/assets/stylesheets</code> directory (including the tree subdirectories) are included into the application CSS. The line</p>

<div class="code"><div class="highlight"><pre><span class="go">*= require_self</span>
</pre></div>
</div>


<p>ensures that CSS in <code>application.css</code> is also included.</p>

<p>Rails comes with sensible default manifest files, and in the <em>Rails Tutorial</em> we won’t need to make any changes, but the <a href="http://guides.rubyonrails.org/asset_pipeline.html">Rails Guides entry on the asset pipeline</a> has more detail if you need it.</p>

<h4><a id="sec-5_2_1_3" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_3" class="heading">プリプロセッサエンジン</a></h4>


<p>After you’ve assembled your assets, Rails prepares them for the site template by running them through several preprocessing engines and using the manifest files to combine them for delivery to the browser. We tell Rails which processor to use using filename extensions; the three most common cases are <code>.scss</code> for Sass, <code>.coffee</code> for CoffeeScript, and <code>.erb</code> for embedded Ruby (ERb). We first covered ERb in <a class="ref" href="http://railstutorial.jp/static-pages.html#sec-embedded_ruby">Section 3.3.3</a>, and cover Sass in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass">Section 5.2.2</a>. We won’t be needing CoffeeScript in this tutorial, but it’s an elegant little language that compiles to JavaScript. (The <a href="http://railscasts.com/episodes/267-coffeescript-basics">RailsCast on CoffeeScript basics</a> is a good place to start.)</p>

<p>The preprocessor engines can be chained, so that</p>

<p><code>foobar.js.coffee</code></p>

<p>gets run through the CoffeeScript processor, and</p>

<p><code>foobar.js.erb.coffee</code></p>

<p>gets run through both CoffeeScript and ERb (with the code running from right to left, i.e., CoffeeScript first).</p>

<h4><a id="sec-5_2_1_4" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_1_4" class="heading">プロダクション環境での効率性</a></h4>


<p>One of the best things about the asset pipeline is that it automatically results in assets that are optimized to be efficient in a production application.  Traditional methods for organizing CSS and JavaScript involve splitting functionality into separate files and using nice formatting (with lots of indentation). While convenient for the programmer, this is inefficient in production; including multiple full-sized files can significantly slow page-load times (one of the most important factors affecting the quality of the user experience). With the asset pipeline, in production all the application stylesheets get rolled into one CSS file (<code>application.css</code>), all the application JavaScript code gets rolled into one JavaScript file (<code>javascripts.js</code>), and all such files (including those in <code>lib/assets</code> and <code>vendor/assets</code>) are <em>minified</em> to remove the unnecessary whitespace that bloats file size. As a result, we get the best of both worlds: multiple nicely formatted files for programmer convenience, with single optimized files in production.</p>

<div class="label" id="sec-sass"></div>


<h3><a id="sec-5_2_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-sass" class="heading"><span class="number">5.2.2</span>素晴らしい構文を備えたスタイルシート</a></h3>


<p><em>Sass</em> is a language for writing stylesheets that improves on CSS in many ways. In this section, we cover two of the most important improvements, <em>nesting</em> and <em>variables</em>. (A third technique, <em>mixins</em>, is introduced in <a class="ref" href="http://railstutorial.jp/sign-up.html#sec-rails_environments">Section 7.1.1</a>.)</p>

<p>As noted briefly in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-custom_css">Section 5.1.2</a>, Sass supports a format called SCSS (indicated with a <code>.scss</code> filename extension), which is a strict superset of CSS itself; that is, SCSS only <em>adds</em> features to CSS, rather than defining an entirely new syntax.<sup class="footnote" id="fnref-5_9"><a href="http://railstutorial.jp/filling-in-the-layout.html#fn-5_9">9</a></sup> This means that every valid CSS file is also a valid SCSS file, which is convenient for projects with existing style rules. In our case, we used SCSS from the start in order to take advantage of Bootstrap. Since the Rails asset pipeline automatically uses Sass to process files with the <code>.scss</code> extension, the <code>custom.css.scss</code> file will be run through the Sass preprocessor before being packaged up for delivery to the browser.</p>

<h4><a id="sec-5_2_2_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_1" class="heading">ネスト</a></h4>


<p>A common pattern in stylesheets is having rules that apply to nested elements. For example, in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-universal_css">Listing 5.5</a> we have rules both for <code>.center</code> and for <code>.center h1</code>:</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="nt">h1</span> <span class="p">{</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>We can replace this in Sass with</p>

<div class="code"><div class="highlight"><pre><span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>
</pre></div>
</div>


<p>Here the nested <code>h1</code> rule automatically inherits the <code>.center</code> context.</p>

<p>There’s a second candidate for nesting that requires a slightly different syntax. In <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-logo_css">Listing 5.7</a>, we have the code</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nn">#logo</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Here the logo id <code>#logo</code> appears twice, once by itself and once with the <code>hover</code> attribute (which controls its appearance when the mouse pointer hovers over the element in question). In order to nest the second rule, we need to reference the parent element <code>#logo</code>; in SCSS, this is accomplished with the ampersand character <code>&amp;</code> as follows:</p>

<div class="code"><div class="highlight"><pre><span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#fff</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Sass changes <code>&amp;:hover</code> into <code>#logo:hover</code> as part of converting from SCSS to CSS.</p>

<p>Both of these nesting techniques apply to the footer CSS in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_css">Listing 5.13</a>, which can be transformed into the following:</p>

<div class="code"><div class="highlight"><pre><span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="mh">#eaeaea</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="mh">#555</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span> 
      <span class="na">color</span><span class="o">:</span> <span class="mh">#222</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>  
  <span class="nt">small</span> <span class="p">{</span> 
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span> 
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Converting <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_css">Listing 5.13</a> by hand is a good exercise, and you should verify that the CSS still works properly after the conversion.</p>

<h4><a id="sec-5_2_2_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-5_2_2_2" class="heading">変数</a></h4>


<p>Sass allows us to define <em>variables</em> to eliminate duplication and write more expressive code. For example, looking at <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-typography_css">Listing 5.6</a> and <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_css">Listing 5.13</a>, we see that there are repeated references to the same color:</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>In this case, <code>#999</code> is a light gray, and we can give it a name by defining a variable as follows:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
</pre></div>
</div>


<p>This allows us to rewrite our SCSS like this:</p>

<div class="code"><div class="highlight"><pre><span class="nv">$lightGray</span><span class="o">:</span> <span class="mh">#999</span><span class="p">;</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$lightGray</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Because variable names such as <code>$lightGray</code> are more descriptive than <code>#999</code>, it’s often useful to define variables even for values that aren’t repeated. Indeed, the Bootstrap framework defines a large number of variables for colors, available online on the <a href="http://bootstrapdocs.com/v2.0.4/docs/less.html">Bootstrap page of LESS variables</a>. That page defines variables using LESS, not Sass, but the <tt>bootstrap-sass</tt> gem provides the Sass equivalents. It is not difficult to guess the correspondence; where LESS uses an “at” sign <code>@</code>, Sass uses a dollar sign <code>$</code>. Looking the Bootstrap variable page, we see that there is a variable for light gray:</p>

<div class="code"><div class="highlight"><pre> <span class="k">@grayLight</span><span class="nd">:</span> <span class="nn">#999</span><span class="o">;</span>
</pre></div>
</div>


<p>This means that, via the <tt>bootstrap-sass</tt> gem, there should be a corresponding SCSS variable <code>$grayLight</code>. We can use this to replace our custom variable, <code>$lightGray</code>, which gives</p>

<div class="code"><div class="highlight"><pre><span class="nt">h2</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nc">.</span>
<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">.</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>


<p>Applying the Sass nesting and variable definition features to the full SCSS file gives the file in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-refactored_scss">Listing 5.15</a>. This uses both Sass variables (as inferred from the Bootstrap LESS variable page) and built-in named colors (i.e., <code>white</code> for <code>#fff</code>). Note in particular the dramatic improvement in the rules for the <code>footer</code> tag.</p>

<div class="label" id="code-refactored_scss"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 5.15.</span> <span class="description">The initial SCSS file converted to use nesting and variables. </span><br /><span class="description"> <code>app/assets/stylesheets/custom.css.scss</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>

<span class="cm">/* mixins, variables, etc. */</span>

<span class="nv">$grayMediumLight</span><span class="o">:</span> <span class="mh">#eaeaea</span><span class="p">;</span>

<span class="cm">/* universal */</span>

<span class="nt">html</span> <span class="p">{</span>
  <span class="na">overflow-y</span><span class="o">:</span> <span class="no">scroll</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span> <span class="p">{</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">60</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">section</span> <span class="p">{</span>
  <span class="na">overflow</span><span class="o">:</span> <span class="no">auto</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">textarea</span> <span class="p">{</span>
  <span class="na">resize</span><span class="o">:</span> <span class="n">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.center</span> <span class="p">{</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="nt">h1</span> <span class="p">{</span>
    <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* typography */</span>

<span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h1</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">3</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-2</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">h2</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">margin-bottom</span><span class="o">:</span> <span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">text-align</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">normal</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">p</span> <span class="p">{</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.1</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* header */</span>

<span class="nn">#logo</span> <span class="p">{</span>
  <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
  <span class="na">margin-right</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-size</span><span class="o">:</span> <span class="mi">1</span><span class="mf">.7</span><span class="kt">em</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
  <span class="na">text-transform</span><span class="o">:</span> <span class="no">uppercase</span><span class="p">;</span>
  <span class="na">letter-spacing</span><span class="o">:</span> <span class="mi">-1</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">9</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">font-weight</span><span class="o">:</span> <span class="no">bold</span><span class="p">;</span>
  <span class="na">line-height</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
    <span class="na">text-decoration</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* footer */</span>

<span class="nt">footer</span> <span class="p">{</span>
  <span class="na">margin-top</span><span class="o">:</span> <span class="mi">45</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">padding-top</span><span class="o">:</span> <span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
  <span class="na">border-top</span><span class="o">:</span> <span class="mi">1</span><span class="kt">px</span> <span class="no">solid</span> <span class="nv">$grayMediumLight</span><span class="p">;</span>
  <span class="na">color</span><span class="o">:</span> <span class="nv">$grayLight</span><span class="p">;</span>
  <span class="nt">a</span> <span class="p">{</span>
    <span class="na">color</span><span class="o">:</span> <span class="nv">$gray</span><span class="p">;</span>
    <span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span> 
      <span class="na">color</span><span class="o">:</span> <span class="nv">$grayDarker</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>  
  <span class="nt">small</span> <span class="p">{</span> 
    <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span> 
  <span class="p">}</span>
  <span class="nt">ul</span> <span class="p">{</span>
    <span class="na">float</span><span class="o">:</span> <span class="no">right</span><span class="p">;</span>
    <span class="na">list-style</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
    <span class="nt">li</span> <span class="p">{</span>
      <span class="na">float</span><span class="o">:</span> <span class="no">left</span><span class="p">;</span>
      <span class="na">margin-left</span><span class="o">:</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div></div>


<p>Sass gives us even more ways to simplify our stylesheets, but the code in <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-refactored_scss">Listing 5.15</a> uses the most important features and gives us a great start. See the <a href="http://sass-lang.com/">Sass website</a> for more details.</p>

<div class="label" id="sec-layout_links"></div>


<h2><a id="sec-5_3" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links" class="heading"><span class="number">5.3</span>レイアウトのリンク</a></h2>


<p>立派なスタイルでサイトレイアウト作成が完了しましたが、<code>’#’</code>で代用していたリンクを埋めるときがやってきました。もちろんリンクをこのように直接記述することもできます</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/static_pages/about&quot;</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>しかしこれはRails流ではありません。私個人としては、もしaboutページへのURIが /static_pages/about ではなく /about の方が良いと思います。さらに、Railsの規約では下記のようなコードで<em>名前付きルート</em>を使用します。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>この方法でコードはよりわかりやすい意味を持ち、また、<code>about_path</code>の定義を変えることで<code>about_path</code>が使用されている全てのURIを変更できるため、より柔軟性を持ちます。</p>

<p>計画しているリンクの全てのリストは、URIとルート(route)のマッピングと共に<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#table-url_mapping">表5.1</a>にあります。この章の終わりまでに、最後のリンクを除き全て実装します。(最後のリンクは<a class="ref" href="http://railstutorial.jp/sign-in-sign-out.html#top">第8章</a>で作成します。)</p>

<div class="label" id="table-url_mapping"></div>


<div class="table"><div class="center">
<table class="tabular"><tr><th class="align_left"><strong>Page</strong></th><th class="align_left"><strong>URI</strong></th><th class="align_right"><strong>Named route</strong></th></tr><tr class="top_bar"><td class="align_left">Home</td><td class="align_left">/</td><td class="align_right"><code>root_path</code></td></tr><tr><td class="align_left">About</td><td class="align_left">/about</td><td class="align_right"><code>about_path</code></td></tr><tr><td class="align_left">Help</td><td class="align_left">/help</td><td class="align_right"><code>help_path</code></td></tr><tr><td class="align_left">Contact</td><td class="align_left">/contact</td><td class="align_right"><code>contact_path</code></td></tr><tr><td class="align_left">Sign up</td><td class="align_left">/signup</td><td class="align_right"><code>signup_path</code></td></tr><tr><td class="align_left">Sign in</td><td class="align_left">/signin</td><td class="align_right"><code>signin_path</code></td></tr></table></div><div class="caption"><span class="header">表 5.1 </span><span class="description">サイトリンクのルート(route)とURIのマッピング。</span></div></div>


<p>先に進む前にContactページを追加しましょう。(<a class="ref" href="http://railstutorial.jp/static-pages.html#top">第3章</a>の演習として残されています). テストは<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-contact_page_test">リストL5.16</a>に載せており、単に<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_title">リスト3.18</a>に登場したモデルにしたがっています。<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-contact_page_test">リスト5.16</a>のアプリケーションコードでは、Ruby 1.9スタイルのハッシュに変更していることに注意してください。</p>

<div class="label" id="code-contact_page_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.16</span> <span class="description">Contactページのテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="s1">&#39;/static_pages/contact&#39;</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>これらのテストが失敗することを確認すべきです</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>アプリケーションコードは<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-adding_a_page">3.2.2</a>のAboutページへの追加と良く似ています。最初にルート(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-contact_route">リスト5.17</a>)を更新します。そして<code>contact</code>アクションをStaticPagesコントローラー(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-contact_action">リストL5.18</a>)に追加します。最後にContactビュー(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-contact_view">リスト5.19</a>)を作成します。</p>

<div class="label" id="code-contact_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.17</span> <span class="description">Contactページへのルートを追加。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/help&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/about&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;static_pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.18</span> <span class="description">Contactページへのアクションを追加。</span><br /><span class="description"> <code>app/controllers/static_pages_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StaticPagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.19</span> <span class="description">Contactページのビュー。</span><br /><span class="description"> <code>app/views/static_pages/contact.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/contact&quot;</span><span class="nt">&gt;</span>contact page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>テストが成功することを確認してください</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>




<div class="label" id="sec-route_tests"></div>


<h3><a id="sec-5_3_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-route_tests" class="heading"><span class="number">5.3.1</span> ルートのテスト</a></h3>


<p>静的ページの結合テストを書いたため、ルートに対するテストはシンプルです。それぞれ直接記述したアドレスを<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#table-url_mapping">表5.1</a>にある名前付きルートに置き換えるだけです。言い換えると、</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="s1">&#39;/static_pages/about&#39;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="n">visit</span> <span class="n">about_path</span>
</pre></div>
</div>


<p>他のページも同様にします。結果は<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-route_tests">リスト5.20</a>にあります。</p>

<div class="label" id="code-route_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.20</span> <span class="description">名前付きルートのテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">root_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Help&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">help_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Help&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;About&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;About Us&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">about_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | About Us&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the title &#39;Contact&#39;&quot;</span> <span class="k">do</span>
      <span class="n">visit</span> <span class="n">contact_path</span>
      <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                    <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>いつもと同じようにテストが赤くなることを確認すべきです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>ところで、もし<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-route_tests">リスト5.20</a>が同じ事の繰り返しや冗長だと感じたなら、それはあなただけはありません。この散らかった状態は<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-pretty_rspec">5.3.4</a>で美しい宝石へリファクタリングします。</p>

<div class="label" id="sec-rails_routes"></div>


<h3><a id="sec-5_3_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-rails_routes" class="heading"><span class="number">5.3.2</span> Railsのルート</a></h3>


<p>我々が望むURIに対するテストがあるので、それらを実際に利用できるようにします。<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>で述べたように、RailsがURIマッピングに使用するファイルは<code>config/routes.rb</code>です。もしデフォルトのルートファイルを見ると、そこは凄く乱雑でしょう。しかし、それは全てコメントアウトされたルートマッピングの例であり、必要な乱雑さなのです。いつかそれらを読んでみることをお勧めします。また、ルートのより詳細な扱い方について<a href="http://guides.rubyonrails.org/routing.html">Rails GuidesのRails Routing from the outside in</a>をご覧になることをお勧めします。</p>

<p>名前付きルートを定義するため、以下のようなルールは</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/help&#39;</span>
</pre></div>
</div>


<p>下記のように置き換えます。</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
</pre></div>
</div>


<p>これは<code>/help</code>に有効なページと、そのページへのパスを返す<code>help_path</code>と呼ばれる名前付きルートの両方を準備します。(実際には、<code>match</code>の箇所に<code>get</code>を使用しても同じ名前付きルートとなりますが、<code>match</code>を利用する方がより慣例に従っています。)</p>

<p>このパターンを他の静的ページに適用すると<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-static_page_routes">リスト5.21</a>になります。唯一の例外は<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-root_route">リスト5.23</a>で取り扱うHomeページです。</p>

<div class="label" id="code-static_page_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.21</span> <span class="description">静的ページのルート。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>もし注意深く<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-static_page_routes">リスト5.21</a>コードを読むと、それが何をしているか理解できるでしょう。例えば、</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
</pre></div>
</div>


<p><code>’/about’</code>に一致するとStaticPagesコントローラーの<code>about</code>アクションにルーティングします。以前はより明示的でした。これまでに使用した</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s1">&#39;static_pages/about&#39;</span>
</pre></div>
</div>


<p>は同じページへたどり着きますが、<code>/about</code>はより簡潔です。さらに前述したように、<code>match ’/about’</code>というコードは自動的にコントローラーとビューで使用する<em>名前付きルート</em>を生成します。</p>

<div class="code"><div class="highlight"><pre><span class="n">about_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/about&#39;</span>
<span class="n">about_url</span>  <span class="o">=&gt;</span> <span class="s1">&#39;http://localhost:3000/about&#39;</span>
</pre></div>
</div>


<p><code>about_url</code>は<em>フル</em> URI http://localhost:3000/about ( <code>localhost:3000</code>は、本番環境で<code>example.com</code>のようなドメイン名へ置き換えられます。)であることを覚えておいてください。 <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links">5.3</a>に書いたように、/about のみを取得する場合は <code>about_path</code>を使います。<em>Railsチュートリアル</em>では、<code>url</code>書式を使用するリダイレクトの場合を除き、<code>path</code>書式を使用する一般的な規約に従います。これは、リダイレクトのあとにHTTP標準技術ではフルURIが要求されるためです。ただし、ほとんどのブラウザではどちらの方法でも動作します。</p>

<p>これまでに定義したルートで、Help、About、Contactページのテストはパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>これでHomeページのテストが失敗する最後のテストになります。</p>

<p>Homeページへのルートマッピングを作成するため、このようなコードを使用<em>したとしてもよいでしょう</em>。</p>

<div class="code"><div class="highlight"><pre><span class="n">match</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>
</pre></div>
</div>


<p>しかしながらこれは不必要です。Railsはファイル(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-root_route_hint">リスト5.22</a>)の下側にルート(root)URI / (“スラッシュ”)に対する特別なメソッドがあります。</p>

<div class="label" id="code-root_route_hint"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.22</span> <span class="description">ルート(root)へのルーティングを定義するコメントアウトされたヒント。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="c1"># You can have the root of your site routed with &quot;root&quot;</span>
  <span class="c1"># just remember to delete public/index.html.</span>
  <span class="c1"># root :to =&gt; &quot;welcome#index&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-root_route_hint">リストL5.22</a>を参考に、ルート(root)URI / をHomeページへルーティングをするところ<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-root_route">リスト5.23</a>までたどり着きました。</p>

<div class="label" id="code-root_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.23</span> <span class="description">ルート(root)へのルーティングのためのマッピングを追加。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>  
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>このコードはルート(root)URIを /static_pages/home へ、そしてURIヘルパーへ下記の設定を与えます。</p>

<div class="code"><div class="highlight"><pre><span class="n">root_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span>
<span class="n">root_url</span>  <span class="o">=&gt;</span> <span class="s1">&#39;http://localhost:3000/&#39;</span>
</pre></div>
</div>


<p>また<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-root_route_hint">リスト5.22</a>のコメントにも注意を払うべきであり、/ へアクセスした際にRailsがデフォルトのページ(<a class="ref" href="http://railstutorial.jp/beginning.html#fig-riding_rails_31">図1.3</a>)を表示しないように<code>public/index.html</code>を削除します。もちろん単純にそのファイルを削除できますが、もしGitをバージョン管理で使用しているのなら、<code>git rm</code>を使用してファイル削除と同時にGitへ削除を通知する方法があります。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git rm public/index.html
</pre></div>
</div>


<p>これで静的ページへのルートが全て動作し、テストは全てパスするはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p>レイアウトのリンクを埋める必要が出てきました。</p>

<div class="label" id="sec-named_routes"></div>


<h3><a id="sec-5_3_3" href="http://railstutorial.jp/filling-in-the-layout.html#sec-named_routes" class="heading"><span class="number">5.3.3</span>名前付きルート</a></h3>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-rails_routes">5.3.2</a>で作成した名前付きルートをレイアウトで動作するようにしましょう。これには<code>link_to</code>メソッドの2番目の引数に適切な名前付きルートを指定する必要があります。例えば</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>上を以下のように変更します。</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span> <span class="n">about_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p></p>

<p>HomeとHelpページへのリンクを持つヘッダーpartialの<code>_header.html.erb</code> (<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-header_partial_links">リスト5.24</a>)から開始します。ヘッダーpartialを扱っている間に、ウェブ共通の慣習に従いロゴにもHomeページへのリンクを追加します。</p>

<div class="label" id="code-header_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.24</span> <span class="description">リンク付きのヘッダーpartial。</span><br /><span class="description"> <code>app/views/layouts/_header.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">&quot;navbar navbar-fixed-top navbar-inverse&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;sample app&quot;</span><span class="p">,</span> <span class="n">root_path</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;logo&quot;</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;nav&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav pull-right&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span>    <span class="n">root_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Help&quot;</span><span class="p">,</span>    <span class="n">help_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
          <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign in&quot;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
      <span class="nt">&lt;/nav&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/header&gt;</span>
</pre></div>
</div></div>


<p>&quot;Sign in&quot;リンクの名前付きルートは<a class="ref" href="http://railstutorial.jp/sign-in-sign-out.html#top">第8章</a>まで存在しないため、今の段階では<code>’#’</code>としておきます。</p>

<p>他にリンクのある箇所はAboutとContactページへのリンクを持つフッターpartialの<code>_footer.html.erb</code>(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-footer_partial_links">リスト5.25</a>)です。</p>

<div class="label" id="code-footer_partial_links"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.25</span> <span class="description">リンク付きのフッターpartial。</span><br /><span class="description"> <code>app/views/layouts/_footer.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;footer</span> <span class="na">class=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;small&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    by Michael Hartl
  <span class="nt">&lt;/small&gt;</span>
  <span class="nt">&lt;nav&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About&quot;</span><span class="p">,</span>   <span class="n">about_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Contact&quot;</span><span class="p">,</span> <span class="n">contact_path</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
      <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://news.railstutorial.org/&quot;</span><span class="nt">&gt;</span>News<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
</div></div>


<p>これでレイアウトは<a class="ref" href="http://railstutorial.jp/static-pages.html#top">第3章</a>で作成した全ての静的ページについて、例えば、<a href="http://localhost:3000/about">/about</a> はAboutページ(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-about_page">図5.8</a>)へ行くようなリンクを持ちます。</p>

<p>ところで実際にレイアウト上にリンクの存在をテストしていませんが、もし名前付きルートが定義されていなければテストは失敗するであろうということに注目する価値があります。これは<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-static_page_routes">リスト5.21</a>のルート定義をコメントアウトし、テストスイートを走らせることで確認できます。リンクが実際に正しい場所を指している事を確認するテストの手法については<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises">5.6</a>を参照します。</p>

<div class="label" id="fig-about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/about_page_styled.png" alt="about_page_styled" /></span></div><div class="caption"><span class="header">図5.8: </span><span class="description"><a href="http://localhost:3000/about">/about</a>で表示されるAboutページ。<a href="http://railstutorial.org/images/figures/about_page_styled-full.png">(拡大)</a></span></div></div>




<div class="label" id="sec-pretty_rspec"></div>


<h3><a id="sec-5_3_4" href="http://railstutorial.jp/filling-in-the-layout.html#sec-pretty_rspec" class="heading"><span class="number">5.3.4</span>Pretty RSpec</a></h3>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-route_tests">5.3.1</a>で静的ページのテストが冗長で同じような繰り返しになってきていると言うことを述べました(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-route_tests">リスト5.20</a>)。ここではRSpecの最新の機能を使い、テストをより簡潔で洗練されたものにします。</p>

<p>どのように改善できるかいくつかの例を見てみましょう。</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                      <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>一つ気付くことは3つの例全てでルートへのアクセスが含まれていることです。<code>before</code>ブロックを使用することでこの冗長箇所を除くことができます。</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span> 

  <span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should have the base title&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
                      <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">&quot;should not have a custom page title&quot;</span> <span class="k">do</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should_not</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>


<p>以下の行に注目してください。</p>

<div class="code"><div class="highlight"><pre><span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
</pre></div>
</div>


<p>これでそれぞれの例の前にルートパスへのアクセスを実行します。(<code>before</code>メソッドは別名でもある<code>before(:each)</code>でも呼ぶことができます。)</p>

<p>それぞれの例では現れる冗長性の原因が他にもあります。</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the h1 &#39;Sample App&#39;&quot;</span> <span class="k">do</span>
</pre></div>
</div>


<p>上記と下記ではどちらも本質的には同じような事を言っています。</p>

<div class="code"><div class="highlight"><pre><span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span>
</pre></div>
</div>


<p>さらにどちらの例も<code>page</code>変数を参照しています。RSpecに<code>page</code>はテスト使用している<em>対象(subject)</em>であると伝えることにより、冗長の原因を排除できます。</p>

<div class="code"><div class="highlight"><pre><span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>
</pre></div>
</div>


<p>そして<code>it</code>変数のメソッドを使用することにより、コードと記述を1行に収めます。</p>

<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>


<p><code>subject { page }</code>により、<code>should</code>の呼び出しは自動的にCapybara (<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-TDD">3.2.1</a>)により提供される<code>page</code>変数を使用します。</p>

<p>これらの変更を加えることでHomeページのテストはより簡潔になります。</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span> 

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
                        <span class="ss">text:</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>このコードは以前より良く見えますが、まだタイトルのテストが少し長すぎます。確かに<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-route_tests">リスト5.20</a>にあるほとんどのタイトルのテストが長いテキストになっています。</p>

<div class="code"><div class="highlight"><pre><span class="s2">&quot;Ruby on Rails Tutorial Sample App | About&quot;</span>
</pre></div>
</div>


<p><a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_exercises">3.5</a>の演習は<code>base_title</code>変数を定義し、文字列の補完を使用することでこの冗長性を排除することを提案します(<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_exercise">リスト3.30</a>)。<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#code-title_helper">リスト4.2</a>の<code>full_title</code>ヘルパーと似ている<code>full_title</code>を定義することでもっと良くすることができます。RSpecユーティリティー用に<code>spec/support</code>ディレクトリーと<code>utilities.rb</code>ファイルを作ることでこれを行います(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-rspec_utilities">リスト5.26</a>)。</p>

<div class="label" id="code-rspec_utilities"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.26</span> <span class="description"><code>full_title</code>メソッドを持つRSpecユーティリティー用ファイル。</span><br /><span class="description"> <code>spec/support/utilities.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">)</span>
  <span class="n">base_title</span> <span class="o">=</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App&quot;</span>
  <span class="k">if</span> <span class="n">page_title</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">base_title</span>
  <span class="k">else</span>
    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">base_title</span><span class="si">}</span><span class="s2"> | </span><span class="si">#{</span><span class="n">page_title</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>もちろんこれは基本的<a class="ref" href="http://railstutorial.jp/rails-flavored-ruby.html#code-title_helper">リスト4.2</a>のヘルパーと同じです。しかし、二つの独立したメソッドを持つことでベースタイトルのタイプミスを捉えることができます。これははっきりとしない設計ですが、オリジナルの<code>full_title</code>ヘルパーを直接テストするより良い(少しだけ先進的な)アプローチで、演習で登場します(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises">5.6</a>)。</p>

<p>RSpecによって<code>spec/support</code>ディレクトリは自動的に読み込まれるため、Homeテストは以下のように書くことができます。</p>

<div class="code"><div class="highlight"><pre>  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span> 

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>Homeページで使用したのと同じ方法で、Help、About、Contactページのテストを単純化することができます。<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-pretty_page_tests">リスト5.27</a>に結果があります。</p>

<div class="label" id="code-pretty_page_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.27</span> <span class="description">静的ページのこぎれいになったテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sample App&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">help_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Help&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Help&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">about_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;About&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">contact_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Contact&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Contact&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>テストがまたパスすることを確認すべきです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/static_pages_spec.rb
</pre></div>
</div>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-pretty_page_tests">リスト5.27</a>のRspecスタイルは<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-route_tests">リスト5.20</a>のスタイルよりも簡潔でわかりやすいです。—実はさらに簡潔でわかりやすくできます。(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises">5.6</a>)。サンプルアプリケーションの残りを開発の際に、この簡潔なスタイルを可能であるときはいつでも使っていきます。</p>

<div class="label" id="sec-user_signup"></div>


<h2><a id="sec-5_4" href="http://railstutorial.jp/filling-in-the-layout.html#sec-user_signup" class="heading"><span class="number">5.4</span>ユーザーのサインアップ：最初のステップ</a></h2>


<p>レイアウトとルーティングの取り組みにおける最高点として、このセクションではサインアップページへのルートを作成します。これは二つ目のコントローラを作成することになります。これは私たちのサイトへユーザー登録してもらうための最初の重要な一歩となります。次にユーザのモデリングを<a class="ref" href="http://railstutorial.jp/modeling-users.html#top">第6章</a>、そして全ては<a class="ref" href="http://railstutorial.jp/sign-up.html#top">第7章</a>で完了します。</p>

<div class="label" id="sec-users_controller"></div>


<h3><a id="sec-5_4_1" href="http://railstutorial.jp/filling-in-the-layout.html#sec-users_controller" class="heading"><span class="number">5.4.1</span>ユーザーコントローラ</a></h3>


<p>最初のコントローラーであるStaticPagesコントローラーを<a class="ref" href="http://railstutorial.jp/static-pages.html#sec-static_pages_with_rails">3.1.2</a>で作ってからしばらく経ちました。2番目のコントローラーのUsersコントローラーを作るときになりました。これまでのように<code>generate</code>で現時点での要求である新規ユーザーのためのサインアップページへのスタブを持つ簡単なコントローラーを作成します。Railsが好む<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">RESTアーキテクチャ</a>の規約に従い、新規ユーザーのためのアクションを<code>new</code>とし、自動的にアクションを作成するため<code>generate controller</code>への引数として渡します。(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-generate_users_controller">リスト5.28</a>)。</p>

<div class="label" id="code-generate_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.28</span> <span class="description">Usersコントローラーの生成(<code>new</code>アクション付き)。</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Users new --no-test-framework
<span class="go">      create  app/controllers/users_controller.rb</span>
<span class="go">       route  get &quot;users/new&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/users</span>
<span class="go">      create    app/views/users/new.html.erb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/users_helper.rb</span>
<span class="go">      invoke  assets</span>
<span class="go">      invoke    coffee</span>
<span class="go">      create      app/assets/javascripts/users.js.coffee</span>
<span class="go">      invoke    scss</span>
<span class="go">      create      app/assets/stylesheets/users.css.scss</span>
</pre></div>
</div></div>


<p>これは<code>new</code>アクションを持つUsersコントローラー(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-initial_users_controller">リスト5.29</a>)と、スタブのビューを作成します(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-initial_new_action">リスト5.30</a>)。</p>

<div class="label" id="code-initial_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.29</span> <span class="description"><code>new</code>アクションを持つ最初のUsersコントローラー。</span><br /><span class="description"> <code>app/controllers/users_controller.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">new</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-initial_new_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.30</span> <span class="description">Usersのための最初の<code>new</code>アクション。</span><br /><span class="description"> <code>app/views/users/new.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Users#new<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="sec-signup_url"></div>


<h3><a id="sec-5_4_2" href="http://railstutorial.jp/filling-in-the-layout.html#sec-signup_url" class="heading"><span class="number">5.4.2</span>サインアップURI</a></h3>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-users_controller">5.4.1</a>からのコードで既に新規ユーザーのための動作するページが既に /users/new にあります。しかし、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#table-url_mapping">表5.1</a>を思い出して欲しいのですが、実際には /signup のようなURIとしたいのです。<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_links">5.3</a>では最初いくつかの結合テストを書きましたが、今回は生成します。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate integration_test user_pages
</pre></div>
</div>


<p>それから<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-pretty_page_tests">リスト5.27</a>の静的ページspecのひな形に従い、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-user_pages_spec">リスト5.31</a>で見たように、userページのテストのため<code>h1</code>と<code>title</code>タグの中身を埋めます。</p>

<div class="label" id="code-user_pages_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">5.31</span> <span class="description">サインアップページへのテストを含む最初のusers用spec。</span><br /><span class="description"> <code>spec/requests/user_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;User pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="s2">&quot;signup page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">signup_path</span> <span class="p">}</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;Sign up&#39;</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>いつもと同じようにこれらのテストを<code>rspec</code>コマンドで実行できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/user_pages_spec.rb
</pre></div>
</div>


<p>ここで一つのファイルの代わりにディレクトリ全体を渡すことで、走らせたいspecのテストを実行できることを覚えておくと良いでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/requests/
</pre></div>
</div>


<p>このパターンを元にして、<em>全て</em>のspecを実行させる方法を推測できるでしょう。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>完全を期して、通常はチュートリアルの最後までこの方法を使用します。ところで、<code>spec</code>のRakeタスクでテストスイートを実行できることを覚えておきましょう(もしかすると他の人が使うのを見たかもしれませんが)。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake spec
</pre></div>
</div>


<p>(実際には<code>rake</code>とタイプするだけです。<code>rake</code>のデフォルトの動作はテストスイートの実行です。)</p>

<p>作成したときにUsersコントローラーは既に<code>new</code>アクションを持っているため、テストをパスさせるためには正しいルートとビューの中身が必要です。<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-static_page_routes">リスト5.21</a>の例に従い、<code>match ’/signup’</code>をサインアップURI のためのルールを追加します。(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-signup_route">リスト5.32</a>)。</p>

<div class="label" id="code-signup_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.32</span> <span class="description">サインアップページへのルート。</span><br /><span class="description"> <code>config/routes.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="ss">SampleApp::Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;users/new&quot;</span>

  <span class="n">root</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#home&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/signup&#39;</span><span class="p">,</span>  <span class="ss">to:</span> <span class="s1">&#39;users#new&#39;</span>

  <span class="n">match</span> <span class="s1">&#39;/help&#39;</span><span class="p">,</span>    <span class="ss">to:</span> <span class="s1">&#39;static_pages#help&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/about&#39;</span><span class="p">,</span>   <span class="ss">to:</span> <span class="s1">&#39;static_pages#about&#39;</span>
  <span class="n">match</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="ss">to:</span> <span class="s1">&#39;static_pages#contact&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-generate_users_controller">リスト5.28</a>でUsersコントローラーを生成したときに自動的に生成された<code>get &quot;users/new&quot;</code>のルールをそのままにしていることに注目してください。今のところこのルールは<code>’users/new’</code>のルーティングを動作させるために必要ですが、適切なREST規約(<a class="ref" href="http://railstutorial.jp/a-demo-app.html#table-demo_RESTful_users">表2.2</a>)に従っていません。これは<a class="ref" href="http://railstutorial.jp/sign-up.html#sec-a_users_resource">7.1.2</a>で取り除きます。</p>

<p>テストをパスさせるため、今しなければならないことは“サインアップ”のタイトルとヘッダーを持つビューです(<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-initial_signup_page">リスト5.33</a>)。</p>

<div class="label" id="code-initial_signup_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.33</span> <span class="description">最初の(スタブ)サインアップページ。</span><br /><span class="description"> <code>app/views/users/new.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;%</span> <span class="n">provide</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="s1">&#39;Sign up&#39;</span><span class="p">)</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;h1&gt;</span>Sign up<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/users/new.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>この段階で<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-user_pages_spec">リスト5.31</a>のテストはパスするはずです。後しなければならないことは、Homeページのボタンに適切なリンクを追加することです。他のルートと同じように<code>match ’/signup’</code>で<code>signup_path</code>という名前付きルートができ、それを<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-home_page_signup_link">リスト5.34</a>で使います。</p>

<div class="label" id="code-home_page_signup_link"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.34</span> <span class="description">ボタンへサインアップページへのリンクをつける。</span><br /><span class="description"> <code>app/views/static_pages/home.html.erb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;center hero-unit&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Welcome to the Sample App<span class="nt">&lt;/h1&gt;</span>

  <span class="nt">&lt;h2&gt;</span>
    This is the home page for the
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
    sample application.
  <span class="nt">&lt;/h2&gt;</span>

  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;Sign up now!&quot;</span><span class="p">,</span> <span class="n">signup_path</span><span class="p">,</span> <span class="ss">class:</span> <span class="s2">&quot;btn btn-large btn-primary&quot;</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">image_tag</span><span class="p">(</span><span class="s2">&quot;rails.png&quot;</span><span class="p">,</span> <span class="ss">alt:</span> <span class="s2">&quot;Rails&quot;</span><span class="p">),</span> <span class="s1">&#39;http://rubyonrails.org/&#39;</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>これで少なくともサインインへのルートを追加するまでリンクと名前付きルートが完了しました(<a class="ref" href="http://railstutorial.jp/sign-in-sign-out.html#top">第8</a>)。結果は<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#fig-new_signup_page">図5.9</a>の新規ユーザーのページ(URI /signup)に表示されています。</p>

<div class="label" id="fig-new_signup_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="http://railstutorial.jp/images/figures/new_signup_page_bootstrap.png" alt="new_signup_page_bootstrap" /></span></div><div class="caption"><span class="header">図5.9: </span><span class="description"><a href="http://localhost:3000/signup">/signup</a>で表示される新しいサインアップページ 。<a href="http://railstutorial.org/images/figures/new_signup_page_bootstrap-full.png">(拡大)</a></span></div></div>


<p>この段階でテストはパスするはずです。At this point the tests should pass:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>




<div class="label" id="sec-layout_conclusion"></div>


<h2><a id="sec-5_5" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_conclusion" class="heading"><span class="number">5.5</span>最後に</a></h2>


<p>この章ではアプリケーションのレイアウトを形作り、ルーティングを洗練しました。この本の残りはサンプルアプリケーションを肉付けすることに専念します。まず、サインアップ、サインイン、サインアウトできるユーザーを追加します。次に、マイクロポストを追加します。最後に、他のユーザーをフォローできるようにします。</p>

<p>もしGitを使っているのならこの段階でマスターブランチへ変更をマージすべきです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Finish layout and routes&quot;</span>
<span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge filling-in-layout
</pre></div>
</div>


<p>GitHubへもプッシュすることが出来ます:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
</pre></div>
</div>


<p>最後にHerokuへ展開できます。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>本番環境のサーバーでサンプルアプリケーションが動作しているはずです。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku open
</pre></div>
</div>


<p>もしも不具合に遭遇したら下記コマンドを試してください。</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku logs
</pre></div>
</div>


<p>Herokuのログファイルを使用してエラーをデバッグできます。</p>

<div class="label" id="sec-layout_exercises"></div>


<h2><a id="sec-5_6" href="http://railstutorial.jp/filling-in-the-layout.html#sec-layout_exercises" class="heading"><span class="number">5.6</span>演習</a></h2>




<ol>

<li><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-pretty_page_tests">リスト5.27</a>の静的ページのテストコードは簡潔ですが、まだ同じような繰り返しがあります。RSpecは<em>shared examples</em>と呼ばれる機能があり、冗長性を排除できます。<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-static_pages_spec_shared_example">リスト5.35</a>の例に従い、Help、AboutとContactページの足りないテストを埋めます。<a class="ref" href="http://railstutorial.jp/static-pages.html#code-pages_controller_spec_exercise">リスト3.30</a>で少し紹介した<code>let</code>コマンドは、要求に応じて与えられた値を持つローカル変数を作成しますことに注目してください(例：変数が使用されるときなど)。対照的にインスタンス変数はアサインされたときに作成されます。</li>

<li>既にお気づきかもしれませんが、これまでのレイアウト上のリンクのルーティングテストは、実際にリンクが正しいページへのリンクになっているかチェックをしていません。これらのテストを実装する一つの方法は、<code>visit</code>と<code>click_link</code>をRSpecの結合テスト内で使用することです。レイアウトのリンクが正しく定義されているか、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-layout_links_test">リスト5.36</a>のコードを埋めてください。</li>

<li><a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-full_title_helper_tests">リスト5.37</a>にあるように、<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-rspec_utilities">リスト5.26</a>の<code>full_title</code>テストヘルパーへの依存性を独自のヘルパーメソッドを書くことで排除してください。(<code>spec/helpers</code>ディレクトリと<code>application_helper_spec.rb</code>ファイルの両方を作らないと行けないでしょう。) そしてそれを<a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-rspec_utilities_simplified">リスト5.38</a>のコードを使用してテストへ<code>インクルード(include)</code>してください。テストスイートを実行して新しいコードに問題が無いか確認してください。<em>注意</em>: <a class="ref" href="http://railstutorial.jp/filling-in-the-layout.html#code-full_title_helper_tests">リスト5.37</a>は<a class="ref" href="http://railstutorial.jp/modeling-users.html#sec-format_validation">6.2.4</a>で学ぶ<em>正規表現</em>を使用しています。(この演習の提案と使用したコードについて<a href="http://alexchaffee.com/">Alex Chaffee</a>に感謝します。)</li>

</ol>




<div class="label" id="code-static_pages_spec_shared_example"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.35</span> <span class="description">テストの冗長性排除のためRSpecのshared exampleを使用。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="n">page</span> <span class="p">}</span>

  <span class="n">shared_examples_for</span> <span class="s2">&quot;all static pages&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span>    <span class="ss">text:</span> <span class="n">heading</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="n">page_title</span><span class="p">))</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Home page&quot;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:heading</span><span class="p">)</span>    <span class="p">{</span> <span class="s1">&#39;Sample App&#39;</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:page_title</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;&#39;</span> <span class="p">}</span>

    <span class="n">it_should_behave_like</span> <span class="s2">&quot;all static pages&quot;</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="s1">&#39;| Home&#39;</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Help page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;About page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;Contact page&quot;</span> <span class="k">do</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-layout_links_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.36</span> <span class="description">レイアウトのリンクのためのテスト。</span><br /><span class="description"> <code>spec/requests/static_pages_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="s2">&quot;Static pages&quot;</span> <span class="k">do</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">it</span> <span class="s2">&quot;should have the right links on the layout&quot;</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="n">root_path</span>
    <span class="n">click_link</span> <span class="s2">&quot;About&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="ss">text:</span> <span class="n">full_title</span><span class="p">(</span><span class="s1">&#39;About Us&#39;</span><span class="p">)</span>
    <span class="n">click_link</span> <span class="s2">&quot;Help&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;Contact&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;Home&quot;</span>
    <span class="n">click_link</span> <span class="s2">&quot;Sign up now!&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
    <span class="n">click_link</span> <span class="s2">&quot;sample app&quot;</span>
    <span class="n">page</span><span class="o">.</span><span class="n">should</span> <span class="c1"># fill in</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-full_title_helper_tests"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.37</span> <span class="description"><code>full_title</code>ヘルパーのテスト。</span><br /><span class="description"> <code>spec/helpers/application_helper_spec.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">ApplicationHelper</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;full_title&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should include the page title&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/foo/</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should include the base title&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/^Ruby on Rails Tutorial Sample App/</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should not include a bar for the home page&quot;</span> <span class="k">do</span>
      <span class="n">full_title</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">should_not</span> <span class="o">=~</span> <span class="sr">/\|/</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code-rspec_utilities_simplified"></div>


<div class="codelisting">
<div class="listing"><span class="header">リスト5.38</span> <span class="description"><code>full_title</code>テストヘルパーを単純に <code>include</code>で置換。</span><br /><span class="description"> <code>spec/support/utilities.rb</code></span> </div>
<div class="code"><div class="highlight"><pre><span class="kp">include</span> <span class="no">ApplicationHelper</span>
</pre></div>
</div></div>




<div class="navigation">  <a class="prev_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top">
</a><a class="prev_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top"><span class="number">第4章</span> Rails風味のRuby</a><a class="prev_page" href="http://railstutorial.jp/rails-flavored-ruby.html#top">  </a>
  <a class="next_page" href="http://railstutorial.jp/modeling-users.html#top">
</a><a class="next_page" href="http://railstutorial.jp/modeling-users.html#top">    <span class="number">第6章</span>ユーザーのモデルを作成する</a><a class="next_page" href="http://railstutorial.jp/modeling-users.html#top">  </a>
</div><div class="footnotes">
<ol>
<li id="fn-5_1">サンプルアプリケーションをBootstrapを使うように変換する際に素晴らしい働きをして助けてくれた読者の<a href="https://twitter.com/colmtuite">Colm Tuite</a>に感謝します。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_1">↑</a></li>
<li id="fn-5_2"><em>Ruby on Rails Tutorial</em>のモックアップは<a href="http://gomockingbird.com">Mockingbird</a>と呼ばれるオンラインモックアップアプリケーションでできています。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_2">↑</a></li>
<li id="fn-5_3">これらはまったくRubyのクラスとは関係がありません。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_3">↑</a></li>
<li id="fn-5_4">既にお気づきかもしれませんが、<code>img</code>タグは<tt class="verb">&lt;img&gt;...&lt;/img&gt;</tt>よりもむしろ<tt class="verb">&lt;img ... </tt>のようです。<tt class="verb">/&gt;</tt>. この書式に従うタグは <em>閉じタグ</em>として知られています。 <a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_4">↑</a></li>
<li id="fn-5_5">アセットパイプラインでLESSを使うこともできます。詳細は<a href="http://rubygems.org/gems/less-rails-bootstrap"><tt>less-rails-bootstrap</tt>のgem</a>を参照してください。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_5">↑</a></li>
<li id="fn-5_6">多くのRails開発者が異なるビューで共通に使うパーシャルを保存するディレクトリとして<code>shared</code>ディレクトリを使用します。私は<code>shared</code>フォルダーを複数のビューで使用される有用なパーシャルに使用することを好む一方で、文字どおりすべてのページ(サイトレイアウトの一部として)のパーシャルを<code>layouts</code>ディレクトリへ保存しています。(<code>shared</code>ディレクトリは<a class="ref" href="http://railstutorial.jp/sign-up.html#top">第7章</a>で作成します。) それが私には論理的な分割に思えますが、<code>shared</code>フォルダーに全て保存するのもうまく動作するでしょう。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_6">↑</a></li>
<li id="fn-5_7">なぜ<code>footer</code>タグと<code>.footer</code>クラスの両方を使うのかと不思議に思うかもしれません。その答えは、そのタグが読み手にとって明解な意味を持ち、そのクラスがBootstrapによって使われるからです。<code>footer</code>の箇所に<code>div</code>を使用しても同じように動作するでしょう。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_7">↑</a></li>
<li id="fn-5_8">このセクションの構造は、Michael Erasmusによる素晴らしいブログの投稿<a href="http://2beards.net/2011/11/the-rails-3-asset-pipeline-in-about-5-minutes/">The Rails 3 Asset Pipeline in (about) 5 Minutes</a>をもとにしています。詳しくは<a href="http://guides.rubyonrails.org/asset_pipeline.html">Rails Guide on the Asset Pipeline</a>を参照してください。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_8">↑</a></li>
<li id="fn-5_9">Sassによってもサポートされる古めの<code>.sass</code>フォーマットは 冗長性の少ない(括弧が少ない) 新しい言語を定義しますが、既存のプロジェクトには少し不便で、既にCSSに慣れ親しんだ人にとって少し骨が折れます。<a class="arrow" href="http://railstutorial.jp/filling-in-the-layout.html#fnref-5_9">↑</a></li>
</ol>
</div>




</div>
  </body>
</html>
